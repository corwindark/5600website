{"title":"Financial Time Series Models (ARCH GARCH)","markdown":{"yaml":{"title":"Financial Time Series Models (ARCH GARCH)","format":{"html":{"code-fold":true,"code-summary":"Show Code"}}},"containsRefs":false,"markdown":"\n\n<h2> Introduction </h2>\n\nOn this page, I will look to see whether ARCH and GARCH models may be a good fit for the change in intraday range of popular stock market indices. While these models would usually be fitted on the returns of financial intstruments, the day over day change in intraday percent range also exhibits volatility clustering, and intraday range is the exact subject of my project. This means that modelling these time series successfully would be complementary with the other models I have tried to fit, and I am eager to investigate whether these methods will work well at answering my research questions. I will look to fit 3 models: 1 each for the daily range of SPY, QQQ, and IWM.\n\n\n\n\n<h2> Stationarity and Volatility </h2>\n\nLoad packages\n```{r}\n\nlibrary(tidyverse)\nlibrary(forecast)\nlibrary(quantmod)\n\n```\n\n\n\nRead in data\n```{r}\nspyIn <- quantmod::getSymbols(\"SPY\", from = as.Date(\"2021/01/01\"), to = as.Date(\"2023/09/30\"), periodicity = \"daily\", src = \"yahoo\", auto.assign = FALSE)\nqqqIn <- quantmod::getSymbols(\"QQQ\", from = as.Date(\"2021/01/01\"), to = as.Date(\"2023/09/30\"), periodicity = \"daily\", src = \"yahoo\", auto.assign = FALSE)\niwmIn <- quantmod::getSymbols(\"IWM\", from = as.Date(\"2021/01/01\"), to = as.Date(\"2023/09/30\"), periodicity = \"daily\", src = \"yahoo\", auto.assign = FALSE)\n\n\nspyIn$spyRange <- (spyIn$SPY.High - spyIn$SPY.Low)/ spyIn$SPY.Open\nqqqIn$qqqRange <- (qqqIn$QQQ.High - qqqIn$QQQ.Low)/ qqqIn$QQQ.Open\niwmIn$iwmRange <- (iwmIn$IWM.High - iwmIn$IWM.Low)/ iwmIn$IWM.Open\n\n\n```\n\n\nPlotting the daily ranges:\n\nSPY\n```{r}\n\nplot(spyIn$spyRange)\n\n```\n\nThe SPY data certainly appears to have clustered volatility, as there are large swings in close proximity to eachother. But it also has noticeable trend, with the intraday ranges being higher during the middle of the time series before dropping down again towards the end. To combat this, let's look at the differenced series:\n\n```{r}\nplot(spyIn$spyRange %>% diff())\n```\n\nNow, we see a plot that looks very similar to the daily returns of a stock and promising for ARCH/GARCH modeling, which means it is stationary but has clustered volatility. To adjust for this, we can fit an ARIMA model on the SPY ranges, and then fit a GARCH model on the residuals, which will come from differenced data that is now stationary.\n\nRepeating the process for QQQ:\n```{r}\nplot(qqqIn$qqqRange)\n\n```\n\nOnce again we see clear non-stationarity in the data, so let's look at the differenced values:\n```{r}\nplot(qqqIn$qqqRange %>% diff())\n```\n\nSimilar to the SPY data, the time series is now stationary, although there is heteroskedasticity. So we might expect to model QQQ and SPY similarly, with an ARIMA + ARCH/GARCH model.\n\n\nLet's check IWM:\n```{r}\nplot(iwmIn$iwmRange)\n```\n\nIWM's intraday range looks slightly more stationary than the other 2 time series, and also has more extreme changes in volatility over time. However, we can still see somewhat of a trend, such that a moving average would be obviously nonstationary, so once again we difference the series.\n\n```{r}\nplot(iwmIn$iwmRange %>% diff())\n```\n\nWhile the variance looked elevated in the non-differenced plot, it is actually less hesteroskedastic in the differenced plot. This suggests IWM may not have as much autocorrelation in the variance as the other two indices. An ARIMA model alone might suffice here.\n\n\n<h2>  Look at past arima model for the data (fit here and copy to that tab later) </h2>\n\nNow, let's gather ARIMA models for the intraday range. First we declare the helper function\n```{r}\narimaResults <- function(data) {\n    \n    i=1\n    temp= data.frame()\n    ls=matrix(rep(NA,6*100),nrow=100) # roughly nrow = 3x4x2\n\n\n    for (p in 1:6)# p=1,2,3 : 3\n    {\n        for(q in 1:6)# q=1,2,3,4 :4\n        {\n            for(d in 1:2) {\n                \n                if(p-1+d - 1+q-1<=8) #usual threshold\n                {\n                    \n                    model<- Arima(data,order=c(p-1,d-1,q-1),include.drift=FALSE) \n                    ls[i,]= c(p-1,d-1,q-1,model$aic,model$bic,model$aicc)\n                    i=i+1\n                    #print(i)\n                    \n                }\n\n            }\n                \n        }\n    }\n\n\n    temp= as.data.frame(ls)\n    names(temp)= c(\"p\",\"d\",\"q\",\"AIC\",\"BIC\",\"AICc\")\n    return(temp[which.min(temp$AIC),])\n    #return(temp)\n}\n\n```\n\n\n\nNow, let's find good-fitting models starting with SPY:\n```{r}\narimaResults(spyIn$spyRange)\n```\n\nThe best model returned by the function is ARMA(3,0,3). It is surprising that the models which differenced the data didn't perform better, but I manually reviewed those options and they all had worse AIC and BIC scores.\n\nFor QQQ:\n```{r}\narimaResults(qqqIn$qqqRange)\n```\n\nFor QQQ, the model with the lowest AIC score was ARMA(1,0,1). Once again I expected a differenced model to perform better, but I will continue with the residuals from this model.\n\nFor IWM:\n```{r}\narimaResults(iwmIn$iwmRange)\n```\n\nFitting the pattern of the best models for the financial instruments being of the form ARMA(N, 0, N), the model with the lowest AIC for IWM was ARMA(4,0,4).\n\n\n\n<h2> Reviewing Residuals to Identify ARCH/GARCH Models </h2>\n\nNow, lets look at the residuals of all of these models, to identify clustering and see if we need to fit ARCH/GARCH models on the residuals.\n\nDeclaring the models\n```{r}\nspyARMA <- arima(spyIn$spyRange, order = c(3,0,3))\nqqqARMA <- arima(spyIn$spyRange, order = c(1,0,1))\niwmARMA <- arima(spyIn$spyRange, order = c(4,0,4))\n```\n\n\nSPY range residuals:\n```{r}\ncheckresiduals(spyARMA)\n```\n\nThe residuals show definite clustering around timestamps 260 and 450, which suggests a ARCH/GARCH model will be a good fit. Now lets look at ACF and PACF plots of the residuals and squared residuals:\n\n```{r}\nacf(spyARMA$residuals)\npacf(spyARMA$residuals)\nacf(spyARMA$residuals^2)\npacf(spyARMA$residuals^2)\n\n#install.packages('FinTS')\nlibrary(FinTS)\nArchTest(spyIn$spyRange)\n#ArchTest(spyARMA$residuals)\n```\n\nBased on the ACF and PACF plots, it seems like an ARCH model of (1) might be the best fit for SPY residual data. An ARCH test of the original range data confirms that there is an ARCH effect in the dataset.\n\n\nQQQ Residuals:\n```{r}\nacf(qqqARMA$residuals)\npacf(qqqARMA$residuals)\nacf(qqqARMA$residuals^2)\npacf(qqqARMA$residuals^2)\n\n#install.packages('FinTS')\nlibrary(FinTS)\nArchTest(qqqIn$qqqRange)\nArchTest(qqqARMA$residuals)\n```\n\n\nIWM Residuals:\n```{r}\nacf(iwmARMA$residuals)\npacf(iwmARMA$residuals)\nacf(iwmARMA$residuals^2)\npacf(iwmARMA$residuals^2)\n\n#install.packages('FinTS')\nlibrary(FinTS)\nArchTest(iwmIn$iwmRange)\nArchTest(iwmARMA$residuals)\n```\n\n<h2> Find ARCH or GARCH Model by looking at squared residuals and returns of each model. </h2>\n\n\n<h2> Ljung box tests and model diagnostics for each model </h2>\n\n\n<h2>  Writing out the final equations of the model </h2>\n","srcMarkdownNoYaml":"\n\n<h2> Introduction </h2>\n\nOn this page, I will look to see whether ARCH and GARCH models may be a good fit for the change in intraday range of popular stock market indices. While these models would usually be fitted on the returns of financial intstruments, the day over day change in intraday percent range also exhibits volatility clustering, and intraday range is the exact subject of my project. This means that modelling these time series successfully would be complementary with the other models I have tried to fit, and I am eager to investigate whether these methods will work well at answering my research questions. I will look to fit 3 models: 1 each for the daily range of SPY, QQQ, and IWM.\n\n\n\n\n<h2> Stationarity and Volatility </h2>\n\nLoad packages\n```{r}\n\nlibrary(tidyverse)\nlibrary(forecast)\nlibrary(quantmod)\n\n```\n\n\n\nRead in data\n```{r}\nspyIn <- quantmod::getSymbols(\"SPY\", from = as.Date(\"2021/01/01\"), to = as.Date(\"2023/09/30\"), periodicity = \"daily\", src = \"yahoo\", auto.assign = FALSE)\nqqqIn <- quantmod::getSymbols(\"QQQ\", from = as.Date(\"2021/01/01\"), to = as.Date(\"2023/09/30\"), periodicity = \"daily\", src = \"yahoo\", auto.assign = FALSE)\niwmIn <- quantmod::getSymbols(\"IWM\", from = as.Date(\"2021/01/01\"), to = as.Date(\"2023/09/30\"), periodicity = \"daily\", src = \"yahoo\", auto.assign = FALSE)\n\n\nspyIn$spyRange <- (spyIn$SPY.High - spyIn$SPY.Low)/ spyIn$SPY.Open\nqqqIn$qqqRange <- (qqqIn$QQQ.High - qqqIn$QQQ.Low)/ qqqIn$QQQ.Open\niwmIn$iwmRange <- (iwmIn$IWM.High - iwmIn$IWM.Low)/ iwmIn$IWM.Open\n\n\n```\n\n\nPlotting the daily ranges:\n\nSPY\n```{r}\n\nplot(spyIn$spyRange)\n\n```\n\nThe SPY data certainly appears to have clustered volatility, as there are large swings in close proximity to eachother. But it also has noticeable trend, with the intraday ranges being higher during the middle of the time series before dropping down again towards the end. To combat this, let's look at the differenced series:\n\n```{r}\nplot(spyIn$spyRange %>% diff())\n```\n\nNow, we see a plot that looks very similar to the daily returns of a stock and promising for ARCH/GARCH modeling, which means it is stationary but has clustered volatility. To adjust for this, we can fit an ARIMA model on the SPY ranges, and then fit a GARCH model on the residuals, which will come from differenced data that is now stationary.\n\nRepeating the process for QQQ:\n```{r}\nplot(qqqIn$qqqRange)\n\n```\n\nOnce again we see clear non-stationarity in the data, so let's look at the differenced values:\n```{r}\nplot(qqqIn$qqqRange %>% diff())\n```\n\nSimilar to the SPY data, the time series is now stationary, although there is heteroskedasticity. So we might expect to model QQQ and SPY similarly, with an ARIMA + ARCH/GARCH model.\n\n\nLet's check IWM:\n```{r}\nplot(iwmIn$iwmRange)\n```\n\nIWM's intraday range looks slightly more stationary than the other 2 time series, and also has more extreme changes in volatility over time. However, we can still see somewhat of a trend, such that a moving average would be obviously nonstationary, so once again we difference the series.\n\n```{r}\nplot(iwmIn$iwmRange %>% diff())\n```\n\nWhile the variance looked elevated in the non-differenced plot, it is actually less hesteroskedastic in the differenced plot. This suggests IWM may not have as much autocorrelation in the variance as the other two indices. An ARIMA model alone might suffice here.\n\n\n<h2>  Look at past arima model for the data (fit here and copy to that tab later) </h2>\n\nNow, let's gather ARIMA models for the intraday range. First we declare the helper function\n```{r}\narimaResults <- function(data) {\n    \n    i=1\n    temp= data.frame()\n    ls=matrix(rep(NA,6*100),nrow=100) # roughly nrow = 3x4x2\n\n\n    for (p in 1:6)# p=1,2,3 : 3\n    {\n        for(q in 1:6)# q=1,2,3,4 :4\n        {\n            for(d in 1:2) {\n                \n                if(p-1+d - 1+q-1<=8) #usual threshold\n                {\n                    \n                    model<- Arima(data,order=c(p-1,d-1,q-1),include.drift=FALSE) \n                    ls[i,]= c(p-1,d-1,q-1,model$aic,model$bic,model$aicc)\n                    i=i+1\n                    #print(i)\n                    \n                }\n\n            }\n                \n        }\n    }\n\n\n    temp= as.data.frame(ls)\n    names(temp)= c(\"p\",\"d\",\"q\",\"AIC\",\"BIC\",\"AICc\")\n    return(temp[which.min(temp$AIC),])\n    #return(temp)\n}\n\n```\n\n\n\nNow, let's find good-fitting models starting with SPY:\n```{r}\narimaResults(spyIn$spyRange)\n```\n\nThe best model returned by the function is ARMA(3,0,3). It is surprising that the models which differenced the data didn't perform better, but I manually reviewed those options and they all had worse AIC and BIC scores.\n\nFor QQQ:\n```{r}\narimaResults(qqqIn$qqqRange)\n```\n\nFor QQQ, the model with the lowest AIC score was ARMA(1,0,1). Once again I expected a differenced model to perform better, but I will continue with the residuals from this model.\n\nFor IWM:\n```{r}\narimaResults(iwmIn$iwmRange)\n```\n\nFitting the pattern of the best models for the financial instruments being of the form ARMA(N, 0, N), the model with the lowest AIC for IWM was ARMA(4,0,4).\n\n\n\n<h2> Reviewing Residuals to Identify ARCH/GARCH Models </h2>\n\nNow, lets look at the residuals of all of these models, to identify clustering and see if we need to fit ARCH/GARCH models on the residuals.\n\nDeclaring the models\n```{r}\nspyARMA <- arima(spyIn$spyRange, order = c(3,0,3))\nqqqARMA <- arima(spyIn$spyRange, order = c(1,0,1))\niwmARMA <- arima(spyIn$spyRange, order = c(4,0,4))\n```\n\n\nSPY range residuals:\n```{r}\ncheckresiduals(spyARMA)\n```\n\nThe residuals show definite clustering around timestamps 260 and 450, which suggests a ARCH/GARCH model will be a good fit. Now lets look at ACF and PACF plots of the residuals and squared residuals:\n\n```{r}\nacf(spyARMA$residuals)\npacf(spyARMA$residuals)\nacf(spyARMA$residuals^2)\npacf(spyARMA$residuals^2)\n\n#install.packages('FinTS')\nlibrary(FinTS)\nArchTest(spyIn$spyRange)\n#ArchTest(spyARMA$residuals)\n```\n\nBased on the ACF and PACF plots, it seems like an ARCH model of (1) might be the best fit for SPY residual data. An ARCH test of the original range data confirms that there is an ARCH effect in the dataset.\n\n\nQQQ Residuals:\n```{r}\nacf(qqqARMA$residuals)\npacf(qqqARMA$residuals)\nacf(qqqARMA$residuals^2)\npacf(qqqARMA$residuals^2)\n\n#install.packages('FinTS')\nlibrary(FinTS)\nArchTest(qqqIn$qqqRange)\nArchTest(qqqARMA$residuals)\n```\n\n\nIWM Residuals:\n```{r}\nacf(iwmARMA$residuals)\npacf(iwmARMA$residuals)\nacf(iwmARMA$residuals^2)\npacf(iwmARMA$residuals^2)\n\n#install.packages('FinTS')\nlibrary(FinTS)\nArchTest(iwmIn$iwmRange)\nArchTest(iwmARMA$residuals)\n```\n\n<h2> Find ARCH or GARCH Model by looking at squared residuals and returns of each model. </h2>\n\n\n<h2> Ljung box tests and model diagnostics for each model </h2>\n\n\n<h2>  Writing out the final equations of the model </h2>\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":true,"code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true,"format-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["styles.css"],"toc":true,"output-file":"Financial Time Series Models (ARCH GARCH).html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.3.450","theme":"sandstone","title":"Financial Time Series Models (ARCH GARCH)","code-summary":"Show Code"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}