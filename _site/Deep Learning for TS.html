<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Corwin Dark - Deep Learning for TS</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Corwin Dark</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html" rel="" target="">
 <span class="menu-text">About Me</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Introduction.html" rel="" target="">
 <span class="menu-text">Introduction</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Data Sources.html" rel="" target="">
 <span class="menu-text">Data Sources</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Data Visualization.html" rel="" target="">
 <span class="menu-text">Data Visualization</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Exploratory Data Analysis.html" rel="" target="">
 <span class="menu-text">Exploratory Data Analysis</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./ARMA ARIMA SARIMA Models.html" rel="" target="">
 <span class="menu-text">ARMA ARIMA SARIMA MODELS</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./ARIMAX SARIMAX VAR.html" rel="" target="">
 <span class="menu-text">ARIMAX SARIMAX VAR</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Financial Time Series Models (ARCH GARCH).html" rel="" target="">
 <span class="menu-text">Financial Time Series Models (ARCH GARCH)</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./Deep Learning for TS.html" rel="" target="" aria-current="page">
 <span class="menu-text">Deep Learning for TS</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Conclusions.html" rel="" target="">
 <span class="menu-text">Conclusions</span></a>
  </li>  
  <li class="dropdown-header">
 <span class="menu-text">dv.qmd</span></li>
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#declare-useful-functions" id="toc-declare-useful-functions" class="nav-link active" data-scroll-target="#declare-useful-functions">Declare Useful Functions</a></li>
  <li><a href="#read-in-data" id="toc-read-in-data" class="nav-link" data-scroll-target="#read-in-data">Read in Data</a></li>
  <li><a href="#normalize" id="toc-normalize" class="nav-link" data-scroll-target="#normalize">Normalize</a></li>
  <li><a href="#fit-helper-function-to-create-data-in-desired-format" id="toc-fit-helper-function-to-create-data-in-desired-format" class="nav-link" data-scroll-target="#fit-helper-function-to-create-data-in-desired-format">Fit Helper Function to Create Data in Desired Format</a></li>
  <li><a href="#fit-gru" id="toc-fit-gru" class="nav-link" data-scroll-target="#fit-gru">Fit GRU</a></li>
  <li><a href="#fit-rnn" id="toc-fit-rnn" class="nav-link" data-scroll-target="#fit-rnn">Fit RNN</a></li>
  <li><a href="#fit-lstm" id="toc-fit-lstm" class="nav-link" data-scroll-target="#fit-lstm">Fit LSTM</a></li>
  <li><a href="#comparing-results-of-deep-learning-models" id="toc-comparing-results-of-deep-learning-models" class="nav-link" data-scroll-target="#comparing-results-of-deep-learning-models">Comparing Results of Deep Learning Models</a></li>
  <li><a href="#comparing-deep-learning-and-traditional-ts-models" id="toc-comparing-deep-learning-and-traditional-ts-models" class="nav-link" data-scroll-target="#comparing-deep-learning-and-traditional-ts-models">Comparing Deep Learning and Traditional TS Models</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Deep Learning for TS</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="cell" data-execution_count="1">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras.models <span class="im">import</span> Sequential</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras <span class="im">import</span> layers</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras.optimizers <span class="im">import</span> RMSprop</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> subprocess</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os </span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> install(name):</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    subprocess.call([sys.executable, <span class="st">'-m'</span>, <span class="st">'pip'</span>, <span class="st">'install'</span>, name])</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co">#install('yfinance')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>WARNING:tensorflow:From C:\Users\corwi\AppData\Local\Programs\Python\Python310\lib\site-packages\keras\src\losses.py:2976: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.
</code></pre>
</div>
</div>
<section id="declare-useful-functions" class="level2">
<h2 class="anchored" data-anchor-id="declare-useful-functions">Declare Useful Functions</h2>
<div class="cell" data-execution_count="2">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> history_plot(history):</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    FS<span class="op">=</span><span class="dv">18</span>   <span class="co">#FONT SIZE</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># PLOTTING THE TRAINING AND VALIDATION LOSS </span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    history_dict <span class="op">=</span> history.history</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    loss_values <span class="op">=</span> history_dict[<span class="st">"loss"</span>]</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    val_loss_values <span class="op">=</span> history_dict[<span class="st">"val_loss"</span>]</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    epochs <span class="op">=</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(loss_values) <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    plt.plot(epochs, loss_values, <span class="st">"bo"</span>, label<span class="op">=</span><span class="st">"Training loss"</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    plt.plot(epochs, val_loss_values, <span class="st">"b"</span>, label<span class="op">=</span><span class="st">"Validation loss"</span>)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">"Training and validation loss"</span>)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">"Epochs"</span>)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">"Loss"</span>)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    plt.legend()</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="read-in-data" class="level2">
<h2 class="anchored" data-anchor-id="read-in-data">Read in Data</h2>
<div class="cell" data-execution_count="3">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> yfinance <span class="im">as</span> yf</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>spy <span class="op">=</span> yf.download(<span class="st">'SPY'</span>,start <span class="op">=</span> <span class="st">"2021-01-01"</span>, end <span class="op">=</span> <span class="st">"2023-09-30"</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>iwm <span class="op">=</span> yf.download(<span class="st">'QQQ'</span>,start <span class="op">=</span> <span class="st">"2021-01-01"</span>, end <span class="op">=</span> <span class="st">"2023-09-30"</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>qqq <span class="op">=</span> yf.download(<span class="st">'IWM'</span>,start <span class="op">=</span> <span class="st">"2021-01-01"</span>, end <span class="op">=</span> <span class="st">"2023-09-30"</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>spyRange <span class="op">=</span> (spy[<span class="st">'High'</span>] <span class="op">-</span> spy[<span class="st">'Low'</span>]) <span class="op">/</span> spy[<span class="st">'Close'</span>]</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>iwmRange <span class="op">=</span> (iwm[<span class="st">'High'</span>] <span class="op">-</span> iwm[<span class="st">'Low'</span>]) <span class="op">/</span> iwm[<span class="st">'Close'</span>]</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>qqqRange <span class="op">=</span> (qqq[<span class="st">'High'</span>] <span class="op">-</span> qqq[<span class="st">'Low'</span>]) <span class="op">/</span> qqq[<span class="st">'Close'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[*********************100%%**********************]  1 of 1 completed
[*********************100%%**********************]  1 of 1 completed
[*********************100%%**********************]  1 of 1 completed</code></pre>
</div>
</div>
</section>
<section id="normalize" class="level2">
<h2 class="anchored" data-anchor-id="normalize">Normalize</h2>
<div class="cell" data-execution_count="4">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Slice training set</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>spy_train <span class="op">=</span> pd.DataFrame( spyRange[<span class="bu">range</span>(<span class="dv">0</span>,<span class="dv">490</span>)] )</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>spy_train <span class="op">=</span> spy_train.reset_index(drop <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Slice validation set</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>spy_val <span class="op">=</span>  pd.DataFrame( spyRange[<span class="bu">range</span>(<span class="dv">490</span>,<span class="dv">590</span>)] )</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>spy_val <span class="op">=</span> spy_val.reset_index(drop <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Slice test set</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>spy_test <span class="op">=</span>  pd.DataFrame( spyRange[<span class="bu">range</span>(<span class="dv">590</span>,<span class="dv">690</span>)] )</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>spy_test <span class="op">=</span> spy_test.reset_index(drop <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Save training normalization to use on test and validation sets</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>spy_train_mean <span class="op">=</span> spy_train.mean()</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>spy_train_std <span class="op">=</span> spy_train.std()</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalize</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>spy_train<span class="op">=</span>(spy_train<span class="op">-</span>spy_train_mean)<span class="op">/</span>spy_train_std</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>spy_val<span class="op">=</span>(spy_val<span class="op">-</span>spy_train_mean)<span class="op">/</span>spy_train_std</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>spy_test<span class="op">=</span>(spy_test<span class="op">-</span>spy_train_mean)<span class="op">/</span>spy_train_std</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="fit-helper-function-to-create-data-in-desired-format" class="level2">
<h2 class="anchored" data-anchor-id="fit-helper-function-to-create-data-in-desired-format">Fit Helper Function to Create Data in Desired Format</h2>
<div class="cell" data-execution_count="5">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># code from lab</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> form_arrays(x,lookback<span class="op">=</span><span class="dv">3</span>,delay<span class="op">=</span><span class="dv">1</span>,step<span class="op">=</span><span class="dv">1</span>,feature_columns<span class="op">=</span>[<span class="dv">0</span>],target_columns<span class="op">=</span>[<span class="dv">0</span>],unique<span class="op">=</span><span class="va">False</span>,verbose<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># verbose=True --&gt; report and plot for debugging</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># unique=True --&gt; don't re-sample:</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># x1,x2,x3 --&gt; x4 then x4,x5,x6 --&gt; x7 instead of x2,x3,x4 --&gt; x5</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># initialize</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    i_start<span class="op">=</span><span class="dv">0</span><span class="op">;</span> count<span class="op">=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># initialize output arrays with samples</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    x_out<span class="op">=</span>[]</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    y_out<span class="op">=</span>[]</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># sequentially build mini-batch samples</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> i_start<span class="op">+</span>lookback<span class="op">+</span>delay<span class="op">&lt;</span> x.shape[<span class="dv">0</span>]:</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># define index bounds</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>        i_stop<span class="op">=</span>i_start<span class="op">+</span>lookback</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>        i_pred<span class="op">=</span>i_stop<span class="op">+</span>delay</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>        <span class="co"># report if desired</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> verbose <span class="kw">and</span> count<span class="op">&lt;</span><span class="dv">2</span>: <span class="bu">print</span>(<span class="st">"indice range:"</span>,i_start,i_stop,<span class="st">"--&gt;"</span>, i_pred)</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>        <span class="co"># define arrays:</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># method-1: buggy due to indexing from left</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>        <span class="co"># numpy's slicing --&gt; start:stop:step</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>        <span class="co"># xtmp=x[i_start:i_stop+1:steps]</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>        <span class="co"># method-2: non-vectorized but cleaner</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>        indices_to_keep<span class="op">=</span>[]<span class="op">;</span> j<span class="op">=</span>i_stop</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> j<span class="op">&gt;=</span>i_start:</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>            indices_to_keep.append(j)</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>            j<span class="op">=</span>j<span class="op">-</span>step</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>        <span class="co"># create mini-batch sample</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>        xtmp<span class="op">=</span>x.iloc[indices_to_keep,:] <span class="co"># isolate relevant indices</span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>        xtmp<span class="op">=</span>xtmp.iloc[:,feature_columns] <span class="co"># isolate desire features</span></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>        ytmp<span class="op">=</span>x.iloc[i_pred,target_columns]</span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>        x_out.append(xtmp)<span class="op">;</span> y_out.append(ytmp)<span class="op">;</span></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>        <span class="co"># report if desired</span></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> verbose <span class="kw">and</span> count<span class="op">&lt;</span><span class="dv">2</span>: <span class="bu">print</span>(xtmp, <span class="st">"--&gt;"</span>,ytmp)</span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> verbose <span class="kw">and</span> count<span class="op">&lt;</span><span class="dv">2</span>: <span class="bu">print</span>(<span class="st">"shape:"</span>,xtmp.shape, <span class="st">"--&gt;"</span>,ytmp.shape)</span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> verbose <span class="kw">and</span> count<span class="op">&lt;</span><span class="dv">2</span>:</span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>            fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>            ax.plot(x,<span class="st">'b-'</span>)</span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>            ax.plot(x,<span class="st">'bx'</span>)</span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>            ax.plot(indices_to_keep,xtmp,<span class="st">'go'</span>)</span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>            ax.plot(i_pred<span class="op">*</span>np.ones(<span class="bu">len</span>(target_columns)),ytmp,<span class="st">'ro'</span>)</span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>            plt.show()</span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>        <span class="co"># UPDATE START POINT</span></span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> unique: i_start<span class="op">+=</span>lookback</span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a>        i_start<span class="op">+=</span><span class="dv">1</span><span class="op">;</span> count<span class="op">+=</span><span class="dv">1</span></span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.array(x_out),np.array(y_out)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Diagnostic plotting functions from the lab</p>
<div class="cell" data-execution_count="6">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error,mean_absolute_percentage_error,mean_absolute_error</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># UTILITY FUNCTION</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> regression_report(yt,ytp,yv,yvp):</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"---------- Regression report ----------"</span>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"TRAINING:"</span>)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">" MSE:"</span>,mean_squared_error(yt,ytp))</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">" MAE:"</span>,mean_absolute_error(yt,ytp))</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(" MAPE:",mean_absolute_percentage_error(Yt,Ytp))</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># PARITY PLOT</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    ax.plot(yt,ytp,<span class="st">'ro'</span>)</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    ax.plot(yt,yt,<span class="st">'b-'</span>)</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    ax.<span class="bu">set</span>(xlabel<span class="op">=</span><span class="st">'y_data'</span>, ylabel<span class="op">=</span><span class="st">'y_predicted'</span>,</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">'Training data parity plot (line y=x represents a perfect fit)'</span>)</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># PLOT PART OF THE PREDICTED TIME-SERIES</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>    frac_plot<span class="op">=</span><span class="fl">1.0</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>    upper<span class="op">=</span><span class="bu">int</span>(frac_plot<span class="op">*</span>yt.shape[<span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(int(0.5*yt.shape[0]))</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>    ax.plot(yt[<span class="dv">0</span>:upper],<span class="st">'b-'</span>)</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>    ax.plot(ytp[<span class="dv">0</span>:upper],<span class="st">'r-'</span>,alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>    ax.plot(ytp[<span class="dv">0</span>:upper],<span class="st">'ro'</span>,alpha<span class="op">=</span><span class="fl">0.25</span>)</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>    ax.<span class="bu">set</span>(xlabel<span class="op">=</span><span class="st">'index'</span>, ylabel<span class="op">=</span><span class="st">'y(t (blue=actual &amp; red=prediction)'</span>, title<span class="op">=</span><span class="st">'Training: Time-series prediction'</span>)</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"VALIDATION:"</span>)</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">" MSE:"</span>,mean_squared_error(yv,yvp))</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">" MAE:"</span>,mean_absolute_error(yv,yvp))</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(" MAPE:",mean_absolute_percentage_error(Yt,Ytp))</span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># PARITY PLOT</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>    ax.plot(yv,yvp,<span class="st">'ro'</span>)</span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>    ax.plot(yv,yv,<span class="st">'b-'</span>)</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>    ax.<span class="bu">set</span>(xlabel<span class="op">=</span><span class="st">'y_data'</span>, ylabel<span class="op">=</span><span class="st">'y_predicted'</span>,</span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">'Validation data parity plot (line y=x represents a perfect fit)'</span>)</span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>    <span class="co"># PLOT PART OF THE PREDICTED TIME-SERIES</span></span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>    upper<span class="op">=</span><span class="bu">int</span>(frac_plot<span class="op">*</span>yv.shape[<span class="dv">0</span>])</span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>    ax.plot(yv[<span class="dv">0</span>:upper],<span class="st">'b-'</span>)</span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>    ax.plot(yvp[<span class="dv">0</span>:upper],<span class="st">'r-'</span>,alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>    ax.plot(yvp[<span class="dv">0</span>:upper],<span class="st">'ro'</span>,alpha<span class="op">=</span><span class="fl">0.25</span>)</span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>    ax.<span class="bu">set</span>(xlabel<span class="op">=</span><span class="st">'index'</span>, ylabel<span class="op">=</span><span class="st">'y(t) (blue=actual &amp; red=prediction)'</span>, title<span class="op">=</span><span class="st">'Validation: Time-series prediction'</span>)</span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Use function to reformat data. Train will be 1-490, Validation 491-590, and Test 591-690</p>
<div class="cell" data-execution_count="7">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#spy_train = generator(spyRange, lookback=lookback, delay=delay, min_index=0, max_index=489, shuffle=True, step=step, batch_size=batch_size)</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co">#spy_val = generator(spyRange, lookback=lookback, delay=delay, min_index=490, max_index=589, step=step, batch_size=batch_size)</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co">#spy_test = generator(spyRange, lookback=lookback, delay=delay, min_index=590, max_index=690, step=step, batch_size=batch_size)</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>L <span class="op">=</span> <span class="dv">30</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>S <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>D <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>batch_size <span class="op">=</span> <span class="dv">10</span> </span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>spy_x,spy_y<span class="op">=</span>form_arrays(spy_train,lookback<span class="op">=</span>L,delay<span class="op">=</span>D,step<span class="op">=</span>S,unique<span class="op">=</span><span class="va">False</span>,verbose<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>spy_val_x, spy_val_y <span class="op">=</span> form_arrays(spy_val,lookback<span class="op">=</span>L,delay<span class="op">=</span>D,step<span class="op">=</span>S,unique<span class="op">=</span><span class="va">False</span>,verbose<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>indice range: 0 30 --&gt; 31
           0
30 -0.671401
29 -0.885386
28 -0.734102
27 -0.585913
26 -0.212548
25 -1.168214
24 -1.015748
23 -0.973075
22 -0.358360
21 -0.677961
20  0.497549
19  0.548116
18  1.059558
17  0.243034
16  0.998227
15 -0.971943
14  0.294332
13 -0.976559
12 -1.166153
11 -0.404222
10 -0.907305
9  -0.447196
8  -0.729908
7  -0.739743
6  -0.579574
5  -0.785181
4  -0.302614
3  -0.423132
2   0.857734
1  -0.245422
0   1.805622 --&gt; 0   -0.526714
Name: 31, dtype: float64
shape: (31, 1) --&gt; (1,)
indice range: 1 31 --&gt; 32
           0
31 -0.526714
30 -0.671401
29 -0.885386
28 -0.734102
27 -0.585913
26 -0.212548
25 -1.168214
24 -1.015748
23 -0.973075
22 -0.358360
21 -0.677961
20  0.497549
19  0.548116
18  1.059558
17  0.243034
16  0.998227
15 -0.971943
14  0.294332
13 -0.976559
12 -1.166153
11 -0.404222
10 -0.907305
9  -0.447196
8  -0.729908
7  -0.739743
6  -0.579574
5  -0.785181
4  -0.302614
3  -0.423132
2   0.857734
1  -0.245422 --&gt; 0   -0.821283
Name: 32, dtype: float64
shape: (31, 1) --&gt; (1,)
indice range: 0 30 --&gt; 31
           0
30 -0.287952
29 -0.233536
28  0.467138
27 -0.636803
26  0.401771
25  0.651644
24 -0.507879
23  1.045176
22 -0.734373
21  0.055444
20  0.157378
19 -0.405520
18 -0.339190
17  0.188520
16  1.383184
15 -0.716225
14  0.161146
13  1.045477
12 -0.383336
11 -0.031053
10  0.548781
9  -0.587335
8  -0.105081
7   1.954741
6  -0.216591
5  -0.303154
4   0.070543
3   0.055478
2   0.595663
1   1.097443
0   1.755203 --&gt; 0   -0.23042
Name: 31, dtype: float64
shape: (31, 1) --&gt; (1,)
indice range: 1 31 --&gt; 32
           0
31 -0.230420
30 -0.287952
29 -0.233536
28  0.467138
27 -0.636803
26  0.401771
25  0.651644
24 -0.507879
23  1.045176
22 -0.734373
21  0.055444
20  0.157378
19 -0.405520
18 -0.339190
17  0.188520
16  1.383184
15 -0.716225
14  0.161146
13  1.045477
12 -0.383336
11 -0.031053
10  0.548781
9  -0.587335
8  -0.105081
7   1.954741
6  -0.216591
5  -0.303154
4   0.070543
3   0.055478
2   0.595663
1   1.097443 --&gt; 0    0.020882
Name: 32, dtype: float64
shape: (31, 1) --&gt; (1,)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Deep Learning for TS_files/figure-html/cell-8-output-2.png" width="569" height="413"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="Deep Learning for TS_files/figure-html/cell-8-output-3.png" width="569" height="413"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="Deep Learning for TS_files/figure-html/cell-8-output-4.png" width="582" height="411"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="Deep Learning for TS_files/figure-html/cell-8-output-5.png" width="582" height="411"></p>
</div>
</div>
<p>Reshape data</p>
<div class="cell" data-execution_count="8">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># RESHAPE INTO A DATA FRAME</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>spy_t_1 <span class="op">=</span> spy_x.reshape(spy_x.shape[<span class="dv">0</span>],spy_x.shape[<span class="dv">1</span>]<span class="op">*</span>spy_x.shape[<span class="dv">2</span>])</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>spy_v_1 <span class="op">=</span> spy_val_x.reshape(spy_val_x.shape[<span class="dv">0</span>],spy_val_x.shape[<span class="dv">1</span>]<span class="op">*</span>spy_val_x.shape[<span class="dv">2</span>])</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>input_shape <span class="op">=</span> (spy_t_1.shape[<span class="dv">1</span>],)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>rnn_input_shape <span class="op">=</span> (spy_x.shape[<span class="dv">1</span>], spy_x.shape[<span class="dv">2</span>])</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co"># NEW SIZES</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"train: "</span>, spy_x.shape,<span class="st">"--&gt;"</span>,spy_t_1.shape)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"validation: "</span>, spy_val_x.shape,<span class="st">"--&gt;"</span>,spy_v_1.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>train:  (459, 31, 1) --&gt; (459, 31)
validation:  (69, 31, 1) --&gt; (69, 31)</code></pre>
</div>
</div>
</section>
<section id="fit-gru" class="level2">
<h2 class="anchored" data-anchor-id="fit-gru">Fit GRU</h2>
<p>No regularlization</p>
<div class="cell" data-execution_count="9">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras.models <span class="im">import</span> Sequential</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras <span class="im">import</span> layers</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras.optimizers <span class="im">import</span> RMSprop</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co"># create a sequential model once again</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Sequential()</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>model.add(layers.Dense(<span class="dv">32</span>, activation<span class="op">=</span><span class="st">'relu'</span>,input_shape<span class="op">=</span>rnn_input_shape))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co"># This layer is the recurent layer, which returns all previous data</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>model.add(layers.GRU(<span class="dv">32</span>, dropout<span class="op">=</span><span class="fl">0.1</span>, recurrent_dropout<span class="op">=</span><span class="fl">0.5</span>, return_sequences<span class="op">=</span><span class="va">True</span>))</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="co"># layer that reads the recurent layer</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>model.add(layers.GRU(<span class="dv">64</span>, activation<span class="op">=</span><span class="st">'relu'</span>, dropout<span class="op">=</span><span class="fl">0.1</span>, recurrent_dropout<span class="op">=</span><span class="fl">0.5</span>))</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>model.add(layers.Dense(<span class="dv">1</span>))</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span>RMSprop(), loss<span class="op">=</span><span class="st">'mae'</span>)</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>history_spy_1_noreg <span class="op">=</span> model.fit(x <span class="op">=</span> spy_x, y <span class="op">=</span> spy_y, steps_per_epoch<span class="op">=</span><span class="dv">20</span>, epochs<span class="op">=</span><span class="dv">30</span>, validation_data<span class="op">=</span> (spy_val_x, spy_val_y), validation_steps<span class="op">=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>WARNING:tensorflow:From C:\Users\corwi\AppData\Local\Programs\Python\Python310\lib\site-packages\keras\src\backend.py:873: The name tf.get_default_graph is deprecated. Please use tf.compat.v1.get_default_graph instead.

Epoch 1/30
WARNING:tensorflow:From C:\Users\corwi\AppData\Local\Programs\Python\Python310\lib\site-packages\keras\src\utils\tf_utils.py:492: The name tf.ragged.RaggedTensorValue is deprecated. Please use tf.compat.v1.ragged.RaggedTensorValue instead.

 1/20 [&gt;.............................] - ETA: 1:20 - loss: 0.5548 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.7631   7/20 [=========&gt;....................] - ETA: 0s - loss: 0.768610/20 [==============&gt;...............] - ETA: 0s - loss: 0.769413/20 [==================&gt;...........] - ETA: 0s - loss: 0.777416/20 [=======================&gt;......] - ETA: 0s - loss: 0.772219/20 [===========================&gt;..] - ETA: 0s - loss: 0.752620/20 [==============================] - 5s 47ms/step - loss: 0.7395 - val_loss: 0.5307
Epoch 2/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.9408 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.7476 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.726210/20 [==============&gt;...............] - ETA: 0s - loss: 0.745513/20 [==================&gt;...........] - ETA: 0s - loss: 0.724916/20 [=======================&gt;......] - ETA: 0s - loss: 0.732620/20 [==============================] - ETA: 0s - loss: 0.725520/20 [==============================] - 0s 21ms/step - loss: 0.7255 - val_loss: 0.5363
Epoch 3/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5560 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.7118 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.739410/20 [==============&gt;...............] - ETA: 0s - loss: 0.708413/20 [==================&gt;...........] - ETA: 0s - loss: 0.719016/20 [=======================&gt;......] - ETA: 0s - loss: 0.719119/20 [===========================&gt;..] - ETA: 0s - loss: 0.731120/20 [==============================] - 0s 21ms/step - loss: 0.7280 - val_loss: 0.5508
Epoch 4/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6548 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.7277 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.698110/20 [==============&gt;...............] - ETA: 0s - loss: 0.696513/20 [==================&gt;...........] - ETA: 0s - loss: 0.727816/20 [=======================&gt;......] - ETA: 0s - loss: 0.713319/20 [===========================&gt;..] - ETA: 0s - loss: 0.726020/20 [==============================] - 0s 21ms/step - loss: 0.7197 - val_loss: 0.5784
Epoch 5/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 1.0293 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.8250 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.767110/20 [==============&gt;...............] - ETA: 0s - loss: 0.739313/20 [==================&gt;...........] - ETA: 0s - loss: 0.723916/20 [=======================&gt;......] - ETA: 0s - loss: 0.726119/20 [===========================&gt;..] - ETA: 0s - loss: 0.721520/20 [==============================] - 0s 21ms/step - loss: 0.7194 - val_loss: 0.5481
Epoch 6/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5804 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.7102 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.726810/20 [==============&gt;...............] - ETA: 0s - loss: 0.719913/20 [==================&gt;...........] - ETA: 0s - loss: 0.731716/20 [=======================&gt;......] - ETA: 0s - loss: 0.722919/20 [===========================&gt;..] - ETA: 0s - loss: 0.719520/20 [==============================] - 0s 21ms/step - loss: 0.7121 - val_loss: 0.5702
Epoch 7/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.4704 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.7263 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.726910/20 [==============&gt;...............] - ETA: 0s - loss: 0.720013/20 [==================&gt;...........] - ETA: 0s - loss: 0.754716/20 [=======================&gt;......] - ETA: 0s - loss: 0.751319/20 [===========================&gt;..] - ETA: 0s - loss: 0.724920/20 [==============================] - 0s 22ms/step - loss: 0.7126 - val_loss: 0.5774
Epoch 8/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.4888 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.6494 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.670810/20 [==============&gt;...............] - ETA: 0s - loss: 0.685213/20 [==================&gt;...........] - ETA: 0s - loss: 0.697116/20 [=======================&gt;......] - ETA: 0s - loss: 0.705019/20 [===========================&gt;..] - ETA: 0s - loss: 0.697520/20 [==============================] - 0s 21ms/step - loss: 0.7002 - val_loss: 0.6068
Epoch 9/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.7500 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.6690 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.694810/20 [==============&gt;...............] - ETA: 0s - loss: 0.647613/20 [==================&gt;...........] - ETA: 0s - loss: 0.683117/20 [========================&gt;.....] - ETA: 0s - loss: 0.681920/20 [==============================] - ETA: 0s - loss: 0.678820/20 [==============================] - 0s 21ms/step - loss: 0.6788 - val_loss: 0.6124
Epoch 10/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6391 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.6329 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.675510/20 [==============&gt;...............] - ETA: 0s - loss: 0.676814/20 [====================&gt;.........] - ETA: 0s - loss: 0.670817/20 [========================&gt;.....] - ETA: 0s - loss: 0.660520/20 [==============================] - ETA: 0s - loss: 0.663320/20 [==============================] - 0s 21ms/step - loss: 0.6633 - val_loss: 0.5173
Epoch 11/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.4952 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.6536 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.679811/20 [===============&gt;..............] - ETA: 0s - loss: 0.639414/20 [====================&gt;.........] - ETA: 0s - loss: 0.611417/20 [========================&gt;.....] - ETA: 0s - loss: 0.629920/20 [==============================] - ETA: 0s - loss: 0.636620/20 [==============================] - 0s 21ms/step - loss: 0.6366 - val_loss: 0.5933
Epoch 12/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.7076 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.5998 8/20 [===========&gt;..................] - ETA: 0s - loss: 0.671611/20 [===============&gt;..............] - ETA: 0s - loss: 0.660914/20 [====================&gt;.........] - ETA: 0s - loss: 0.636917/20 [========================&gt;.....] - ETA: 0s - loss: 0.651320/20 [==============================] - 0s 21ms/step - loss: 0.6386 - val_loss: 0.5496
Epoch 13/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.9449 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.6884 8/20 [===========&gt;..................] - ETA: 0s - loss: 0.674911/20 [===============&gt;..............] - ETA: 0s - loss: 0.679515/20 [=====================&gt;........] - ETA: 0s - loss: 0.648519/20 [===========================&gt;..] - ETA: 0s - loss: 0.645920/20 [==============================] - 0s 21ms/step - loss: 0.6422 - val_loss: 0.5310
Epoch 14/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6919 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.6145 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.660410/20 [==============&gt;...............] - ETA: 0s - loss: 0.672913/20 [==================&gt;...........] - ETA: 0s - loss: 0.651917/20 [========================&gt;.....] - ETA: 0s - loss: 0.647820/20 [==============================] - ETA: 0s - loss: 0.634420/20 [==============================] - 0s 22ms/step - loss: 0.6344 - val_loss: 0.5129
Epoch 15/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5514 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.5519 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.578910/20 [==============&gt;...............] - ETA: 0s - loss: 0.608413/20 [==================&gt;...........] - ETA: 0s - loss: 0.612817/20 [========================&gt;.....] - ETA: 0s - loss: 0.603220/20 [==============================] - ETA: 0s - loss: 0.628020/20 [==============================] - 0s 21ms/step - loss: 0.6280 - val_loss: 0.5253
Epoch 16/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5911 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.6539 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.610710/20 [==============&gt;...............] - ETA: 0s - loss: 0.624213/20 [==================&gt;...........] - ETA: 0s - loss: 0.620316/20 [=======================&gt;......] - ETA: 0s - loss: 0.633620/20 [==============================] - ETA: 0s - loss: 0.618620/20 [==============================] - 0s 21ms/step - loss: 0.6186 - val_loss: 0.5353
Epoch 17/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.4749 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.6246 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.611010/20 [==============&gt;...............] - ETA: 0s - loss: 0.617713/20 [==================&gt;...........] - ETA: 0s - loss: 0.624816/20 [=======================&gt;......] - ETA: 0s - loss: 0.637419/20 [===========================&gt;..] - ETA: 0s - loss: 0.639520/20 [==============================] - 0s 21ms/step - loss: 0.6260 - val_loss: 0.5501
Epoch 18/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.4490 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.6520 8/20 [===========&gt;..................] - ETA: 0s - loss: 0.627211/20 [===============&gt;..............] - ETA: 0s - loss: 0.606214/20 [====================&gt;.........] - ETA: 0s - loss: 0.619717/20 [========================&gt;.....] - ETA: 0s - loss: 0.606220/20 [==============================] - ETA: 0s - loss: 0.616420/20 [==============================] - 0s 21ms/step - loss: 0.6164 - val_loss: 0.6235
Epoch 19/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6379 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.5538 9/20 [============&gt;.................] - ETA: 0s - loss: 0.605813/20 [==================&gt;...........] - ETA: 0s - loss: 0.609916/20 [=======================&gt;......] - ETA: 0s - loss: 0.625519/20 [===========================&gt;..] - ETA: 0s - loss: 0.623520/20 [==============================] - 0s 21ms/step - loss: 0.6211 - val_loss: 0.5644
Epoch 20/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.4737 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.6308 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.658810/20 [==============&gt;...............] - ETA: 0s - loss: 0.650614/20 [====================&gt;.........] - ETA: 0s - loss: 0.616117/20 [========================&gt;.....] - ETA: 0s - loss: 0.615120/20 [==============================] - ETA: 0s - loss: 0.608420/20 [==============================] - 0s 21ms/step - loss: 0.6084 - val_loss: 0.5442
Epoch 21/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6783 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.6733 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.623510/20 [==============&gt;...............] - ETA: 0s - loss: 0.636613/20 [==================&gt;...........] - ETA: 0s - loss: 0.626416/20 [=======================&gt;......] - ETA: 0s - loss: 0.623219/20 [===========================&gt;..] - ETA: 0s - loss: 0.618920/20 [==============================] - 0s 22ms/step - loss: 0.6181 - val_loss: 0.6058
Epoch 22/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.4851 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.5952 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.576210/20 [==============&gt;...............] - ETA: 0s - loss: 0.590014/20 [====================&gt;.........] - ETA: 0s - loss: 0.592117/20 [========================&gt;.....] - ETA: 0s - loss: 0.601320/20 [==============================] - ETA: 0s - loss: 0.613320/20 [==============================] - 0s 21ms/step - loss: 0.6133 - val_loss: 0.6396
Epoch 23/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5522 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.6427 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.610410/20 [==============&gt;...............] - ETA: 0s - loss: 0.613013/20 [==================&gt;...........] - ETA: 0s - loss: 0.571717/20 [========================&gt;.....] - ETA: 0s - loss: 0.555320/20 [==============================] - ETA: 0s - loss: 0.599620/20 [==============================] - 0s 21ms/step - loss: 0.5996 - val_loss: 0.6000
Epoch 24/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5717 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.6725 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.673510/20 [==============&gt;...............] - ETA: 0s - loss: 0.658813/20 [==================&gt;...........] - ETA: 0s - loss: 0.643816/20 [=======================&gt;......] - ETA: 0s - loss: 0.629119/20 [===========================&gt;..] - ETA: 0s - loss: 0.606020/20 [==============================] - 0s 22ms/step - loss: 0.6014 - val_loss: 0.5293
Epoch 25/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.4610 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.5530 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.619910/20 [==============&gt;...............] - ETA: 0s - loss: 0.604513/20 [==================&gt;...........] - ETA: 0s - loss: 0.605216/20 [=======================&gt;......] - ETA: 0s - loss: 0.613119/20 [===========================&gt;..] - ETA: 0s - loss: 0.598720/20 [==============================] - 0s 21ms/step - loss: 0.6106 - val_loss: 0.7323
Epoch 26/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6926 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.6216 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.608611/20 [===============&gt;..............] - ETA: 0s - loss: 0.592214/20 [====================&gt;.........] - ETA: 0s - loss: 0.600218/20 [==========================&gt;...] - ETA: 0s - loss: 0.612520/20 [==============================] - 0s 21ms/step - loss: 0.6134 - val_loss: 0.5173
Epoch 27/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6242 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.6433 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.608810/20 [==============&gt;...............] - ETA: 0s - loss: 0.631013/20 [==================&gt;...........] - ETA: 0s - loss: 0.616216/20 [=======================&gt;......] - ETA: 0s - loss: 0.635319/20 [===========================&gt;..] - ETA: 0s - loss: 0.621520/20 [==============================] - 0s 21ms/step - loss: 0.6191 - val_loss: 0.5556
Epoch 28/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.4803 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.5302 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.502811/20 [===============&gt;..............] - ETA: 0s - loss: 0.524914/20 [====================&gt;.........] - ETA: 0s - loss: 0.577417/20 [========================&gt;.....] - ETA: 0s - loss: 0.584620/20 [==============================] - ETA: 0s - loss: 0.593520/20 [==============================] - 0s 21ms/step - loss: 0.5935 - val_loss: 0.6026
Epoch 29/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6564 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.7239 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.672510/20 [==============&gt;...............] - ETA: 0s - loss: 0.649513/20 [==================&gt;...........] - ETA: 0s - loss: 0.602916/20 [=======================&gt;......] - ETA: 0s - loss: 0.585019/20 [===========================&gt;..] - ETA: 0s - loss: 0.602020/20 [==============================] - 0s 21ms/step - loss: 0.5950 - val_loss: 0.5986
Epoch 30/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.3834 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.4578 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.530410/20 [==============&gt;...............] - ETA: 0s - loss: 0.556613/20 [==================&gt;...........] - ETA: 0s - loss: 0.585516/20 [=======================&gt;......] - ETA: 0s - loss: 0.592619/20 [===========================&gt;..] - ETA: 0s - loss: 0.593620/20 [==============================] - 0s 21ms/step - loss: 0.5919 - val_loss: 0.6036</code></pre>
</div>
</div>
<p>Let’s plot results</p>
<div class="cell" data-execution_count="10">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>history_plot(history_spy_1_noreg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="Deep Learning for TS_files/figure-html/cell-11-output-1.png" width="597" height="449"></p>
</div>
</div>
<p>Regularlization</p>
<div class="cell" data-execution_count="11">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras <span class="im">import</span> regularizers</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>L1<span class="op">=</span><span class="dv">0</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>L2<span class="op">=</span><span class="fl">1e-3</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co"># create a sequential model once again</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Sequential()</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>model.add(layers.Dense(<span class="dv">32</span>, activation<span class="op">=</span><span class="st">'relu'</span>,input_shape<span class="op">=</span>rnn_input_shape,kernel_regularizer<span class="op">=</span>regularizers.L1L2(l1<span class="op">=</span>L1, l2<span class="op">=</span>L2)))</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="co"># This layer is the recurent layer, which returns all previous data</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>model.add(layers.GRU(<span class="dv">32</span>, dropout<span class="op">=</span><span class="fl">0.1</span>, recurrent_dropout<span class="op">=</span><span class="fl">0.5</span>, return_sequences<span class="op">=</span><span class="va">True</span>, recurrent_regularizer<span class="op">=</span>regularizers.L1L2(l1<span class="op">=</span>L1, l2<span class="op">=</span>L2)))</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="co"># layer that reads the recurent layer</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>model.add(layers.GRU(<span class="dv">64</span>, activation<span class="op">=</span><span class="st">'relu'</span>, dropout<span class="op">=</span><span class="fl">0.1</span>, recurrent_dropout<span class="op">=</span><span class="fl">0.5</span>,kernel_regularizer<span class="op">=</span>regularizers.L1L2(l1<span class="op">=</span>L1, l2<span class="op">=</span>L2)))</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>model.add(layers.Dense(<span class="dv">1</span>))</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span>RMSprop(), loss<span class="op">=</span><span class="st">'mae'</span>)</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>history_spy_1_reg <span class="op">=</span> model.fit(x <span class="op">=</span> spy_x, y <span class="op">=</span> spy_y, steps_per_epoch<span class="op">=</span><span class="dv">20</span>, epochs<span class="op">=</span><span class="dv">30</span>, validation_data<span class="op">=</span> (spy_val_x, spy_val_y), validation_steps<span class="op">=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 1/30
 1/20 [&gt;.............................] - ETA: 1:19 - loss: 0.7256 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.8191   9/20 [============&gt;.................] - ETA: 0s - loss: 0.831513/20 [==================&gt;...........] - ETA: 0s - loss: 0.829717/20 [========================&gt;.....] - ETA: 0s - loss: 0.823120/20 [==============================] - 5s 38ms/step - loss: 0.8230 - val_loss: 0.6097
Epoch 2/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.8154 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.8212 9/20 [============&gt;.................] - ETA: 0s - loss: 0.798213/20 [==================&gt;...........] - ETA: 0s - loss: 0.814017/20 [========================&gt;.....] - ETA: 0s - loss: 0.797720/20 [==============================] - 0s 19ms/step - loss: 0.7973 - val_loss: 0.6024
Epoch 3/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5025 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.7651 9/20 [============&gt;.................] - ETA: 0s - loss: 0.834913/20 [==================&gt;...........] - ETA: 0s - loss: 0.808417/20 [========================&gt;.....] - ETA: 0s - loss: 0.793420/20 [==============================] - 0s 19ms/step - loss: 0.7918 - val_loss: 0.6123
Epoch 4/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6283 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.7063 9/20 [============&gt;.................] - ETA: 0s - loss: 0.756513/20 [==================&gt;...........] - ETA: 0s - loss: 0.801917/20 [========================&gt;.....] - ETA: 0s - loss: 0.798420/20 [==============================] - 0s 18ms/step - loss: 0.7775 - val_loss: 0.5833
Epoch 5/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.8295 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.7312 9/20 [============&gt;.................] - ETA: 0s - loss: 0.779913/20 [==================&gt;...........] - ETA: 0s - loss: 0.754517/20 [========================&gt;.....] - ETA: 0s - loss: 0.760220/20 [==============================] - 0s 19ms/step - loss: 0.7683 - val_loss: 0.5798
Epoch 6/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6774 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.7210 9/20 [============&gt;.................] - ETA: 0s - loss: 0.746113/20 [==================&gt;...........] - ETA: 0s - loss: 0.769317/20 [========================&gt;.....] - ETA: 0s - loss: 0.762120/20 [==============================] - ETA: 0s - loss: 0.762320/20 [==============================] - 0s 20ms/step - loss: 0.7623 - val_loss: 0.6368
Epoch 7/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.8800 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.7394 8/20 [===========&gt;..................] - ETA: 0s - loss: 0.718212/20 [=================&gt;............] - ETA: 0s - loss: 0.769216/20 [=======================&gt;......] - ETA: 0s - loss: 0.766920/20 [==============================] - ETA: 0s - loss: 0.758720/20 [==============================] - 0s 19ms/step - loss: 0.7587 - val_loss: 0.6096
Epoch 8/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.8067 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.7472 9/20 [============&gt;.................] - ETA: 0s - loss: 0.768112/20 [=================&gt;............] - ETA: 0s - loss: 0.744216/20 [=======================&gt;......] - ETA: 0s - loss: 0.754119/20 [===========================&gt;..] - ETA: 0s - loss: 0.744020/20 [==============================] - 0s 19ms/step - loss: 0.7428 - val_loss: 0.6354
Epoch 9/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.8635 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.6878 8/20 [===========&gt;..................] - ETA: 0s - loss: 0.698211/20 [===============&gt;..............] - ETA: 0s - loss: 0.712515/20 [=====================&gt;........] - ETA: 0s - loss: 0.732818/20 [==========================&gt;...] - ETA: 0s - loss: 0.739820/20 [==============================] - 0s 20ms/step - loss: 0.7350 - val_loss: 0.6368
Epoch 10/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5953 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.7277 8/20 [===========&gt;..................] - ETA: 0s - loss: 0.700711/20 [===============&gt;..............] - ETA: 0s - loss: 0.728214/20 [====================&gt;.........] - ETA: 0s - loss: 0.739718/20 [==========================&gt;...] - ETA: 0s - loss: 0.740220/20 [==============================] - 0s 20ms/step - loss: 0.7258 - val_loss: 0.5796
Epoch 11/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.7831 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.7470 8/20 [===========&gt;..................] - ETA: 0s - loss: 0.791411/20 [===============&gt;..............] - ETA: 0s - loss: 0.782114/20 [====================&gt;.........] - ETA: 0s - loss: 0.725417/20 [========================&gt;.....] - ETA: 0s - loss: 0.704620/20 [==============================] - ETA: 0s - loss: 0.700020/20 [==============================] - 0s 21ms/step - loss: 0.7000 - val_loss: 0.6170
Epoch 12/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.7660 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.6865 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.675610/20 [==============&gt;...............] - ETA: 0s - loss: 0.694913/20 [==================&gt;...........] - ETA: 0s - loss: 0.714816/20 [=======================&gt;......] - ETA: 0s - loss: 0.698819/20 [===========================&gt;..] - ETA: 0s - loss: 0.696820/20 [==============================] - 0s 21ms/step - loss: 0.6897 - val_loss: 0.5914
Epoch 13/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.7686 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.6387 8/20 [===========&gt;..................] - ETA: 0s - loss: 0.639111/20 [===============&gt;..............] - ETA: 0s - loss: 0.655314/20 [====================&gt;.........] - ETA: 0s - loss: 0.684317/20 [========================&gt;.....] - ETA: 0s - loss: 0.685220/20 [==============================] - 0s 21ms/step - loss: 0.6655 - val_loss: 0.5706
Epoch 14/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6808 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.6649 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.648810/20 [==============&gt;...............] - ETA: 0s - loss: 0.703513/20 [==================&gt;...........] - ETA: 0s - loss: 0.673216/20 [=======================&gt;......] - ETA: 0s - loss: 0.652019/20 [===========================&gt;..] - ETA: 0s - loss: 0.654620/20 [==============================] - 0s 21ms/step - loss: 0.6519 - val_loss: 0.5858
Epoch 15/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6169 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.6298 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.625710/20 [==============&gt;...............] - ETA: 0s - loss: 0.617213/20 [==================&gt;...........] - ETA: 0s - loss: 0.643316/20 [=======================&gt;......] - ETA: 0s - loss: 0.651319/20 [===========================&gt;..] - ETA: 0s - loss: 0.650020/20 [==============================] - 0s 21ms/step - loss: 0.6487 - val_loss: 0.5604
Epoch 16/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5128 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.7176 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.731111/20 [===============&gt;..............] - ETA: 0s - loss: 0.647414/20 [====================&gt;.........] - ETA: 0s - loss: 0.660917/20 [========================&gt;.....] - ETA: 0s - loss: 0.655120/20 [==============================] - ETA: 0s - loss: 0.655120/20 [==============================] - 0s 21ms/step - loss: 0.6551 - val_loss: 0.5618
Epoch 17/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6957 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.7508 8/20 [===========&gt;..................] - ETA: 0s - loss: 0.686911/20 [===============&gt;..............] - ETA: 0s - loss: 0.707814/20 [====================&gt;.........] - ETA: 0s - loss: 0.695317/20 [========================&gt;.....] - ETA: 0s - loss: 0.680420/20 [==============================] - ETA: 0s - loss: 0.659120/20 [==============================] - 0s 21ms/step - loss: 0.6591 - val_loss: 0.5751
Epoch 18/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.7323 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.6810 8/20 [===========&gt;..................] - ETA: 0s - loss: 0.655811/20 [===============&gt;..............] - ETA: 0s - loss: 0.658614/20 [====================&gt;.........] - ETA: 0s - loss: 0.648717/20 [========================&gt;.....] - ETA: 0s - loss: 0.643620/20 [==============================] - ETA: 0s - loss: 0.635120/20 [==============================] - 0s 21ms/step - loss: 0.6351 - val_loss: 0.5892
Epoch 19/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.8366 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.7150 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.695310/20 [==============&gt;...............] - ETA: 0s - loss: 0.668813/20 [==================&gt;...........] - ETA: 0s - loss: 0.669816/20 [=======================&gt;......] - ETA: 0s - loss: 0.650019/20 [===========================&gt;..] - ETA: 0s - loss: 0.642320/20 [==============================] - 0s 21ms/step - loss: 0.6356 - val_loss: 0.5710
Epoch 20/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.7900 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.6455 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.711210/20 [==============&gt;...............] - ETA: 0s - loss: 0.677813/20 [==================&gt;...........] - ETA: 0s - loss: 0.678316/20 [=======================&gt;......] - ETA: 0s - loss: 0.643119/20 [===========================&gt;..] - ETA: 0s - loss: 0.654920/20 [==============================] - 0s 21ms/step - loss: 0.6486 - val_loss: 0.5601
Epoch 21/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6203 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.6758 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.637610/20 [==============&gt;...............] - ETA: 0s - loss: 0.611313/20 [==================&gt;...........] - ETA: 0s - loss: 0.612616/20 [=======================&gt;......] - ETA: 0s - loss: 0.631119/20 [===========================&gt;..] - ETA: 0s - loss: 0.637120/20 [==============================] - 0s 21ms/step - loss: 0.6364 - val_loss: 0.5651
Epoch 22/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6946 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.6635 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.629710/20 [==============&gt;...............] - ETA: 0s - loss: 0.636013/20 [==================&gt;...........] - ETA: 0s - loss: 0.645816/20 [=======================&gt;......] - ETA: 0s - loss: 0.651919/20 [===========================&gt;..] - ETA: 0s - loss: 0.627420/20 [==============================] - 0s 21ms/step - loss: 0.6256 - val_loss: 0.5667
Epoch 23/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.7790 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.7765 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.730410/20 [==============&gt;...............] - ETA: 0s - loss: 0.657013/20 [==================&gt;...........] - ETA: 0s - loss: 0.663816/20 [=======================&gt;......] - ETA: 0s - loss: 0.656019/20 [===========================&gt;..] - ETA: 0s - loss: 0.650720/20 [==============================] - 0s 21ms/step - loss: 0.6457 - val_loss: 0.5488
Epoch 24/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5290 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.5546 8/20 [===========&gt;..................] - ETA: 0s - loss: 0.606612/20 [=================&gt;............] - ETA: 0s - loss: 0.637315/20 [=====================&gt;........] - ETA: 0s - loss: 0.638518/20 [==========================&gt;...] - ETA: 0s - loss: 0.652920/20 [==============================] - 0s 21ms/step - loss: 0.6369 - val_loss: 0.5621
Epoch 25/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.7230 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.6214 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.653210/20 [==============&gt;...............] - ETA: 0s - loss: 0.631413/20 [==================&gt;...........] - ETA: 0s - loss: 0.621216/20 [=======================&gt;......] - ETA: 0s - loss: 0.648719/20 [===========================&gt;..] - ETA: 0s - loss: 0.650320/20 [==============================] - 0s 21ms/step - loss: 0.6426 - val_loss: 0.5975
Epoch 26/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6187 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.6395 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.626210/20 [==============&gt;...............] - ETA: 0s - loss: 0.616613/20 [==================&gt;...........] - ETA: 0s - loss: 0.603316/20 [=======================&gt;......] - ETA: 0s - loss: 0.626620/20 [==============================] - ETA: 0s - loss: 0.637820/20 [==============================] - 0s 21ms/step - loss: 0.6378 - val_loss: 0.6495
Epoch 27/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6254 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.5857 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.585310/20 [==============&gt;...............] - ETA: 0s - loss: 0.613113/20 [==================&gt;...........] - ETA: 0s - loss: 0.612016/20 [=======================&gt;......] - ETA: 0s - loss: 0.630619/20 [===========================&gt;..] - ETA: 0s - loss: 0.629220/20 [==============================] - 0s 21ms/step - loss: 0.6410 - val_loss: 0.5961
Epoch 28/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6626 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.6564 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.630910/20 [==============&gt;...............] - ETA: 0s - loss: 0.589913/20 [==================&gt;...........] - ETA: 0s - loss: 0.588616/20 [=======================&gt;......] - ETA: 0s - loss: 0.599519/20 [===========================&gt;..] - ETA: 0s - loss: 0.609120/20 [==============================] - 0s 21ms/step - loss: 0.6246 - val_loss: 0.5950
Epoch 29/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6643 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.7269 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.656110/20 [==============&gt;...............] - ETA: 0s - loss: 0.651613/20 [==================&gt;...........] - ETA: 0s - loss: 0.638516/20 [=======================&gt;......] - ETA: 0s - loss: 0.645619/20 [===========================&gt;..] - ETA: 0s - loss: 0.640820/20 [==============================] - 0s 21ms/step - loss: 0.6379 - val_loss: 0.5586
Epoch 30/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6766 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.6625 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.620010/20 [==============&gt;...............] - ETA: 0s - loss: 0.638213/20 [==================&gt;...........] - ETA: 0s - loss: 0.624116/20 [=======================&gt;......] - ETA: 0s - loss: 0.619719/20 [===========================&gt;..] - ETA: 0s - loss: 0.625520/20 [==============================] - 0s 21ms/step - loss: 0.6343 - val_loss: 0.5557</code></pre>
</div>
</div>
<p>Let’s look at the diagnostic plot</p>
<div class="cell" data-execution_count="12">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>history_plot(history_spy_1_reg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="Deep Learning for TS_files/figure-html/cell-13-output-1.png" width="597" height="449"></p>
</div>
</div>
<p>Compared to the model without regularization, we can see that the training set error decreases more steadily, without regressing higher very often. The consequence of this is that the raining error goes lower than the validation error faster than without regularization, suggesting regularization is helping the model to learn more purposefully and successfully.</p>
</section>
<section id="fit-rnn" class="level2">
<h2 class="anchored" data-anchor-id="fit-rnn">Fit RNN</h2>
<div class="cell" data-execution_count="13">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a sequential model once again</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Sequential()</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>model.add(layers.Dense(<span class="dv">32</span>, activation<span class="op">=</span><span class="st">'relu'</span>,input_shape<span class="op">=</span>rnn_input_shape))</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co"># This layer is the recurent layer, which returns all previous data</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>model.add(layers.SimpleRNN(<span class="dv">32</span>, dropout<span class="op">=</span><span class="fl">0.1</span>, recurrent_dropout<span class="op">=</span><span class="fl">0.5</span>, return_sequences<span class="op">=</span><span class="va">True</span>))</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co"># layer that reads the recurent layer</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>model.add(layers.Dense(<span class="dv">1</span>))</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span>RMSprop(), loss<span class="op">=</span><span class="st">'mae'</span>)</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>history_spy_2_noreg <span class="op">=</span> model.fit(x <span class="op">=</span> spy_x, y <span class="op">=</span> spy_y, steps_per_epoch<span class="op">=</span><span class="dv">20</span>, epochs<span class="op">=</span><span class="dv">40</span>, validation_data<span class="op">=</span> (spy_val_x, spy_val_y), validation_steps<span class="op">=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 1/40
 1/20 [&gt;.............................] - ETA: 18s - loss: 1.078911/20 [===============&gt;..............] - ETA: 0s - loss: 0.9296 20/20 [==============================] - 1s 17ms/step - loss: 0.8798 - val_loss: 0.5963
Epoch 2/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.818612/20 [=================&gt;............] - ETA: 0s - loss: 0.798720/20 [==============================] - 0s 7ms/step - loss: 0.7811 - val_loss: 0.6081
Epoch 3/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.770112/20 [=================&gt;............] - ETA: 0s - loss: 0.725220/20 [==============================] - 0s 7ms/step - loss: 0.7433 - val_loss: 0.6222
Epoch 4/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.753812/20 [=================&gt;............] - ETA: 0s - loss: 0.726020/20 [==============================] - 0s 7ms/step - loss: 0.7198 - val_loss: 0.6047
Epoch 5/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.743612/20 [=================&gt;............] - ETA: 0s - loss: 0.678920/20 [==============================] - 0s 7ms/step - loss: 0.7045 - val_loss: 0.6365
Epoch 6/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.786511/20 [===============&gt;..............] - ETA: 0s - loss: 0.731420/20 [==============================] - 0s 7ms/step - loss: 0.6979 - val_loss: 0.6021
Epoch 7/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.584611/20 [===============&gt;..............] - ETA: 0s - loss: 0.676720/20 [==============================] - 0s 7ms/step - loss: 0.6916 - val_loss: 0.6089
Epoch 8/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.605311/20 [===============&gt;..............] - ETA: 0s - loss: 0.649320/20 [==============================] - 0s 8ms/step - loss: 0.6817 - val_loss: 0.6581
Epoch 9/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.879210/20 [==============&gt;...............] - ETA: 0s - loss: 0.646219/20 [===========================&gt;..] - ETA: 0s - loss: 0.673220/20 [==============================] - 0s 8ms/step - loss: 0.6770 - val_loss: 0.7033
Epoch 10/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.750010/20 [==============&gt;...............] - ETA: 0s - loss: 0.693919/20 [===========================&gt;..] - ETA: 0s - loss: 0.680020/20 [==============================] - 0s 8ms/step - loss: 0.6746 - val_loss: 0.6072
Epoch 11/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.626711/20 [===============&gt;..............] - ETA: 0s - loss: 0.670820/20 [==============================] - 0s 7ms/step - loss: 0.6543 - val_loss: 0.6226
Epoch 12/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.593311/20 [===============&gt;..............] - ETA: 0s - loss: 0.642420/20 [==============================] - 0s 7ms/step - loss: 0.6472 - val_loss: 0.6897
Epoch 13/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.689511/20 [===============&gt;..............] - ETA: 0s - loss: 0.666720/20 [==============================] - 0s 8ms/step - loss: 0.6452 - val_loss: 0.6262
Epoch 14/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.767711/20 [===============&gt;..............] - ETA: 0s - loss: 0.673720/20 [==============================] - 0s 8ms/step - loss: 0.6392 - val_loss: 0.5982
Epoch 15/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.673911/20 [===============&gt;..............] - ETA: 0s - loss: 0.643420/20 [==============================] - 0s 8ms/step - loss: 0.6338 - val_loss: 0.7201
Epoch 16/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.518910/20 [==============&gt;...............] - ETA: 0s - loss: 0.633019/20 [===========================&gt;..] - ETA: 0s - loss: 0.628520/20 [==============================] - 0s 8ms/step - loss: 0.6314 - val_loss: 0.6580
Epoch 17/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.571711/20 [===============&gt;..............] - ETA: 0s - loss: 0.604720/20 [==============================] - ETA: 0s - loss: 0.625120/20 [==============================] - 0s 8ms/step - loss: 0.6251 - val_loss: 0.6079
Epoch 18/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.705910/20 [==============&gt;...............] - ETA: 0s - loss: 0.583720/20 [==============================] - ETA: 0s - loss: 0.629720/20 [==============================] - 0s 8ms/step - loss: 0.6297 - val_loss: 0.5988
Epoch 19/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.526310/20 [==============&gt;...............] - ETA: 0s - loss: 0.655219/20 [===========================&gt;..] - ETA: 0s - loss: 0.634620/20 [==============================] - 0s 9ms/step - loss: 0.6256 - val_loss: 0.5952
Epoch 20/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.743011/20 [===============&gt;..............] - ETA: 0s - loss: 0.589020/20 [==============================] - ETA: 0s - loss: 0.612820/20 [==============================] - 0s 8ms/step - loss: 0.6128 - val_loss: 0.6089
Epoch 21/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.520210/20 [==============&gt;...............] - ETA: 0s - loss: 0.605819/20 [===========================&gt;..] - ETA: 0s - loss: 0.597120/20 [==============================] - 0s 8ms/step - loss: 0.6040 - val_loss: 0.6477
Epoch 22/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.609610/20 [==============&gt;...............] - ETA: 0s - loss: 0.603019/20 [===========================&gt;..] - ETA: 0s - loss: 0.606420/20 [==============================] - 0s 8ms/step - loss: 0.6265 - val_loss: 0.6031
Epoch 23/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.946110/20 [==============&gt;...............] - ETA: 0s - loss: 0.617119/20 [===========================&gt;..] - ETA: 0s - loss: 0.618620/20 [==============================] - 0s 8ms/step - loss: 0.6150 - val_loss: 0.5730
Epoch 24/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.409510/20 [==============&gt;...............] - ETA: 0s - loss: 0.567720/20 [==============================] - ETA: 0s - loss: 0.610020/20 [==============================] - 0s 8ms/step - loss: 0.6100 - val_loss: 0.5558
Epoch 25/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.770710/20 [==============&gt;...............] - ETA: 0s - loss: 0.662519/20 [===========================&gt;..] - ETA: 0s - loss: 0.606820/20 [==============================] - 0s 8ms/step - loss: 0.6060 - val_loss: 0.5620
Epoch 26/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.690410/20 [==============&gt;...............] - ETA: 0s - loss: 0.633820/20 [==============================] - ETA: 0s - loss: 0.606920/20 [==============================] - 0s 8ms/step - loss: 0.6069 - val_loss: 0.5775
Epoch 27/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.516111/20 [===============&gt;..............] - ETA: 0s - loss: 0.593420/20 [==============================] - 0s 8ms/step - loss: 0.6092 - val_loss: 0.5863
Epoch 28/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.557811/20 [===============&gt;..............] - ETA: 0s - loss: 0.592620/20 [==============================] - 0s 7ms/step - loss: 0.6076 - val_loss: 0.5754
Epoch 29/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.626711/20 [===============&gt;..............] - ETA: 0s - loss: 0.635320/20 [==============================] - 0s 8ms/step - loss: 0.6091 - val_loss: 0.5681
Epoch 30/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.484511/20 [===============&gt;..............] - ETA: 0s - loss: 0.585220/20 [==============================] - ETA: 0s - loss: 0.613520/20 [==============================] - 0s 8ms/step - loss: 0.6135 - val_loss: 0.5532
Epoch 31/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.439110/20 [==============&gt;...............] - ETA: 0s - loss: 0.590519/20 [===========================&gt;..] - ETA: 0s - loss: 0.615620/20 [==============================] - 0s 8ms/step - loss: 0.6109 - val_loss: 0.5416
Epoch 32/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.597410/20 [==============&gt;...............] - ETA: 0s - loss: 0.607919/20 [===========================&gt;..] - ETA: 0s - loss: 0.603620/20 [==============================] - 0s 8ms/step - loss: 0.6098 - val_loss: 0.5758
Epoch 33/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.472310/20 [==============&gt;...............] - ETA: 0s - loss: 0.569518/20 [==========================&gt;...] - ETA: 0s - loss: 0.601120/20 [==============================] - 0s 9ms/step - loss: 0.6081 - val_loss: 0.5309
Epoch 34/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.838710/20 [==============&gt;...............] - ETA: 0s - loss: 0.634420/20 [==============================] - ETA: 0s - loss: 0.611020/20 [==============================] - 0s 8ms/step - loss: 0.6110 - val_loss: 0.5876
Epoch 35/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.758410/20 [==============&gt;...............] - ETA: 0s - loss: 0.610920/20 [==============================] - ETA: 0s - loss: 0.607820/20 [==============================] - 0s 8ms/step - loss: 0.6078 - val_loss: 0.6195
Epoch 36/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.532711/20 [===============&gt;..............] - ETA: 0s - loss: 0.609020/20 [==============================] - 0s 8ms/step - loss: 0.6028 - val_loss: 0.5826
Epoch 37/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.636611/20 [===============&gt;..............] - ETA: 0s - loss: 0.625120/20 [==============================] - 0s 8ms/step - loss: 0.6019 - val_loss: 0.5842
Epoch 38/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.692211/20 [===============&gt;..............] - ETA: 0s - loss: 0.578720/20 [==============================] - ETA: 0s - loss: 0.610220/20 [==============================] - 0s 8ms/step - loss: 0.6102 - val_loss: 0.5432
Epoch 39/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.806610/20 [==============&gt;...............] - ETA: 0s - loss: 0.640220/20 [==============================] - ETA: 0s - loss: 0.593520/20 [==============================] - 0s 8ms/step - loss: 0.5935 - val_loss: 0.5806
Epoch 40/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.739711/20 [===============&gt;..............] - ETA: 0s - loss: 0.624720/20 [==============================] - 0s 8ms/step - loss: 0.6062 - val_loss: 0.5837</code></pre>
</div>
</div>
<div class="cell" data-execution_count="14">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>history_plot(history_spy_2_noreg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="Deep Learning for TS_files/figure-html/cell-15-output-1.png" width="597" height="449"></p>
</div>
</div>
<p>We can see the validation loss of the simple RNN model is actually almost equivalent to both the regularized and non-regularized GRU models above. Specifically, all 3 models tended to initialize around 0.6 loss for the validation set, and then slowly work down to about 0.55. If anything, the RNN model might perform slightly better, with validation loss decreasing below 0.55 at the later-stage epochs.</p>
</section>
<section id="fit-lstm" class="level2">
<h2 class="anchored" data-anchor-id="fit-lstm">Fit LSTM</h2>
<div class="cell" data-execution_count="15">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a sequential model once again</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Sequential()</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>model.add(layers.Dense(<span class="dv">32</span>, activation<span class="op">=</span><span class="st">'relu'</span>,input_shape<span class="op">=</span>rnn_input_shape))</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co"># This layer is the recurent layer, which returns all previous data</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>model.add(layers.LSTM(<span class="dv">32</span>, dropout<span class="op">=</span><span class="fl">0.1</span>, recurrent_dropout<span class="op">=</span><span class="fl">0.5</span>, return_sequences<span class="op">=</span><span class="va">True</span>))</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="co"># layer that reads the recurent layer</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>model.add(layers.Dense(<span class="dv">1</span>))</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span>RMSprop(), loss<span class="op">=</span><span class="st">'mae'</span>)</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>history_spy_3_noreg <span class="op">=</span> model.fit(x <span class="op">=</span> spy_x, y <span class="op">=</span> spy_y, steps_per_epoch<span class="op">=</span><span class="dv">20</span>, epochs<span class="op">=</span><span class="dv">40</span>, validation_data<span class="op">=</span> (spy_val_x, spy_val_y), validation_steps<span class="op">=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 1/40
 1/20 [&gt;.............................] - ETA: 43s - loss: 0.7877 6/20 [========&gt;.....................] - ETA: 0s - loss: 0.7603 11/20 [===============&gt;..............] - ETA: 0s - loss: 0.749417/20 [========================&gt;.....] - ETA: 0s - loss: 0.712320/20 [==============================] - 3s 27ms/step - loss: 0.6872 - val_loss: 0.5454
Epoch 2/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.7942 6/20 [========&gt;.....................] - ETA: 0s - loss: 0.611511/20 [===============&gt;..............] - ETA: 0s - loss: 0.608416/20 [=======================&gt;......] - ETA: 0s - loss: 0.636920/20 [==============================] - 0s 13ms/step - loss: 0.6526 - val_loss: 0.5501
Epoch 3/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.7961 6/20 [========&gt;.....................] - ETA: 0s - loss: 0.718511/20 [===============&gt;..............] - ETA: 0s - loss: 0.695016/20 [=======================&gt;......] - ETA: 0s - loss: 0.671720/20 [==============================] - 0s 14ms/step - loss: 0.6419 - val_loss: 0.5392
Epoch 4/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5006 6/20 [========&gt;.....................] - ETA: 0s - loss: 0.619510/20 [==============&gt;...............] - ETA: 0s - loss: 0.642314/20 [====================&gt;.........] - ETA: 0s - loss: 0.631019/20 [===========================&gt;..] - ETA: 0s - loss: 0.631420/20 [==============================] - 0s 17ms/step - loss: 0.6376 - val_loss: 0.5396
Epoch 5/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.8413 6/20 [========&gt;.....................] - ETA: 0s - loss: 0.675811/20 [===============&gt;..............] - ETA: 0s - loss: 0.642716/20 [=======================&gt;......] - ETA: 0s - loss: 0.640420/20 [==============================] - 0s 14ms/step - loss: 0.6348 - val_loss: 0.5340
Epoch 6/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.4846 6/20 [========&gt;.....................] - ETA: 0s - loss: 0.647211/20 [===============&gt;..............] - ETA: 0s - loss: 0.605016/20 [=======================&gt;......] - ETA: 0s - loss: 0.631220/20 [==============================] - 0s 14ms/step - loss: 0.6290 - val_loss: 0.5336
Epoch 7/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6678 6/20 [========&gt;.....................] - ETA: 0s - loss: 0.593711/20 [===============&gt;..............] - ETA: 0s - loss: 0.646416/20 [=======================&gt;......] - ETA: 0s - loss: 0.620520/20 [==============================] - 0s 14ms/step - loss: 0.6210 - val_loss: 0.5432
Epoch 8/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6196 6/20 [========&gt;.....................] - ETA: 0s - loss: 0.593211/20 [===============&gt;..............] - ETA: 0s - loss: 0.649817/20 [========================&gt;.....] - ETA: 0s - loss: 0.620120/20 [==============================] - 0s 13ms/step - loss: 0.6211 - val_loss: 0.5688
Epoch 9/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6385 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.645012/20 [=================&gt;............] - ETA: 0s - loss: 0.613518/20 [==========================&gt;...] - ETA: 0s - loss: 0.620820/20 [==============================] - 0s 13ms/step - loss: 0.6220 - val_loss: 0.5806
Epoch 10/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.7201 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.624913/20 [==================&gt;...........] - ETA: 0s - loss: 0.628319/20 [===========================&gt;..] - ETA: 0s - loss: 0.618820/20 [==============================] - 0s 12ms/step - loss: 0.6175 - val_loss: 0.5604
Epoch 11/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5906 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.536913/20 [==================&gt;...........] - ETA: 0s - loss: 0.604318/20 [==========================&gt;...] - ETA: 0s - loss: 0.614420/20 [==============================] - 0s 13ms/step - loss: 0.6156 - val_loss: 0.5762
Epoch 12/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6489 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.579412/20 [=================&gt;............] - ETA: 0s - loss: 0.572817/20 [========================&gt;.....] - ETA: 0s - loss: 0.599120/20 [==============================] - 0s 15ms/step - loss: 0.6116 - val_loss: 0.5549
Epoch 13/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.7079 6/20 [========&gt;.....................] - ETA: 0s - loss: 0.606412/20 [=================&gt;............] - ETA: 0s - loss: 0.609517/20 [========================&gt;.....] - ETA: 0s - loss: 0.623620/20 [==============================] - 0s 13ms/step - loss: 0.6122 - val_loss: 0.5362
Epoch 14/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.4821 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.533013/20 [==================&gt;...........] - ETA: 0s - loss: 0.622319/20 [===========================&gt;..] - ETA: 0s - loss: 0.615420/20 [==============================] - 0s 12ms/step - loss: 0.6104 - val_loss: 0.5471
Epoch 15/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.4854 6/20 [========&gt;.....................] - ETA: 0s - loss: 0.630812/20 [=================&gt;............] - ETA: 0s - loss: 0.641517/20 [========================&gt;.....] - ETA: 0s - loss: 0.621920/20 [==============================] - 0s 13ms/step - loss: 0.6115 - val_loss: 0.5530
Epoch 16/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5780 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.603613/20 [==================&gt;...........] - ETA: 0s - loss: 0.585519/20 [===========================&gt;..] - ETA: 0s - loss: 0.608620/20 [==============================] - 0s 12ms/step - loss: 0.6096 - val_loss: 0.5351
Epoch 17/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6759 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.593813/20 [==================&gt;...........] - ETA: 0s - loss: 0.590719/20 [===========================&gt;..] - ETA: 0s - loss: 0.596120/20 [==============================] - 0s 11ms/step - loss: 0.5991 - val_loss: 0.5613
Epoch 18/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5494 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.640413/20 [==================&gt;...........] - ETA: 0s - loss: 0.608920/20 [==============================] - ETA: 0s - loss: 0.597020/20 [==============================] - 0s 11ms/step - loss: 0.5970 - val_loss: 0.5522
Epoch 19/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6673 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.607813/20 [==================&gt;...........] - ETA: 0s - loss: 0.604819/20 [===========================&gt;..] - ETA: 0s - loss: 0.599320/20 [==============================] - 0s 12ms/step - loss: 0.6012 - val_loss: 0.5341
Epoch 20/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6606 6/20 [========&gt;.....................] - ETA: 0s - loss: 0.625811/20 [===============&gt;..............] - ETA: 0s - loss: 0.597816/20 [=======================&gt;......] - ETA: 0s - loss: 0.578920/20 [==============================] - 0s 14ms/step - loss: 0.5999 - val_loss: 0.5657
Epoch 21/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.7228 6/20 [========&gt;.....................] - ETA: 0s - loss: 0.599411/20 [===============&gt;..............] - ETA: 0s - loss: 0.596016/20 [=======================&gt;......] - ETA: 0s - loss: 0.599620/20 [==============================] - 0s 14ms/step - loss: 0.6041 - val_loss: 0.5588
Epoch 22/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.4591 6/20 [========&gt;.....................] - ETA: 0s - loss: 0.545611/20 [===============&gt;..............] - ETA: 0s - loss: 0.596616/20 [=======================&gt;......] - ETA: 0s - loss: 0.589320/20 [==============================] - 0s 14ms/step - loss: 0.6014 - val_loss: 0.5582
Epoch 23/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6150 6/20 [========&gt;.....................] - ETA: 0s - loss: 0.614811/20 [===============&gt;..............] - ETA: 0s - loss: 0.600716/20 [=======================&gt;......] - ETA: 0s - loss: 0.598420/20 [==============================] - 0s 14ms/step - loss: 0.5998 - val_loss: 0.5483
Epoch 24/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5683 6/20 [========&gt;.....................] - ETA: 0s - loss: 0.588711/20 [===============&gt;..............] - ETA: 0s - loss: 0.589815/20 [=====================&gt;........] - ETA: 0s - loss: 0.589320/20 [==============================] - ETA: 0s - loss: 0.598420/20 [==============================] - 0s 15ms/step - loss: 0.5984 - val_loss: 0.5511
Epoch 25/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5523 6/20 [========&gt;.....................] - ETA: 0s - loss: 0.683511/20 [===============&gt;..............] - ETA: 0s - loss: 0.635516/20 [=======================&gt;......] - ETA: 0s - loss: 0.595720/20 [==============================] - 0s 15ms/step - loss: 0.6003 - val_loss: 0.5481
Epoch 26/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6784 6/20 [========&gt;.....................] - ETA: 0s - loss: 0.586711/20 [===============&gt;..............] - ETA: 0s - loss: 0.593115/20 [=====================&gt;........] - ETA: 0s - loss: 0.606020/20 [==============================] - ETA: 0s - loss: 0.601420/20 [==============================] - 0s 15ms/step - loss: 0.6014 - val_loss: 0.5668
Epoch 27/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6421 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.5728 9/20 [============&gt;.................] - ETA: 0s - loss: 0.575313/20 [==================&gt;...........] - ETA: 0s - loss: 0.567117/20 [========================&gt;.....] - ETA: 0s - loss: 0.589420/20 [==============================] - 0s 16ms/step - loss: 0.5984 - val_loss: 0.5369
Epoch 28/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5090 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.583410/20 [==============&gt;...............] - ETA: 0s - loss: 0.592514/20 [====================&gt;.........] - ETA: 0s - loss: 0.588018/20 [==========================&gt;...] - ETA: 0s - loss: 0.602820/20 [==============================] - 0s 16ms/step - loss: 0.5952 - val_loss: 0.5602
Epoch 29/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.4592 6/20 [========&gt;.....................] - ETA: 0s - loss: 0.593810/20 [==============&gt;...............] - ETA: 0s - loss: 0.616015/20 [=====================&gt;........] - ETA: 0s - loss: 0.614619/20 [===========================&gt;..] - ETA: 0s - loss: 0.602320/20 [==============================] - 0s 16ms/step - loss: 0.5978 - val_loss: 0.5516
Epoch 30/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5806 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.6118 9/20 [============&gt;.................] - ETA: 0s - loss: 0.629413/20 [==================&gt;...........] - ETA: 0s - loss: 0.591117/20 [========================&gt;.....] - ETA: 0s - loss: 0.594820/20 [==============================] - 0s 16ms/step - loss: 0.6007 - val_loss: 0.5601
Epoch 31/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.3989 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.529210/20 [==============&gt;...............] - ETA: 0s - loss: 0.586814/20 [====================&gt;.........] - ETA: 0s - loss: 0.574418/20 [==========================&gt;...] - ETA: 0s - loss: 0.598620/20 [==============================] - 0s 16ms/step - loss: 0.5906 - val_loss: 0.5474
Epoch 32/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.3922 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.550010/20 [==============&gt;...............] - ETA: 0s - loss: 0.573714/20 [====================&gt;.........] - ETA: 0s - loss: 0.593118/20 [==========================&gt;...] - ETA: 0s - loss: 0.588420/20 [==============================] - 0s 16ms/step - loss: 0.5907 - val_loss: 0.5686
Epoch 33/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5578 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.642110/20 [==============&gt;...............] - ETA: 0s - loss: 0.603414/20 [====================&gt;.........] - ETA: 0s - loss: 0.584318/20 [==========================&gt;...] - ETA: 0s - loss: 0.593620/20 [==============================] - 0s 15ms/step - loss: 0.5954 - val_loss: 0.5354
Epoch 34/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.9139 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.6709 9/20 [============&gt;.................] - ETA: 0s - loss: 0.635713/20 [==================&gt;...........] - ETA: 0s - loss: 0.595917/20 [========================&gt;.....] - ETA: 0s - loss: 0.584820/20 [==============================] - 0s 16ms/step - loss: 0.5910 - val_loss: 0.5526
Epoch 35/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6636 6/20 [========&gt;.....................] - ETA: 0s - loss: 0.686310/20 [==============&gt;...............] - ETA: 0s - loss: 0.649414/20 [====================&gt;.........] - ETA: 0s - loss: 0.630418/20 [==========================&gt;...] - ETA: 0s - loss: 0.602520/20 [==============================] - 0s 16ms/step - loss: 0.5948 - val_loss: 0.5326
Epoch 36/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.4787 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.5954 9/20 [============&gt;.................] - ETA: 0s - loss: 0.590713/20 [==================&gt;...........] - ETA: 0s - loss: 0.601517/20 [========================&gt;.....] - ETA: 0s - loss: 0.599420/20 [==============================] - 0s 16ms/step - loss: 0.5940 - val_loss: 0.5486
Epoch 37/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5323 6/20 [========&gt;.....................] - ETA: 0s - loss: 0.555711/20 [===============&gt;..............] - ETA: 0s - loss: 0.591016/20 [=======================&gt;......] - ETA: 0s - loss: 0.603320/20 [==============================] - ETA: 0s - loss: 0.594020/20 [==============================] - 0s 16ms/step - loss: 0.5940 - val_loss: 0.5550
Epoch 38/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6028 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.5853 9/20 [============&gt;.................] - ETA: 0s - loss: 0.575713/20 [==================&gt;...........] - ETA: 0s - loss: 0.600217/20 [========================&gt;.....] - ETA: 0s - loss: 0.595420/20 [==============================] - 0s 16ms/step - loss: 0.5954 - val_loss: 0.5345
Epoch 39/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6374 6/20 [========&gt;.....................] - ETA: 0s - loss: 0.581010/20 [==============&gt;...............] - ETA: 0s - loss: 0.626314/20 [====================&gt;.........] - ETA: 0s - loss: 0.584718/20 [==========================&gt;...] - ETA: 0s - loss: 0.574020/20 [==============================] - 0s 16ms/step - loss: 0.5841 - val_loss: 0.5608
Epoch 40/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5815 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.6136 9/20 [============&gt;.................] - ETA: 0s - loss: 0.596513/20 [==================&gt;...........] - ETA: 0s - loss: 0.575417/20 [========================&gt;.....] - ETA: 0s - loss: 0.576020/20 [==============================] - 0s 16ms/step - loss: 0.5916 - val_loss: 0.5547</code></pre>
</div>
</div>
<div class="cell" data-execution_count="16">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>history_plot(history_spy_3_noreg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="Deep Learning for TS_files/figure-html/cell-17-output-1.png" width="597" height="449"></p>
</div>
</div>
<p>With one LSTM layer, the model already seems better than the RNN and GRU competitiors. The validation loss starts out around 0.56 and stays in the lower end of the 0.55-0.6 range. Let’s try adding another layer:</p>
<div class="cell" data-execution_count="17">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">#from sklearn.neural_network import MLPRegressor</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co"># create a sequential model once again</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Sequential()</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>model.add(layers.Dense(<span class="dv">32</span>, activation<span class="op">=</span><span class="st">'relu'</span>,input_shape<span class="op">=</span>rnn_input_shape))</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="co"># This layer is the recurent layer, which returns all previous data</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>model.add(layers.LSTM(<span class="dv">64</span>, dropout<span class="op">=</span><span class="fl">0.1</span>, recurrent_dropout<span class="op">=</span><span class="fl">0.5</span>, return_sequences<span class="op">=</span><span class="va">True</span>, recurrent_regularizer<span class="op">=</span> regularizers.L1L2(l1<span class="op">=</span>L1, l2<span class="op">=</span>L2)))</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>model.add(layers.LSTM(<span class="dv">64</span>, dropout<span class="op">=</span><span class="fl">0.1</span>, recurrent_dropout<span class="op">=</span><span class="fl">0.5</span>, return_sequences<span class="op">=</span><span class="va">True</span>, recurrent_regularizer <span class="op">=</span> regularizers.L1L2(l1<span class="op">=</span>L1, l2<span class="op">=</span>L2)))</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>model.add(layers.LSTM(<span class="dv">64</span>, dropout<span class="op">=</span><span class="fl">0.1</span>, recurrent_dropout<span class="op">=</span><span class="fl">0.5</span>, return_sequences<span class="op">=</span><span class="va">True</span>, recurrent_regularizer <span class="op">=</span> regularizers.L1L2(l1<span class="op">=</span>L1, l2<span class="op">=</span>L2)))</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="co"># layer that reads the recurent layer</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>model.add(layers.Dense(<span class="dv">32</span>, activation<span class="op">=</span><span class="st">'relu'</span>,kernel_regularizer<span class="op">=</span>regularizers.L1L2(l1<span class="op">=</span>L1, l2<span class="op">=</span>L2)))</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>model.add(layers.Dense(<span class="dv">1</span>))</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(MLPRegressor())</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span>RMSprop(), loss<span class="op">=</span><span class="st">'mae'</span>)</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a><span class="co">#  trying diff shape</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>history_spy_4_noreg <span class="op">=</span> model.fit(x <span class="op">=</span> spy_x, y <span class="op">=</span> spy_y, steps_per_epoch<span class="op">=</span><span class="dv">20</span>, epochs<span class="op">=</span><span class="dv">40</span>, validation_data<span class="op">=</span> (spy_val_x, spy_val_y), validation_steps<span class="op">=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 1/40
 1/20 [&gt;.............................] - ETA: 2:01 - loss: 0.9702 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.9227   5/20 [======&gt;.......................] - ETA: 0s - loss: 0.9035 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.8942 9/20 [============&gt;.................] - ETA: 0s - loss: 0.910711/20 [===============&gt;..............] - ETA: 0s - loss: 0.931213/20 [==================&gt;...........] - ETA: 0s - loss: 0.910315/20 [=====================&gt;........] - ETA: 0s - loss: 0.893017/20 [========================&gt;.....] - ETA: 0s - loss: 0.910919/20 [===========================&gt;..] - ETA: 0s - loss: 0.905020/20 [==============================] - 8s 60ms/step - loss: 0.8936 - val_loss: 0.7515
Epoch 2/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.7675 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.8306 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.8582 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.8970 9/20 [============&gt;.................] - ETA: 0s - loss: 0.870511/20 [===============&gt;..............] - ETA: 0s - loss: 0.879513/20 [==================&gt;...........] - ETA: 0s - loss: 0.858515/20 [=====================&gt;........] - ETA: 0s - loss: 0.833017/20 [========================&gt;.....] - ETA: 0s - loss: 0.833519/20 [===========================&gt;..] - ETA: 0s - loss: 0.834820/20 [==============================] - 1s 36ms/step - loss: 0.8341 - val_loss: 0.7288
Epoch 3/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.7627 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.8584 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.8263 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.8263 9/20 [============&gt;.................] - ETA: 0s - loss: 0.818211/20 [===============&gt;..............] - ETA: 0s - loss: 0.801713/20 [==================&gt;...........] - ETA: 0s - loss: 0.815915/20 [=====================&gt;........] - ETA: 0s - loss: 0.829817/20 [========================&gt;.....] - ETA: 0s - loss: 0.815619/20 [===========================&gt;..] - ETA: 0s - loss: 0.805020/20 [==============================] - 1s 33ms/step - loss: 0.8021 - val_loss: 0.7174
Epoch 4/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6915 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.6982 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.7709 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.7510 9/20 [============&gt;.................] - ETA: 0s - loss: 0.759711/20 [===============&gt;..............] - ETA: 0s - loss: 0.750813/20 [==================&gt;...........] - ETA: 0s - loss: 0.755715/20 [=====================&gt;........] - ETA: 0s - loss: 0.768917/20 [========================&gt;.....] - ETA: 0s - loss: 0.776419/20 [===========================&gt;..] - ETA: 0s - loss: 0.770520/20 [==============================] - 1s 34ms/step - loss: 0.7770 - val_loss: 0.6923
Epoch 5/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.9002 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.8370 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.8809 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.8350 9/20 [============&gt;.................] - ETA: 0s - loss: 0.795311/20 [===============&gt;..............] - ETA: 0s - loss: 0.803413/20 [==================&gt;...........] - ETA: 0s - loss: 0.785615/20 [=====================&gt;........] - ETA: 0s - loss: 0.778017/20 [========================&gt;.....] - ETA: 0s - loss: 0.775819/20 [===========================&gt;..] - ETA: 0s - loss: 0.768220/20 [==============================] - 1s 36ms/step - loss: 0.7605 - val_loss: 0.6633
Epoch 6/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6884 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.6912 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.7422 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.7265 9/20 [============&gt;.................] - ETA: 0s - loss: 0.709811/20 [===============&gt;..............] - ETA: 0s - loss: 0.743813/20 [==================&gt;...........] - ETA: 0s - loss: 0.724015/20 [=====================&gt;........] - ETA: 0s - loss: 0.735617/20 [========================&gt;.....] - ETA: 0s - loss: 0.730819/20 [===========================&gt;..] - ETA: 0s - loss: 0.734420/20 [==============================] - 1s 35ms/step - loss: 0.7342 - val_loss: 0.7457
Epoch 7/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.7273 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.6651 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.6979 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.6812 9/20 [============&gt;.................] - ETA: 0s - loss: 0.747911/20 [===============&gt;..............] - ETA: 0s - loss: 0.736613/20 [==================&gt;...........] - ETA: 0s - loss: 0.729415/20 [=====================&gt;........] - ETA: 0s - loss: 0.728617/20 [========================&gt;.....] - ETA: 0s - loss: 0.726719/20 [===========================&gt;..] - ETA: 0s - loss: 0.728020/20 [==============================] - 1s 33ms/step - loss: 0.7286 - val_loss: 0.6483
Epoch 8/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.7305 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.6752 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.6382 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.6958 9/20 [============&gt;.................] - ETA: 0s - loss: 0.723911/20 [===============&gt;..............] - ETA: 0s - loss: 0.708713/20 [==================&gt;...........] - ETA: 0s - loss: 0.686215/20 [=====================&gt;........] - ETA: 0s - loss: 0.713917/20 [========================&gt;.....] - ETA: 0s - loss: 0.722619/20 [===========================&gt;..] - ETA: 0s - loss: 0.722420/20 [==============================] - 1s 32ms/step - loss: 0.7231 - val_loss: 0.6213
Epoch 9/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6411 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.6673 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.6509 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.6840 9/20 [============&gt;.................] - ETA: 0s - loss: 0.693811/20 [===============&gt;..............] - ETA: 0s - loss: 0.675213/20 [==================&gt;...........] - ETA: 0s - loss: 0.669115/20 [=====================&gt;........] - ETA: 0s - loss: 0.678417/20 [========================&gt;.....] - ETA: 0s - loss: 0.689719/20 [===========================&gt;..] - ETA: 0s - loss: 0.694620/20 [==============================] - 1s 32ms/step - loss: 0.7017 - val_loss: 0.6281
Epoch 10/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6331 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.6716 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.6482 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.7190 9/20 [============&gt;.................] - ETA: 0s - loss: 0.716511/20 [===============&gt;..............] - ETA: 0s - loss: 0.706913/20 [==================&gt;...........] - ETA: 0s - loss: 0.706115/20 [=====================&gt;........] - ETA: 0s - loss: 0.702717/20 [========================&gt;.....] - ETA: 0s - loss: 0.699919/20 [===========================&gt;..] - ETA: 0s - loss: 0.698820/20 [==============================] - 1s 32ms/step - loss: 0.6953 - val_loss: 0.6136
Epoch 11/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6797 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.5799 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.6618 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.6605 9/20 [============&gt;.................] - ETA: 0s - loss: 0.656011/20 [===============&gt;..............] - ETA: 0s - loss: 0.641613/20 [==================&gt;...........] - ETA: 0s - loss: 0.647315/20 [=====================&gt;........] - ETA: 0s - loss: 0.678317/20 [========================&gt;.....] - ETA: 0s - loss: 0.686519/20 [===========================&gt;..] - ETA: 0s - loss: 0.679920/20 [==============================] - 1s 34ms/step - loss: 0.6878 - val_loss: 0.6329
Epoch 12/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6137 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.6680 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.6817 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.6484 9/20 [============&gt;.................] - ETA: 0s - loss: 0.674011/20 [===============&gt;..............] - ETA: 0s - loss: 0.669413/20 [==================&gt;...........] - ETA: 0s - loss: 0.679215/20 [=====================&gt;........] - ETA: 0s - loss: 0.679517/20 [========================&gt;.....] - ETA: 0s - loss: 0.682419/20 [===========================&gt;..] - ETA: 0s - loss: 0.681520/20 [==============================] - 1s 36ms/step - loss: 0.6722 - val_loss: 0.5766
Epoch 13/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.8347 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.8735 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.8098 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.7321 9/20 [============&gt;.................] - ETA: 0s - loss: 0.712211/20 [===============&gt;..............] - ETA: 0s - loss: 0.681913/20 [==================&gt;...........] - ETA: 0s - loss: 0.671615/20 [=====================&gt;........] - ETA: 0s - loss: 0.670917/20 [========================&gt;.....] - ETA: 0s - loss: 0.686819/20 [===========================&gt;..] - ETA: 0s - loss: 0.677520/20 [==============================] - 1s 36ms/step - loss: 0.6735 - val_loss: 0.5790
Epoch 14/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5201 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.6615 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.7035 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.6828 9/20 [============&gt;.................] - ETA: 0s - loss: 0.697211/20 [===============&gt;..............] - ETA: 0s - loss: 0.680813/20 [==================&gt;...........] - ETA: 0s - loss: 0.682715/20 [=====================&gt;........] - ETA: 0s - loss: 0.666717/20 [========================&gt;.....] - ETA: 0s - loss: 0.657819/20 [===========================&gt;..] - ETA: 0s - loss: 0.664120/20 [==============================] - 1s 34ms/step - loss: 0.6557 - val_loss: 0.5943
Epoch 15/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.7952 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.6166 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.5791 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.5570 9/20 [============&gt;.................] - ETA: 0s - loss: 0.583611/20 [===============&gt;..............] - ETA: 0s - loss: 0.599113/20 [==================&gt;...........] - ETA: 0s - loss: 0.612615/20 [=====================&gt;........] - ETA: 0s - loss: 0.623717/20 [========================&gt;.....] - ETA: 0s - loss: 0.633819/20 [===========================&gt;..] - ETA: 0s - loss: 0.634320/20 [==============================] - 1s 34ms/step - loss: 0.6418 - val_loss: 0.6089
Epoch 16/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6297 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.6338 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.6264 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.6232 9/20 [============&gt;.................] - ETA: 0s - loss: 0.641111/20 [===============&gt;..............] - ETA: 0s - loss: 0.631513/20 [==================&gt;...........] - ETA: 0s - loss: 0.655215/20 [=====================&gt;........] - ETA: 0s - loss: 0.648117/20 [========================&gt;.....] - ETA: 0s - loss: 0.642119/20 [===========================&gt;..] - ETA: 0s - loss: 0.637720/20 [==============================] - 1s 35ms/step - loss: 0.6439 - val_loss: 0.5948
Epoch 17/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.7144 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.5802 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.6025 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.6138 9/20 [============&gt;.................] - ETA: 0s - loss: 0.631611/20 [===============&gt;..............] - ETA: 0s - loss: 0.645513/20 [==================&gt;...........] - ETA: 0s - loss: 0.637915/20 [=====================&gt;........] - ETA: 0s - loss: 0.641717/20 [========================&gt;.....] - ETA: 0s - loss: 0.641919/20 [===========================&gt;..] - ETA: 0s - loss: 0.636920/20 [==============================] - 1s 36ms/step - loss: 0.6413 - val_loss: 0.5656
Epoch 18/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.7367 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.6736 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.7217 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.6614 9/20 [============&gt;.................] - ETA: 0s - loss: 0.621211/20 [===============&gt;..............] - ETA: 0s - loss: 0.637113/20 [==================&gt;...........] - ETA: 0s - loss: 0.626515/20 [=====================&gt;........] - ETA: 0s - loss: 0.620517/20 [========================&gt;.....] - ETA: 0s - loss: 0.629319/20 [===========================&gt;..] - ETA: 0s - loss: 0.647620/20 [==============================] - 1s 35ms/step - loss: 0.6454 - val_loss: 0.5686
Epoch 19/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6038 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.5871 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.6226 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.6329 9/20 [============&gt;.................] - ETA: 0s - loss: 0.647711/20 [===============&gt;..............] - ETA: 0s - loss: 0.655813/20 [==================&gt;...........] - ETA: 0s - loss: 0.643015/20 [=====================&gt;........] - ETA: 0s - loss: 0.641617/20 [========================&gt;.....] - ETA: 0s - loss: 0.628919/20 [===========================&gt;..] - ETA: 0s - loss: 0.627520/20 [==============================] - 1s 39ms/step - loss: 0.6347 - val_loss: 0.6075
Epoch 20/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5419 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.6017 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.6233 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.6280 9/20 [============&gt;.................] - ETA: 0s - loss: 0.620511/20 [===============&gt;..............] - ETA: 0s - loss: 0.607613/20 [==================&gt;...........] - ETA: 0s - loss: 0.610615/20 [=====================&gt;........] - ETA: 0s - loss: 0.616717/20 [========================&gt;.....] - ETA: 0s - loss: 0.614219/20 [===========================&gt;..] - ETA: 0s - loss: 0.621720/20 [==============================] - 1s 38ms/step - loss: 0.6339 - val_loss: 0.6081
Epoch 21/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5417 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.6239 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.6647 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.6533 9/20 [============&gt;.................] - ETA: 0s - loss: 0.650411/20 [===============&gt;..............] - ETA: 0s - loss: 0.659813/20 [==================&gt;...........] - ETA: 0s - loss: 0.637515/20 [=====================&gt;........] - ETA: 0s - loss: 0.633717/20 [========================&gt;.....] - ETA: 0s - loss: 0.630619/20 [===========================&gt;..] - ETA: 0s - loss: 0.634420/20 [==============================] - 1s 38ms/step - loss: 0.6383 - val_loss: 0.5646
Epoch 22/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6649 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.6578 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.6860 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.7242 9/20 [============&gt;.................] - ETA: 0s - loss: 0.685511/20 [===============&gt;..............] - ETA: 0s - loss: 0.662613/20 [==================&gt;...........] - ETA: 0s - loss: 0.647715/20 [=====================&gt;........] - ETA: 0s - loss: 0.632617/20 [========================&gt;.....] - ETA: 0s - loss: 0.639719/20 [===========================&gt;..] - ETA: 0s - loss: 0.635520/20 [==============================] - 1s 37ms/step - loss: 0.6346 - val_loss: 0.5717
Epoch 23/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6613 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.6288 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.6319 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.6290 9/20 [============&gt;.................] - ETA: 0s - loss: 0.629511/20 [===============&gt;..............] - ETA: 0s - loss: 0.636913/20 [==================&gt;...........] - ETA: 0s - loss: 0.613815/20 [=====================&gt;........] - ETA: 0s - loss: 0.631417/20 [========================&gt;.....] - ETA: 0s - loss: 0.634219/20 [===========================&gt;..] - ETA: 0s - loss: 0.624520/20 [==============================] - 1s 40ms/step - loss: 0.6254 - val_loss: 0.6151
Epoch 24/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.8120 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.8504 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.7199 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.6740 9/20 [============&gt;.................] - ETA: 0s - loss: 0.639711/20 [===============&gt;..............] - ETA: 0s - loss: 0.641313/20 [==================&gt;...........] - ETA: 0s - loss: 0.636615/20 [=====================&gt;........] - ETA: 0s - loss: 0.641417/20 [========================&gt;.....] - ETA: 0s - loss: 0.639819/20 [===========================&gt;..] - ETA: 0s - loss: 0.633820/20 [==============================] - 1s 39ms/step - loss: 0.6323 - val_loss: 0.5940
Epoch 25/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.8496 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.7566 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.7237 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.6809 9/20 [============&gt;.................] - ETA: 0s - loss: 0.665911/20 [===============&gt;..............] - ETA: 0s - loss: 0.650013/20 [==================&gt;...........] - ETA: 0s - loss: 0.646015/20 [=====================&gt;........] - ETA: 0s - loss: 0.634617/20 [========================&gt;.....] - ETA: 0s - loss: 0.635019/20 [===========================&gt;..] - ETA: 0s - loss: 0.636020/20 [==============================] - 1s 40ms/step - loss: 0.6279 - val_loss: 0.5931
Epoch 26/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6931 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.6530 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.6706 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.6816 9/20 [============&gt;.................] - ETA: 0s - loss: 0.667311/20 [===============&gt;..............] - ETA: 0s - loss: 0.639813/20 [==================&gt;...........] - ETA: 0s - loss: 0.647215/20 [=====================&gt;........] - ETA: 0s - loss: 0.633817/20 [========================&gt;.....] - ETA: 0s - loss: 0.632619/20 [===========================&gt;..] - ETA: 0s - loss: 0.631920/20 [==============================] - 1s 42ms/step - loss: 0.6227 - val_loss: 0.5534
Epoch 27/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5503 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.4878 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.5121 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.5640 9/20 [============&gt;.................] - ETA: 0s - loss: 0.562211/20 [===============&gt;..............] - ETA: 0s - loss: 0.622213/20 [==================&gt;...........] - ETA: 0s - loss: 0.621315/20 [=====================&gt;........] - ETA: 0s - loss: 0.605017/20 [========================&gt;.....] - ETA: 0s - loss: 0.618319/20 [===========================&gt;..] - ETA: 0s - loss: 0.627720/20 [==============================] - 1s 40ms/step - loss: 0.6250 - val_loss: 0.5528
Epoch 28/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.4992 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.5616 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.5365 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.5781 9/20 [============&gt;.................] - ETA: 0s - loss: 0.575711/20 [===============&gt;..............] - ETA: 0s - loss: 0.606013/20 [==================&gt;...........] - ETA: 0s - loss: 0.604515/20 [=====================&gt;........] - ETA: 0s - loss: 0.617617/20 [========================&gt;.....] - ETA: 0s - loss: 0.623019/20 [===========================&gt;..] - ETA: 0s - loss: 0.623720/20 [==============================] - 1s 39ms/step - loss: 0.6207 - val_loss: 0.5964
Epoch 29/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5041 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.5156 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.5272 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.5351 9/20 [============&gt;.................] - ETA: 0s - loss: 0.554311/20 [===============&gt;..............] - ETA: 0s - loss: 0.558913/20 [==================&gt;...........] - ETA: 0s - loss: 0.575315/20 [=====================&gt;........] - ETA: 0s - loss: 0.601217/20 [========================&gt;.....] - ETA: 0s - loss: 0.623119/20 [===========================&gt;..] - ETA: 0s - loss: 0.629220/20 [==============================] - 1s 40ms/step - loss: 0.6253 - val_loss: 0.5589
Epoch 30/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5651 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.5488 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.6513 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.6680 9/20 [============&gt;.................] - ETA: 0s - loss: 0.663811/20 [===============&gt;..............] - ETA: 0s - loss: 0.635013/20 [==================&gt;...........] - ETA: 0s - loss: 0.639415/20 [=====================&gt;........] - ETA: 0s - loss: 0.646717/20 [========================&gt;.....] - ETA: 0s - loss: 0.646619/20 [===========================&gt;..] - ETA: 0s - loss: 0.636320/20 [==============================] - 1s 39ms/step - loss: 0.6207 - val_loss: 0.5622
Epoch 31/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5119 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.5750 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.5395 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.5486 9/20 [============&gt;.................] - ETA: 0s - loss: 0.571011/20 [===============&gt;..............] - ETA: 0s - loss: 0.600013/20 [==================&gt;...........] - ETA: 0s - loss: 0.611415/20 [=====================&gt;........] - ETA: 0s - loss: 0.615417/20 [========================&gt;.....] - ETA: 0s - loss: 0.622519/20 [===========================&gt;..] - ETA: 0s - loss: 0.608820/20 [==============================] - 1s 39ms/step - loss: 0.6150 - val_loss: 0.5762
Epoch 32/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6557 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.6126 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.6361 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.5972 9/20 [============&gt;.................] - ETA: 0s - loss: 0.602511/20 [===============&gt;..............] - ETA: 0s - loss: 0.608613/20 [==================&gt;...........] - ETA: 0s - loss: 0.617915/20 [=====================&gt;........] - ETA: 0s - loss: 0.614317/20 [========================&gt;.....] - ETA: 0s - loss: 0.617319/20 [===========================&gt;..] - ETA: 0s - loss: 0.622420/20 [==============================] - 1s 39ms/step - loss: 0.6194 - val_loss: 0.5594
Epoch 33/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5470 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.6645 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.6713 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.6497 9/20 [============&gt;.................] - ETA: 0s - loss: 0.634011/20 [===============&gt;..............] - ETA: 0s - loss: 0.631913/20 [==================&gt;...........] - ETA: 0s - loss: 0.645515/20 [=====================&gt;........] - ETA: 0s - loss: 0.632217/20 [========================&gt;.....] - ETA: 0s - loss: 0.619819/20 [===========================&gt;..] - ETA: 0s - loss: 0.616720/20 [==============================] - 1s 39ms/step - loss: 0.6095 - val_loss: 0.5765
Epoch 34/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.7812 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.6804 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.6364 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.6230 9/20 [============&gt;.................] - ETA: 0s - loss: 0.633111/20 [===============&gt;..............] - ETA: 0s - loss: 0.608113/20 [==================&gt;...........] - ETA: 0s - loss: 0.633815/20 [=====================&gt;........] - ETA: 0s - loss: 0.626617/20 [========================&gt;.....] - ETA: 0s - loss: 0.625019/20 [===========================&gt;..] - ETA: 0s - loss: 0.616920/20 [==============================] - 1s 39ms/step - loss: 0.6121 - val_loss: 0.5806
Epoch 35/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.7443 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.6474 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.6584 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.6732 9/20 [============&gt;.................] - ETA: 0s - loss: 0.670011/20 [===============&gt;..............] - ETA: 0s - loss: 0.647413/20 [==================&gt;...........] - ETA: 0s - loss: 0.622415/20 [=====================&gt;........] - ETA: 0s - loss: 0.627117/20 [========================&gt;.....] - ETA: 0s - loss: 0.623119/20 [===========================&gt;..] - ETA: 0s - loss: 0.618720/20 [==============================] - 1s 39ms/step - loss: 0.6154 - val_loss: 0.5783
Epoch 36/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6817 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.6519 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.6639 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.6387 9/20 [============&gt;.................] - ETA: 0s - loss: 0.615811/20 [===============&gt;..............] - ETA: 0s - loss: 0.596713/20 [==================&gt;...........] - ETA: 0s - loss: 0.587815/20 [=====================&gt;........] - ETA: 0s - loss: 0.595417/20 [========================&gt;.....] - ETA: 0s - loss: 0.605019/20 [===========================&gt;..] - ETA: 0s - loss: 0.602920/20 [==============================] - 1s 40ms/step - loss: 0.6114 - val_loss: 0.5445
Epoch 37/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.8976 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.6577 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.6309 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.6141 9/20 [============&gt;.................] - ETA: 0s - loss: 0.582111/20 [===============&gt;..............] - ETA: 0s - loss: 0.578613/20 [==================&gt;...........] - ETA: 0s - loss: 0.596215/20 [=====================&gt;........] - ETA: 0s - loss: 0.601917/20 [========================&gt;.....] - ETA: 0s - loss: 0.599619/20 [===========================&gt;..] - ETA: 0s - loss: 0.599020/20 [==============================] - 1s 40ms/step - loss: 0.6026 - val_loss: 0.5567
Epoch 38/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6589 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.5445 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.6073 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.5818 9/20 [============&gt;.................] - ETA: 0s - loss: 0.576411/20 [===============&gt;..............] - ETA: 0s - loss: 0.591013/20 [==================&gt;...........] - ETA: 0s - loss: 0.606215/20 [=====================&gt;........] - ETA: 0s - loss: 0.608617/20 [========================&gt;.....] - ETA: 0s - loss: 0.606019/20 [===========================&gt;..] - ETA: 0s - loss: 0.615220/20 [==============================] - 1s 39ms/step - loss: 0.6086 - val_loss: 0.5461
Epoch 39/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6587 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.5656 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.6076 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.6009 9/20 [============&gt;.................] - ETA: 0s - loss: 0.597011/20 [===============&gt;..............] - ETA: 0s - loss: 0.601513/20 [==================&gt;...........] - ETA: 0s - loss: 0.592715/20 [=====================&gt;........] - ETA: 0s - loss: 0.590417/20 [========================&gt;.....] - ETA: 0s - loss: 0.600219/20 [===========================&gt;..] - ETA: 0s - loss: 0.599320/20 [==============================] - 1s 39ms/step - loss: 0.6096 - val_loss: 0.5226
Epoch 40/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.4451 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.5174 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.5639 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.5768 9/20 [============&gt;.................] - ETA: 0s - loss: 0.606411/20 [===============&gt;..............] - ETA: 0s - loss: 0.604113/20 [==================&gt;...........] - ETA: 0s - loss: 0.601215/20 [=====================&gt;........] - ETA: 0s - loss: 0.619617/20 [========================&gt;.....] - ETA: 0s - loss: 0.609919/20 [===========================&gt;..] - ETA: 0s - loss: 0.609420/20 [==============================] - 1s 39ms/step - loss: 0.6070 - val_loss: 0.5725</code></pre>
</div>
</div>
<div class="cell" data-execution_count="18">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>spy_4_t_pred <span class="op">=</span> model.predict(spy_x)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>spy_4_t_pred <span class="op">=</span> spy_4_t_pred</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>spy_4_v_pred <span class="op">=</span> model.predict(spy_val_x)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>spy_4_v_pred.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> 1/15 [=&gt;............................] - ETA: 7s 9/15 [=================&gt;............] - ETA: 0s15/15 [==============================] - 1s 7ms/step
1/3 [=========&gt;....................] - ETA: 0s3/3 [==============================] - 0s 7ms/step</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>(69, 31, 1)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="19">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>history_plot(history_spy_4_noreg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="Deep Learning for TS_files/figure-html/cell-20-output-1.png" width="597" height="449"></p>
</div>
</div>
<p>With a much larger model of 3x64 neuron LSTM layers, we can see that the validation loss is still around 55. However, the training loss has a consistent curve down to the validation loss. It is interesting that even in the later epochs, the validation loss remains lower than the training.</p>
</section>
<section id="comparing-results-of-deep-learning-models" class="level2">
<h2 class="anchored" data-anchor-id="comparing-results-of-deep-learning-models">Comparing Results of Deep Learning Models</h2>
<p>Of the three neural network models, the LSTM provided the most consistent performance, while the RNN provided the best performance. The GRU model performed slightly worse than the other two, as measured by its validation set performance. Interestingly, the complexity required for the model to avoid underfitting was much higher with the LSTM model, where 3 hidden layers of 64 neurons each were needed before I felt the training plot showed excess training performance over validation performance. With smaller models, the LSTM performed somewhat poorly on the training set in comparison to the validation set. In terms of accuracy, the RNN model was notable for sometimes reaching below 0.55 loss in performance on the validation set, while the LSTM model usually reached around 0.56 and the GRU model between 0.56 and 0.6. In terms of predictive power (extrapolating outside the validation set) I would tend to trust the LSTM model, because it had the most consistent performance once it was trained over a number of epochs, and even boasted the lowest loss on a particular epoch, sometimes reaching as low as 0.51 in the validation set, although these results were not the norm.</p>
<p>Regularization was an important element across the models. It had two main benefits: First, the models achieved better performance faster because they had more consistent improvement and less variation in performance between epochs. Models which included regularization (both L1L2 and dropout regularization) had almost monotonically decreasing loss in the training set, and clear trends toward improvement in the validation set.</p>
<p>The deep learning models will only have the performance described above when they predict 1 observation into the future. This is because they take in the past 30 observations and return 1 prediction. All of the loss estimates are for this 1-step ahead prediction. If we were to predict further into the future with the models, there would be drift or compound error, where the models loss from a previous prediction would be inherited in future predictions that relied upon that past prediction as an input into the model.</p>
<p>The deep learning modelling is more complicated than the univariate modeling from HW3, because there are a range of hyperparameters introduced that make the process of selecting the best model more complicated. Unlike a simple ARIMA model, it is not possible to iterate through all combinations of hidden layer sizes and complexities. As such, I think there is more subjective elements introduced to neural network modeling.</p>
</section>
<section id="comparing-deep-learning-and-traditional-ts-models" class="level2">
<h2 class="anchored" data-anchor-id="comparing-deep-learning-and-traditional-ts-models">Comparing Deep Learning and Traditional TS Models</h2>
<p>We identified ARIMA(3,0,3) as a good model for the SPY data. Lets look at the one step ahead precition of the ARIMA and best-performing (LSTM) neural network model in the validation data:</p>
<div class="cell" data-execution_count="20">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.arima.model <span class="im">import</span> ARIMA</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>modelA <span class="op">=</span> ARIMA(spy_train, order <span class="op">=</span> (<span class="dv">3</span>,<span class="dv">0</span>,<span class="dv">3</span>))</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>modelA <span class="op">=</span> modelA.fit()</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>forecasts_arima <span class="op">=</span> modelA.forecast(<span class="dv">100</span>)</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>predict_arima <span class="op">=</span> ARIMA(spy_val, order <span class="op">=</span> (<span class="dv">3</span>,<span class="dv">0</span>,<span class="dv">3</span>))</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>predict_arima <span class="op">=</span> predict_arima.fit()</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>arimapreds <span class="op">=</span> <span class="bu">list</span>()</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>indexvals <span class="op">=</span> pd.array(<span class="bu">range</span>(<span class="dv">0</span>,<span class="dv">69</span>))</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>arimavals <span class="op">=</span> pd.array(predict_arima.get_prediction().predicted_mean)</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>arimavals <span class="op">=</span> arimavals[<span class="dv">0</span>:<span class="dv">69</span>]</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>nnvals <span class="op">=</span> spy_4_v_pred[:,<span class="dv">0</span>,<span class="dv">0</span>]</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>plt.plot(indexvals, arimavals, label<span class="op">=</span><span class="st">'ARIMA Prediction'</span>)</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>plt.plot(indexvals, nnvals, label<span class="op">=</span><span class="st">'NN Prediction'</span>)</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>plt.plot(indexvals, spy_val_y, label<span class="op">=</span><span class="st">'Real Values'</span>)</span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"One Step Ahead Forecasts in Validation (NN vs. ARIMA)"</span>)</span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>realVals <span class="op">=</span> spy_val_y</span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rmse(pred, tar):</span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.sqrt(((pred <span class="op">-</span> tar) <span class="op">**</span> <span class="dv">2</span>).mean())</span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"arima: "</span>, rmse(arimavals, spy_val_y))</span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Neural Net: "</span>, rmse(nnvals, spy_val_y))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\corwi\AppData\Local\Programs\Python\Python310\lib\site-packages\statsmodels\base\model.py:607: ConvergenceWarning:

Maximum Likelihood optimization failed to converge. Check mle_retvals

C:\Users\corwi\AppData\Local\Programs\Python\Python310\lib\site-packages\statsmodels\base\model.py:607: ConvergenceWarning:

Maximum Likelihood optimization failed to converge. Check mle_retvals
</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Deep Learning for TS_files/figure-html/cell-21-output-2.png" width="582" height="431"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>arima:  0.776142384126778
Neural Net:  0.7071590843066736</code></pre>
</div>
</div>
<p>Looking at a chart of our best-performing Neural Network Model (LSTM) vs.&nbsp;my best performing ARIMA model (3,0,3) from earlier work, vs.&nbsp;the real observed values, a few things become clear. One, neither model type does a perfect job, especially of capturing extremely high or low values. Two, the ARIMA predictions increase and decrease more (have a higher range) thant he NN predictions. However, the ARIMA predictions tend to vary further from 0, while the NN predictions stay close to zero and only alter slightly. Because of this, the RSME of the neural network is actually lower than the ARIMA model, with the neural network having 0.71 RMSE and the ARIMA model having 0.78 RMSE.</p>
<p>However, the neural network is still not the best model I have tested in this project, because the VAR model achieved an RMSE of 0.68 on the same dataset. This suggests that while Neural networks are powerful tools for univariate prediction, the most accurate model predictions may still be those that include exogenous variables.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>