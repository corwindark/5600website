<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Corwin Dark - Deep Learning for TS</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Corwin Dark</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about me.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Introduction.html" rel="" target="">
 <span class="menu-text">Introduction</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Data Sources.html" rel="" target="">
 <span class="menu-text">Data Sources</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Data Visualization.html" rel="" target="">
 <span class="menu-text">Data Visualization</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Exploratory Data Analysis.html" rel="" target="">
 <span class="menu-text">Exploratory Data Analysis</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./ARMA ARIMA SARIMA Models.html" rel="" target="">
 <span class="menu-text">ARMA ARIMA SARIMA MODELS</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./ARIMAX SARIMAX VAR.html" rel="" target="">
 <span class="menu-text">ARIMAX SARIMAX VAR</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Spectral Analysis and Filtering.html" rel="" target="">
 <span class="menu-text">Spectral Analysis and Filtering</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Financial Time Series Models (ARCH GARCH).html" rel="" target="">
 <span class="menu-text">Financial Time Series Models (ARCH GARCH)</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./Deep Learning for TS.html" rel="" target="" aria-current="page">
 <span class="menu-text">Deep Learning for TS</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Conclusions.html" rel="" target="">
 <span class="menu-text">Conclusions</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./dv.html" rel="" target="">
 <span class="menu-text">Data Vizes in TS</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Deep Learning for TS</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras.models <span class="im">import</span> Sequential</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras <span class="im">import</span> layers</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras.optimizers <span class="im">import</span> RMSprop</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> subprocess</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os </span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> install(name):</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    subprocess.call([sys.executable, <span class="st">'-m'</span>, <span class="st">'pip'</span>, <span class="st">'install'</span>, name])</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co">#install('yfinance')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>WARNING:tensorflow:From C:\Users\corwi\anaconda3\Lib\site-packages\keras\src\losses.py:2976: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.
</code></pre>
</div>
</div>
<h2 class="anchored">
Declare Useful Functions
</h2>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> history_plot(history):</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    FS<span class="op">=</span><span class="dv">18</span>   <span class="co">#FONT SIZE</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># PLOTTING THE TRAINING AND VALIDATION LOSS </span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    history_dict <span class="op">=</span> history.history</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    loss_values <span class="op">=</span> history_dict[<span class="st">"loss"</span>]</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    val_loss_values <span class="op">=</span> history_dict[<span class="st">"val_loss"</span>]</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    epochs <span class="op">=</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(loss_values) <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    plt.plot(epochs, loss_values, <span class="st">"bo"</span>, label<span class="op">=</span><span class="st">"Training loss"</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    plt.plot(epochs, val_loss_values, <span class="st">"b"</span>, label<span class="op">=</span><span class="st">"Validation loss"</span>)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">"Training and validation loss"</span>)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">"Epochs"</span>)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">"Loss"</span>)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    plt.legend()</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<h2 class="anchored">
Read in Data
</h2>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> yfinance <span class="im">as</span> yf</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>spy <span class="op">=</span> yf.download(<span class="st">'SPY'</span>,start <span class="op">=</span> <span class="st">"2021-01-01"</span>, end <span class="op">=</span> <span class="st">"2023-09-30"</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>iwm <span class="op">=</span> yf.download(<span class="st">'QQQ'</span>,start <span class="op">=</span> <span class="st">"2021-01-01"</span>, end <span class="op">=</span> <span class="st">"2023-09-30"</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>qqq <span class="op">=</span> yf.download(<span class="st">'IWM'</span>,start <span class="op">=</span> <span class="st">"2021-01-01"</span>, end <span class="op">=</span> <span class="st">"2023-09-30"</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>spyRange <span class="op">=</span> (spy[<span class="st">'High'</span>] <span class="op">-</span> spy[<span class="st">'Low'</span>]) <span class="op">/</span> spy[<span class="st">'Close'</span>]</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>iwmRange <span class="op">=</span> (iwm[<span class="st">'High'</span>] <span class="op">-</span> iwm[<span class="st">'Low'</span>]) <span class="op">/</span> iwm[<span class="st">'Close'</span>]</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>qqqRange <span class="op">=</span> (qqq[<span class="st">'High'</span>] <span class="op">-</span> qqq[<span class="st">'Low'</span>]) <span class="op">/</span> qqq[<span class="st">'Close'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[*********************100%%**********************]  1 of 1 completed
[*********************100%%**********************]  1 of 1 completed
[*********************100%%**********************]  1 of 1 completed</code></pre>
</div>
</div>
<h2 class="anchored">
Normalize
</h2>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Slice training set</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>spy_train <span class="op">=</span> pd.DataFrame( spyRange[<span class="bu">range</span>(<span class="dv">0</span>,<span class="dv">490</span>)] )</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>spy_train <span class="op">=</span> spy_train.reset_index(drop <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Slice validation set</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>spy_val <span class="op">=</span>  pd.DataFrame( spyRange[<span class="bu">range</span>(<span class="dv">490</span>,<span class="dv">590</span>)] )</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>spy_val <span class="op">=</span> spy_val.reset_index(drop <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Slice test set</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>spy_test <span class="op">=</span>  pd.DataFrame( spyRange[<span class="bu">range</span>(<span class="dv">590</span>,<span class="dv">690</span>)] )</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>spy_test <span class="op">=</span> spy_test.reset_index(drop <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Save training normalization to use on test and validation sets</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>spy_train_mean <span class="op">=</span> spy_train.mean()</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>spy_train_std <span class="op">=</span> spy_train.std()</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalize</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>spy_train<span class="op">=</span>(spy_train<span class="op">-</span>spy_train_mean)<span class="op">/</span>spy_train_std</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>spy_val<span class="op">=</span>(spy_val<span class="op">-</span>spy_train_mean)<span class="op">/</span>spy_train_std</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>spy_test<span class="op">=</span>(spy_test<span class="op">-</span>spy_train_mean)<span class="op">/</span>spy_train_std</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<h2 class="anchored">
Fit Helper Function to Create Data in Desired Format
</h2>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># code from lab</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> form_arrays(x,lookback<span class="op">=</span><span class="dv">3</span>,delay<span class="op">=</span><span class="dv">1</span>,step<span class="op">=</span><span class="dv">1</span>,feature_columns<span class="op">=</span>[<span class="dv">0</span>],target_columns<span class="op">=</span>[<span class="dv">0</span>],unique<span class="op">=</span><span class="va">False</span>,verbose<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># verbose=True --&gt; report and plot for debugging</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># unique=True --&gt; don't re-sample:</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># x1,x2,x3 --&gt; x4 then x4,x5,x6 --&gt; x7 instead of x2,x3,x4 --&gt; x5</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># initialize</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    i_start<span class="op">=</span><span class="dv">0</span><span class="op">;</span> count<span class="op">=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># initialize output arrays with samples</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    x_out<span class="op">=</span>[]</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    y_out<span class="op">=</span>[]</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># sequentially build mini-batch samples</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> i_start<span class="op">+</span>lookback<span class="op">+</span>delay<span class="op">&lt;</span> x.shape[<span class="dv">0</span>]:</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># define index bounds</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>        i_stop<span class="op">=</span>i_start<span class="op">+</span>lookback</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>        i_pred<span class="op">=</span>i_stop<span class="op">+</span>delay</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>        <span class="co"># report if desired</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> verbose <span class="kw">and</span> count<span class="op">&lt;</span><span class="dv">2</span>: <span class="bu">print</span>(<span class="st">"indice range:"</span>,i_start,i_stop,<span class="st">"--&gt;"</span>, i_pred)</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>        <span class="co"># define arrays:</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># method-1: buggy due to indexing from left</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>        <span class="co"># numpy's slicing --&gt; start:stop:step</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>        <span class="co"># xtmp=x[i_start:i_stop+1:steps]</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>        <span class="co"># method-2: non-vectorized but cleaner</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>        indices_to_keep<span class="op">=</span>[]<span class="op">;</span> j<span class="op">=</span>i_stop</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> j<span class="op">&gt;=</span>i_start:</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>            indices_to_keep.append(j)</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>            j<span class="op">=</span>j<span class="op">-</span>step</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>        <span class="co"># create mini-batch sample</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>        xtmp<span class="op">=</span>x.iloc[indices_to_keep,:] <span class="co"># isolate relevant indices</span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>        xtmp<span class="op">=</span>xtmp.iloc[:,feature_columns] <span class="co"># isolate desire features</span></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>        ytmp<span class="op">=</span>x.iloc[i_pred,target_columns]</span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>        x_out.append(xtmp)<span class="op">;</span> y_out.append(ytmp)<span class="op">;</span></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>        <span class="co"># report if desired</span></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> verbose <span class="kw">and</span> count<span class="op">&lt;</span><span class="dv">2</span>: <span class="bu">print</span>(xtmp, <span class="st">"--&gt;"</span>,ytmp)</span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> verbose <span class="kw">and</span> count<span class="op">&lt;</span><span class="dv">2</span>: <span class="bu">print</span>(<span class="st">"shape:"</span>,xtmp.shape, <span class="st">"--&gt;"</span>,ytmp.shape)</span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> verbose <span class="kw">and</span> count<span class="op">&lt;</span><span class="dv">2</span>:</span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>            fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>            ax.plot(x,<span class="st">'b-'</span>)</span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>            ax.plot(x,<span class="st">'bx'</span>)</span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>            ax.plot(indices_to_keep,xtmp,<span class="st">'go'</span>)</span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>            ax.plot(i_pred<span class="op">*</span>np.ones(<span class="bu">len</span>(target_columns)),ytmp,<span class="st">'ro'</span>)</span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>            plt.show()</span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>        <span class="co"># UPDATE START POINT</span></span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> unique: i_start<span class="op">+=</span>lookback</span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a>        i_start<span class="op">+=</span><span class="dv">1</span><span class="op">;</span> count<span class="op">+=</span><span class="dv">1</span></span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.array(x_out),np.array(y_out)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Diagnostic plotting functions from the lab</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error,mean_absolute_percentage_error,mean_absolute_error</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># UTILITY FUNCTION</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> regression_report(yt,ytp,yv,yvp):</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"---------- Regression report ----------"</span>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"TRAINING:"</span>)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">" MSE:"</span>,mean_squared_error(yt,ytp))</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">" MAE:"</span>,mean_absolute_error(yt,ytp))</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(" MAPE:",mean_absolute_percentage_error(Yt,Ytp))</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># PARITY PLOT</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    ax.plot(yt,ytp,<span class="st">'ro'</span>)</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    ax.plot(yt,yt,<span class="st">'b-'</span>)</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    ax.<span class="bu">set</span>(xlabel<span class="op">=</span><span class="st">'y_data'</span>, ylabel<span class="op">=</span><span class="st">'y_predicted'</span>,</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">'Training data parity plot (line y=x represents a perfect fit)'</span>)</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># PLOT PART OF THE PREDICTED TIME-SERIES</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>    frac_plot<span class="op">=</span><span class="fl">1.0</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>    upper<span class="op">=</span><span class="bu">int</span>(frac_plot<span class="op">*</span>yt.shape[<span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(int(0.5*yt.shape[0]))</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>    ax.plot(yt[<span class="dv">0</span>:upper],<span class="st">'b-'</span>)</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>    ax.plot(ytp[<span class="dv">0</span>:upper],<span class="st">'r-'</span>,alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>    ax.plot(ytp[<span class="dv">0</span>:upper],<span class="st">'ro'</span>,alpha<span class="op">=</span><span class="fl">0.25</span>)</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>    ax.<span class="bu">set</span>(xlabel<span class="op">=</span><span class="st">'index'</span>, ylabel<span class="op">=</span><span class="st">'y(t (blue=actual &amp; red=prediction)'</span>, title<span class="op">=</span><span class="st">'Training: Time-series prediction'</span>)</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"VALIDATION:"</span>)</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">" MSE:"</span>,mean_squared_error(yv,yvp))</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">" MAE:"</span>,mean_absolute_error(yv,yvp))</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(" MAPE:",mean_absolute_percentage_error(Yt,Ytp))</span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># PARITY PLOT</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>    ax.plot(yv,yvp,<span class="st">'ro'</span>)</span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>    ax.plot(yv,yv,<span class="st">'b-'</span>)</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>    ax.<span class="bu">set</span>(xlabel<span class="op">=</span><span class="st">'y_data'</span>, ylabel<span class="op">=</span><span class="st">'y_predicted'</span>,</span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">'Validation data parity plot (line y=x represents a perfect fit)'</span>)</span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>    <span class="co"># PLOT PART OF THE PREDICTED TIME-SERIES</span></span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>    upper<span class="op">=</span><span class="bu">int</span>(frac_plot<span class="op">*</span>yv.shape[<span class="dv">0</span>])</span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>    ax.plot(yv[<span class="dv">0</span>:upper],<span class="st">'b-'</span>)</span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>    ax.plot(yvp[<span class="dv">0</span>:upper],<span class="st">'r-'</span>,alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>    ax.plot(yvp[<span class="dv">0</span>:upper],<span class="st">'ro'</span>,alpha<span class="op">=</span><span class="fl">0.25</span>)</span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>    ax.<span class="bu">set</span>(xlabel<span class="op">=</span><span class="st">'index'</span>, ylabel<span class="op">=</span><span class="st">'y(t) (blue=actual &amp; red=prediction)'</span>, title<span class="op">=</span><span class="st">'Validation: Time-series prediction'</span>)</span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Use function to reformat data. Train will be 1-490, Validation 491-590, and Test 591-690</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#spy_train = generator(spyRange, lookback=lookback, delay=delay, min_index=0, max_index=489, shuffle=True, step=step, batch_size=batch_size)</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co">#spy_val = generator(spyRange, lookback=lookback, delay=delay, min_index=490, max_index=589, step=step, batch_size=batch_size)</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co">#spy_test = generator(spyRange, lookback=lookback, delay=delay, min_index=590, max_index=690, step=step, batch_size=batch_size)</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>L <span class="op">=</span> <span class="dv">30</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>S <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>D <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>batch_size <span class="op">=</span> <span class="dv">10</span> </span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>spy_x,spy_y<span class="op">=</span>form_arrays(spy_train,lookback<span class="op">=</span>L,delay<span class="op">=</span>D,step<span class="op">=</span>S,unique<span class="op">=</span><span class="va">False</span>,verbose<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>spy_val_x, spy_val_y <span class="op">=</span> form_arrays(spy_val,lookback<span class="op">=</span>L,delay<span class="op">=</span>D,step<span class="op">=</span>S,unique<span class="op">=</span><span class="va">False</span>,verbose<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>indice range: 0 30 --&gt; 31
           0
30 -0.671401
29 -0.885386
28 -0.734102
27 -0.585913
26 -0.212548
25 -1.168214
24 -1.015748
23 -0.973075
22 -0.358360
21 -0.677961
20  0.497549
19  0.548116
18  1.059558
17  0.243034
16  0.998227
15 -0.971943
14  0.294332
13 -0.976559
12 -1.166153
11 -0.404222
10 -0.907305
9  -0.447196
8  -0.729908
7  -0.739743
6  -0.579574
5  -0.785181
4  -0.302614
3  -0.423132
2   0.857734
1  -0.245422
0   1.805622 --&gt; 0   -0.526714
Name: 31, dtype: float64
shape: (31, 1) --&gt; (1,)
indice range: 1 31 --&gt; 32
           0
31 -0.526714
30 -0.671401
29 -0.885386
28 -0.734102
27 -0.585913
26 -0.212548
25 -1.168214
24 -1.015748
23 -0.973075
22 -0.358360
21 -0.677961
20  0.497549
19  0.548116
18  1.059558
17  0.243034
16  0.998227
15 -0.971943
14  0.294332
13 -0.976559
12 -1.166153
11 -0.404222
10 -0.907305
9  -0.447196
8  -0.729908
7  -0.739743
6  -0.579574
5  -0.785181
4  -0.302614
3  -0.423132
2   0.857734
1  -0.245422 --&gt; 0   -0.821283
Name: 32, dtype: float64
shape: (31, 1) --&gt; (1,)
indice range: 0 30 --&gt; 31
           0
30 -0.287952
29 -0.233536
28  0.467138
27 -0.636803
26  0.401771
25  0.651644
24 -0.507879
23  1.045176
22 -0.734373
21  0.055444
20  0.157378
19 -0.405520
18 -0.339190
17  0.188520
16  1.383184
15 -0.716225
14  0.161146
13  1.045477
12 -0.383336
11 -0.031053
10  0.548781
9  -0.587335
8  -0.105081
7   1.954741
6  -0.216591
5  -0.303154
4   0.070543
3   0.055478
2   0.595663
1   1.097443
0   1.755203 --&gt; 0   -0.23042
Name: 31, dtype: float64
shape: (31, 1) --&gt; (1,)
indice range: 1 31 --&gt; 32
           0
31 -0.230420
30 -0.287952
29 -0.233536
28  0.467138
27 -0.636803
26  0.401771
25  0.651644
24 -0.507879
23  1.045176
22 -0.734373
21  0.055444
20  0.157378
19 -0.405520
18 -0.339190
17  0.188520
16  1.383184
15 -0.716225
14  0.161146
13  1.045477
12 -0.383336
11 -0.031053
10  0.548781
9  -0.587335
8  -0.105081
7   1.954741
6  -0.216591
5  -0.303154
4   0.070543
3   0.055478
2   0.595663
1   1.097443 --&gt; 0    0.020882
Name: 32, dtype: float64
shape: (31, 1) --&gt; (1,)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Deep Learning for TS_files/figure-html/cell-8-output-2.png" width="569" height="413"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="Deep Learning for TS_files/figure-html/cell-8-output-3.png" width="569" height="413"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="Deep Learning for TS_files/figure-html/cell-8-output-4.png" width="582" height="411"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="Deep Learning for TS_files/figure-html/cell-8-output-5.png" width="582" height="411"></p>
</div>
</div>
<p>Reshape data</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># RESHAPE INTO A DATA FRAME</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>spy_t_1 <span class="op">=</span> spy_x.reshape(spy_x.shape[<span class="dv">0</span>],spy_x.shape[<span class="dv">1</span>]<span class="op">*</span>spy_x.shape[<span class="dv">2</span>])</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>spy_v_1 <span class="op">=</span> spy_val_x.reshape(spy_val_x.shape[<span class="dv">0</span>],spy_val_x.shape[<span class="dv">1</span>]<span class="op">*</span>spy_val_x.shape[<span class="dv">2</span>])</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>input_shape <span class="op">=</span> (spy_t_1.shape[<span class="dv">1</span>],)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>rnn_input_shape <span class="op">=</span> (spy_x.shape[<span class="dv">1</span>], spy_x.shape[<span class="dv">2</span>])</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co"># NEW SIZES</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"train: "</span>, spy_x.shape,<span class="st">"--&gt;"</span>,spy_t_1.shape)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"validation: "</span>, spy_val_x.shape,<span class="st">"--&gt;"</span>,spy_v_1.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>train:  (459, 31, 1) --&gt; (459, 31)
validation:  (69, 31, 1) --&gt; (69, 31)</code></pre>
</div>
</div>
<h2 class="anchored">
Fit GRU
</h2>
<p>No regularlization</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras.models <span class="im">import</span> Sequential</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras <span class="im">import</span> layers</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras.optimizers <span class="im">import</span> RMSprop</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co"># create a sequential model once again</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Sequential()</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>model.add(layers.Dense(<span class="dv">32</span>, activation<span class="op">=</span><span class="st">'relu'</span>,input_shape<span class="op">=</span>rnn_input_shape))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co"># This layer is the recurent layer, which returns all previous data</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>model.add(layers.GRU(<span class="dv">32</span>, dropout<span class="op">=</span><span class="fl">0.1</span>, recurrent_dropout<span class="op">=</span><span class="fl">0.5</span>, return_sequences<span class="op">=</span><span class="va">True</span>))</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="co"># layer that reads the recurent layer</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>model.add(layers.GRU(<span class="dv">64</span>, activation<span class="op">=</span><span class="st">'relu'</span>, dropout<span class="op">=</span><span class="fl">0.1</span>, recurrent_dropout<span class="op">=</span><span class="fl">0.5</span>))</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>model.add(layers.Dense(<span class="dv">1</span>))</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span>RMSprop(), loss<span class="op">=</span><span class="st">'mae'</span>)</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>history_spy_1_noreg <span class="op">=</span> model.fit(x <span class="op">=</span> spy_x, y <span class="op">=</span> spy_y, steps_per_epoch<span class="op">=</span><span class="dv">20</span>, epochs<span class="op">=</span><span class="dv">30</span>, validation_data<span class="op">=</span> (spy_val_x, spy_val_y), validation_steps<span class="op">=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>WARNING:tensorflow:From C:\Users\corwi\anaconda3\Lib\site-packages\keras\src\backend.py:873: The name tf.get_default_graph is deprecated. Please use tf.compat.v1.get_default_graph instead.

Epoch 1/30
WARNING:tensorflow:From C:\Users\corwi\anaconda3\Lib\site-packages\keras\src\utils\tf_utils.py:492: The name tf.ragged.RaggedTensorValue is deprecated. Please use tf.compat.v1.ragged.RaggedTensorValue instead.

 1/20 [&gt;.............................] - ETA: 1:09 - loss: 0.8158 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.8984   7/20 [=========&gt;....................] - ETA: 0s - loss: 0.793510/20 [==============&gt;...............] - ETA: 0s - loss: 0.807713/20 [==================&gt;...........] - ETA: 0s - loss: 0.793616/20 [=======================&gt;......] - ETA: 0s - loss: 0.778619/20 [===========================&gt;..] - ETA: 0s - loss: 0.753120/20 [==============================] - 5s 44ms/step - loss: 0.7433 - val_loss: 0.5360
Epoch 2/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5801 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.7277 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.681510/20 [==============&gt;...............] - ETA: 0s - loss: 0.723213/20 [==================&gt;...........] - ETA: 0s - loss: 0.744016/20 [=======================&gt;......] - ETA: 0s - loss: 0.740719/20 [===========================&gt;..] - ETA: 0s - loss: 0.731720/20 [==============================] - 0s 22ms/step - loss: 0.7323 - val_loss: 0.5484
Epoch 3/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5860 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.7010 8/20 [===========&gt;..................] - ETA: 0s - loss: 0.694511/20 [===============&gt;..............] - ETA: 0s - loss: 0.688814/20 [====================&gt;.........] - ETA: 0s - loss: 0.714517/20 [========================&gt;.....] - ETA: 0s - loss: 0.731220/20 [==============================] - ETA: 0s - loss: 0.726920/20 [==============================] - 0s 22ms/step - loss: 0.7269 - val_loss: 0.5731
Epoch 4/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 1.0610 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.7268 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.687110/20 [==============&gt;...............] - ETA: 0s - loss: 0.708213/20 [==================&gt;...........] - ETA: 0s - loss: 0.730616/20 [=======================&gt;......] - ETA: 0s - loss: 0.727719/20 [===========================&gt;..] - ETA: 0s - loss: 0.728020/20 [==============================] - 0s 22ms/step - loss: 0.7259 - val_loss: 0.5488
Epoch 5/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5968 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.7603 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.774810/20 [==============&gt;...............] - ETA: 0s - loss: 0.744413/20 [==================&gt;...........] - ETA: 0s - loss: 0.769516/20 [=======================&gt;......] - ETA: 0s - loss: 0.753319/20 [===========================&gt;..] - ETA: 0s - loss: 0.724820/20 [==============================] - 0s 22ms/step - loss: 0.7214 - val_loss: 0.5585
Epoch 6/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6397 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.6916 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.743810/20 [==============&gt;...............] - ETA: 0s - loss: 0.766513/20 [==================&gt;...........] - ETA: 0s - loss: 0.732016/20 [=======================&gt;......] - ETA: 0s - loss: 0.711119/20 [===========================&gt;..] - ETA: 0s - loss: 0.710920/20 [==============================] - 0s 22ms/step - loss: 0.7135 - val_loss: 0.5943
Epoch 7/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.7437 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.6267 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.656610/20 [==============&gt;...............] - ETA: 0s - loss: 0.664513/20 [==================&gt;...........] - ETA: 0s - loss: 0.699116/20 [=======================&gt;......] - ETA: 0s - loss: 0.695119/20 [===========================&gt;..] - ETA: 0s - loss: 0.707120/20 [==============================] - 0s 22ms/step - loss: 0.7107 - val_loss: 0.6458
Epoch 8/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6461 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.7416 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.733510/20 [==============&gt;...............] - ETA: 0s - loss: 0.720713/20 [==================&gt;...........] - ETA: 0s - loss: 0.708516/20 [=======================&gt;......] - ETA: 0s - loss: 0.688719/20 [===========================&gt;..] - ETA: 0s - loss: 0.700320/20 [==============================] - 0s 22ms/step - loss: 0.6946 - val_loss: 0.6563
Epoch 9/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6996 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.7498 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.684110/20 [==============&gt;...............] - ETA: 0s - loss: 0.688413/20 [==================&gt;...........] - ETA: 0s - loss: 0.673416/20 [=======================&gt;......] - ETA: 0s - loss: 0.663619/20 [===========================&gt;..] - ETA: 0s - loss: 0.665220/20 [==============================] - 0s 22ms/step - loss: 0.6647 - val_loss: 0.5852
Epoch 10/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6732 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.5940 8/20 [===========&gt;..................] - ETA: 0s - loss: 0.553311/20 [===============&gt;..............] - ETA: 0s - loss: 0.599514/20 [====================&gt;.........] - ETA: 0s - loss: 0.630417/20 [========================&gt;.....] - ETA: 0s - loss: 0.653220/20 [==============================] - ETA: 0s - loss: 0.633320/20 [==============================] - 0s 22ms/step - loss: 0.6333 - val_loss: 0.5995
Epoch 11/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6000 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.7122 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.635610/20 [==============&gt;...............] - ETA: 0s - loss: 0.638213/20 [==================&gt;...........] - ETA: 0s - loss: 0.634116/20 [=======================&gt;......] - ETA: 0s - loss: 0.638619/20 [===========================&gt;..] - ETA: 0s - loss: 0.640720/20 [==============================] - 0s 22ms/step - loss: 0.6359 - val_loss: 0.5958
Epoch 12/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5697 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.5937 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.592710/20 [==============&gt;...............] - ETA: 0s - loss: 0.603413/20 [==================&gt;...........] - ETA: 0s - loss: 0.602516/20 [=======================&gt;......] - ETA: 0s - loss: 0.638819/20 [===========================&gt;..] - ETA: 0s - loss: 0.630320/20 [==============================] - 0s 22ms/step - loss: 0.6330 - val_loss: 0.5327
Epoch 13/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6114 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.5519 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.598410/20 [==============&gt;...............] - ETA: 0s - loss: 0.625913/20 [==================&gt;...........] - ETA: 0s - loss: 0.637616/20 [=======================&gt;......] - ETA: 0s - loss: 0.627419/20 [===========================&gt;..] - ETA: 0s - loss: 0.624420/20 [==============================] - 0s 23ms/step - loss: 0.6326 - val_loss: 0.5469
Epoch 14/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5086 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.5602 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.628110/20 [==============&gt;...............] - ETA: 0s - loss: 0.639713/20 [==================&gt;...........] - ETA: 0s - loss: 0.653916/20 [=======================&gt;......] - ETA: 0s - loss: 0.649519/20 [===========================&gt;..] - ETA: 0s - loss: 0.634320/20 [==============================] - 0s 22ms/step - loss: 0.6323 - val_loss: 0.5226
Epoch 15/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5587 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.5892 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.597510/20 [==============&gt;...............] - ETA: 0s - loss: 0.642113/20 [==================&gt;...........] - ETA: 0s - loss: 0.617416/20 [=======================&gt;......] - ETA: 0s - loss: 0.621019/20 [===========================&gt;..] - ETA: 0s - loss: 0.631520/20 [==============================] - 0s 22ms/step - loss: 0.6309 - val_loss: 0.5197
Epoch 16/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5431 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.6399 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.629010/20 [==============&gt;...............] - ETA: 0s - loss: 0.577313/20 [==================&gt;...........] - ETA: 0s - loss: 0.592916/20 [=======================&gt;......] - ETA: 0s - loss: 0.627619/20 [===========================&gt;..] - ETA: 0s - loss: 0.611220/20 [==============================] - 0s 22ms/step - loss: 0.6168 - val_loss: 0.5698
Epoch 17/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6461 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.5865 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.566510/20 [==============&gt;...............] - ETA: 0s - loss: 0.600313/20 [==================&gt;...........] - ETA: 0s - loss: 0.624716/20 [=======================&gt;......] - ETA: 0s - loss: 0.638119/20 [===========================&gt;..] - ETA: 0s - loss: 0.625120/20 [==============================] - 0s 22ms/step - loss: 0.6210 - val_loss: 0.5435
Epoch 18/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5996 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.6508 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.637910/20 [==============&gt;...............] - ETA: 0s - loss: 0.618213/20 [==================&gt;...........] - ETA: 0s - loss: 0.611116/20 [=======================&gt;......] - ETA: 0s - loss: 0.619019/20 [===========================&gt;..] - ETA: 0s - loss: 0.617620/20 [==============================] - 0s 22ms/step - loss: 0.6196 - val_loss: 0.5368
Epoch 19/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5323 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.5935 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.623310/20 [==============&gt;...............] - ETA: 0s - loss: 0.624013/20 [==================&gt;...........] - ETA: 0s - loss: 0.608216/20 [=======================&gt;......] - ETA: 0s - loss: 0.606919/20 [===========================&gt;..] - ETA: 0s - loss: 0.629920/20 [==============================] - 0s 23ms/step - loss: 0.6265 - val_loss: 0.5443
Epoch 20/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5812 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.5520 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.598810/20 [==============&gt;...............] - ETA: 0s - loss: 0.600013/20 [==================&gt;...........] - ETA: 0s - loss: 0.592816/20 [=======================&gt;......] - ETA: 0s - loss: 0.581619/20 [===========================&gt;..] - ETA: 0s - loss: 0.606320/20 [==============================] - 0s 22ms/step - loss: 0.6063 - val_loss: 0.6207
Epoch 21/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.4990 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.6046 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.666110/20 [==============&gt;...............] - ETA: 0s - loss: 0.647813/20 [==================&gt;...........] - ETA: 0s - loss: 0.649616/20 [=======================&gt;......] - ETA: 0s - loss: 0.634019/20 [===========================&gt;..] - ETA: 0s - loss: 0.609620/20 [==============================] - 0s 22ms/step - loss: 0.6197 - val_loss: 0.5967
Epoch 22/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6261 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.6112 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.631610/20 [==============&gt;...............] - ETA: 0s - loss: 0.657213/20 [==================&gt;...........] - ETA: 0s - loss: 0.642416/20 [=======================&gt;......] - ETA: 0s - loss: 0.635819/20 [===========================&gt;..] - ETA: 0s - loss: 0.626520/20 [==============================] - 0s 22ms/step - loss: 0.6203 - val_loss: 0.5793
Epoch 23/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.4032 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.5237 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.572910/20 [==============&gt;...............] - ETA: 0s - loss: 0.571813/20 [==================&gt;...........] - ETA: 0s - loss: 0.583716/20 [=======================&gt;......] - ETA: 0s - loss: 0.594619/20 [===========================&gt;..] - ETA: 0s - loss: 0.601720/20 [==============================] - 0s 22ms/step - loss: 0.5980 - val_loss: 0.5456
Epoch 24/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5575 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.5869 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.574310/20 [==============&gt;...............] - ETA: 0s - loss: 0.580513/20 [==================&gt;...........] - ETA: 0s - loss: 0.629616/20 [=======================&gt;......] - ETA: 0s - loss: 0.614719/20 [===========================&gt;..] - ETA: 0s - loss: 0.612620/20 [==============================] - 0s 22ms/step - loss: 0.6130 - val_loss: 0.5270
Epoch 25/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5435 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.5726 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.592010/20 [==============&gt;...............] - ETA: 0s - loss: 0.621013/20 [==================&gt;...........] - ETA: 0s - loss: 0.607916/20 [=======================&gt;......] - ETA: 0s - loss: 0.603419/20 [===========================&gt;..] - ETA: 0s - loss: 0.604420/20 [==============================] - 0s 23ms/step - loss: 0.6043 - val_loss: 0.6489
Epoch 26/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.4289 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.5952 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.599010/20 [==============&gt;...............] - ETA: 0s - loss: 0.621413/20 [==================&gt;...........] - ETA: 0s - loss: 0.625716/20 [=======================&gt;......] - ETA: 0s - loss: 0.628619/20 [===========================&gt;..] - ETA: 0s - loss: 0.623720/20 [==============================] - 0s 23ms/step - loss: 0.6134 - val_loss: 0.5914
Epoch 27/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6028 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.6326 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.567010/20 [==============&gt;...............] - ETA: 0s - loss: 0.590013/20 [==================&gt;...........] - ETA: 0s - loss: 0.609816/20 [=======================&gt;......] - ETA: 0s - loss: 0.612119/20 [===========================&gt;..] - ETA: 0s - loss: 0.609820/20 [==============================] - 0s 23ms/step - loss: 0.5996 - val_loss: 0.6357
Epoch 28/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5353 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.5894 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.572210/20 [==============&gt;...............] - ETA: 0s - loss: 0.573313/20 [==================&gt;...........] - ETA: 0s - loss: 0.589717/20 [========================&gt;.....] - ETA: 0s - loss: 0.593420/20 [==============================] - ETA: 0s - loss: 0.601320/20 [==============================] - 0s 22ms/step - loss: 0.6013 - val_loss: 0.5165
Epoch 29/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.4733 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.6235 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.653710/20 [==============&gt;...............] - ETA: 0s - loss: 0.613213/20 [==================&gt;...........] - ETA: 0s - loss: 0.585816/20 [=======================&gt;......] - ETA: 0s - loss: 0.588919/20 [===========================&gt;..] - ETA: 0s - loss: 0.596920/20 [==============================] - 0s 22ms/step - loss: 0.6035 - val_loss: 0.5747
Epoch 30/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.7343 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.5774 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.617710/20 [==============&gt;...............] - ETA: 0s - loss: 0.590513/20 [==================&gt;...........] - ETA: 0s - loss: 0.597416/20 [=======================&gt;......] - ETA: 0s - loss: 0.597219/20 [===========================&gt;..] - ETA: 0s - loss: 0.599520/20 [==============================] - 0s 22ms/step - loss: 0.5912 - val_loss: 0.5350</code></pre>
</div>
</div>
<p>Lets plot results</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>history_plot(history_spy_1_noreg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Deep Learning for TS_files/figure-html/cell-11-output-1.png" width="597" height="449"></p>
</div>
</div>
<p>Regularlization</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras <span class="im">import</span> regularizers</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>L1<span class="op">=</span><span class="dv">0</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>L2<span class="op">=</span><span class="fl">1e-3</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co"># create a sequential model once again</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Sequential()</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>model.add(layers.Dense(<span class="dv">32</span>, activation<span class="op">=</span><span class="st">'relu'</span>,input_shape<span class="op">=</span>rnn_input_shape,kernel_regularizer<span class="op">=</span>regularizers.L1L2(l1<span class="op">=</span>L1, l2<span class="op">=</span>L2)))</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="co"># This layer is the recurent layer, which returns all previous data</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>model.add(layers.GRU(<span class="dv">32</span>, dropout<span class="op">=</span><span class="fl">0.1</span>, recurrent_dropout<span class="op">=</span><span class="fl">0.5</span>, return_sequences<span class="op">=</span><span class="va">True</span>, recurrent_regularizer<span class="op">=</span>regularizers.L1L2(l1<span class="op">=</span>L1, l2<span class="op">=</span>L2)))</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="co"># layer that reads the recurent layer</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>model.add(layers.GRU(<span class="dv">64</span>, activation<span class="op">=</span><span class="st">'relu'</span>, dropout<span class="op">=</span><span class="fl">0.1</span>, recurrent_dropout<span class="op">=</span><span class="fl">0.5</span>,kernel_regularizer<span class="op">=</span>regularizers.L1L2(l1<span class="op">=</span>L1, l2<span class="op">=</span>L2)))</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>model.add(layers.Dense(<span class="dv">1</span>))</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span>RMSprop(), loss<span class="op">=</span><span class="st">'mae'</span>)</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>history_spy_1_reg <span class="op">=</span> model.fit(x <span class="op">=</span> spy_x, y <span class="op">=</span> spy_y, steps_per_epoch<span class="op">=</span><span class="dv">20</span>, epochs<span class="op">=</span><span class="dv">30</span>, validation_data<span class="op">=</span> (spy_val_x, spy_val_y), validation_steps<span class="op">=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 1/30
 1/20 [&gt;.............................] - ETA: 1:09 - loss: 0.8266 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.8020   8/20 [===========&gt;..................] - ETA: 0s - loss: 0.813111/20 [===============&gt;..............] - ETA: 0s - loss: 0.819014/20 [====================&gt;.........] - ETA: 0s - loss: 0.820317/20 [========================&gt;.....] - ETA: 0s - loss: 0.821720/20 [==============================] - ETA: 0s - loss: 0.824420/20 [==============================] - 4s 43ms/step - loss: 0.8244 - val_loss: 0.6315
Epoch 2/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6966 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.7975 8/20 [===========&gt;..................] - ETA: 0s - loss: 0.827611/20 [===============&gt;..............] - ETA: 0s - loss: 0.851714/20 [====================&gt;.........] - ETA: 0s - loss: 0.815917/20 [========================&gt;.....] - ETA: 0s - loss: 0.801020/20 [==============================] - ETA: 0s - loss: 0.798220/20 [==============================] - 0s 22ms/step - loss: 0.7982 - val_loss: 0.5986
Epoch 3/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.7300 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.7560 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.764110/20 [==============&gt;...............] - ETA: 0s - loss: 0.780713/20 [==================&gt;...........] - ETA: 0s - loss: 0.789016/20 [=======================&gt;......] - ETA: 0s - loss: 0.789119/20 [===========================&gt;..] - ETA: 0s - loss: 0.791320/20 [==============================] - 0s 22ms/step - loss: 0.7858 - val_loss: 0.6245
Epoch 4/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.8170 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.8131 8/20 [===========&gt;..................] - ETA: 0s - loss: 0.774211/20 [===============&gt;..............] - ETA: 0s - loss: 0.779315/20 [=====================&gt;........] - ETA: 0s - loss: 0.806318/20 [==========================&gt;...] - ETA: 0s - loss: 0.793620/20 [==============================] - 0s 22ms/step - loss: 0.7835 - val_loss: 0.5999
Epoch 5/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6225 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.7168 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.723010/20 [==============&gt;...............] - ETA: 0s - loss: 0.757113/20 [==================&gt;...........] - ETA: 0s - loss: 0.761616/20 [=======================&gt;......] - ETA: 0s - loss: 0.761119/20 [===========================&gt;..] - ETA: 0s - loss: 0.768020/20 [==============================] - 0s 22ms/step - loss: 0.7718 - val_loss: 0.5898
Epoch 6/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6436 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.7949 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.757310/20 [==============&gt;...............] - ETA: 0s - loss: 0.764213/20 [==================&gt;...........] - ETA: 0s - loss: 0.761517/20 [========================&gt;.....] - ETA: 0s - loss: 0.758820/20 [==============================] - ETA: 0s - loss: 0.761820/20 [==============================] - 0s 22ms/step - loss: 0.7618 - val_loss: 0.5841
Epoch 7/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5995 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.7167 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.721210/20 [==============&gt;...............] - ETA: 0s - loss: 0.734514/20 [====================&gt;.........] - ETA: 0s - loss: 0.757017/20 [========================&gt;.....] - ETA: 0s - loss: 0.760720/20 [==============================] - ETA: 0s - loss: 0.757320/20 [==============================] - 0s 22ms/step - loss: 0.7573 - val_loss: 0.5688
Epoch 8/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.9072 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.7195 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.732810/20 [==============&gt;...............] - ETA: 0s - loss: 0.727313/20 [==================&gt;...........] - ETA: 0s - loss: 0.753516/20 [=======================&gt;......] - ETA: 0s - loss: 0.731319/20 [===========================&gt;..] - ETA: 0s - loss: 0.747720/20 [==============================] - 0s 22ms/step - loss: 0.7508 - val_loss: 0.5813
Epoch 9/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.8373 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.7428 8/20 [===========&gt;..................] - ETA: 0s - loss: 0.785511/20 [===============&gt;..............] - ETA: 0s - loss: 0.785714/20 [====================&gt;.........] - ETA: 0s - loss: 0.759617/20 [========================&gt;.....] - ETA: 0s - loss: 0.760820/20 [==============================] - ETA: 0s - loss: 0.747920/20 [==============================] - 0s 22ms/step - loss: 0.7479 - val_loss: 0.6075
Epoch 10/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.7265 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.7844 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.773010/20 [==============&gt;...............] - ETA: 0s - loss: 0.745213/20 [==================&gt;...........] - ETA: 0s - loss: 0.713016/20 [=======================&gt;......] - ETA: 0s - loss: 0.711819/20 [===========================&gt;..] - ETA: 0s - loss: 0.731520/20 [==============================] - 0s 22ms/step - loss: 0.7373 - val_loss: 0.6108
Epoch 11/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.9268 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.7867 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.742310/20 [==============&gt;...............] - ETA: 0s - loss: 0.737613/20 [==================&gt;...........] - ETA: 0s - loss: 0.746416/20 [=======================&gt;......] - ETA: 0s - loss: 0.736719/20 [===========================&gt;..] - ETA: 0s - loss: 0.732320/20 [==============================] - 0s 22ms/step - loss: 0.7287 - val_loss: 0.6254
Epoch 12/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.4937 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.6554 8/20 [===========&gt;..................] - ETA: 0s - loss: 0.679011/20 [===============&gt;..............] - ETA: 0s - loss: 0.670814/20 [====================&gt;.........] - ETA: 0s - loss: 0.706317/20 [========================&gt;.....] - ETA: 0s - loss: 0.710720/20 [==============================] - ETA: 0s - loss: 0.715720/20 [==============================] - 0s 22ms/step - loss: 0.7157 - val_loss: 0.6168
Epoch 13/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5510 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.6913 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.734910/20 [==============&gt;...............] - ETA: 0s - loss: 0.737413/20 [==================&gt;...........] - ETA: 0s - loss: 0.720016/20 [=======================&gt;......] - ETA: 0s - loss: 0.719219/20 [===========================&gt;..] - ETA: 0s - loss: 0.711720/20 [==============================] - 0s 22ms/step - loss: 0.7038 - val_loss: 0.6027
Epoch 14/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6080 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.6960 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.689510/20 [==============&gt;...............] - ETA: 0s - loss: 0.697513/20 [==================&gt;...........] - ETA: 0s - loss: 0.712417/20 [========================&gt;.....] - ETA: 0s - loss: 0.690520/20 [==============================] - ETA: 0s - loss: 0.697220/20 [==============================] - 0s 22ms/step - loss: 0.6972 - val_loss: 0.6741
Epoch 15/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6983 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.7438 8/20 [===========&gt;..................] - ETA: 0s - loss: 0.709811/20 [===============&gt;..............] - ETA: 0s - loss: 0.672414/20 [====================&gt;.........] - ETA: 0s - loss: 0.679017/20 [========================&gt;.....] - ETA: 0s - loss: 0.687120/20 [==============================] - ETA: 0s - loss: 0.684120/20 [==============================] - 0s 22ms/step - loss: 0.6841 - val_loss: 0.6634
Epoch 16/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.7689 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.5897 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.629310/20 [==============&gt;...............] - ETA: 0s - loss: 0.662613/20 [==================&gt;...........] - ETA: 0s - loss: 0.686316/20 [=======================&gt;......] - ETA: 0s - loss: 0.661719/20 [===========================&gt;..] - ETA: 0s - loss: 0.670920/20 [==============================] - 0s 22ms/step - loss: 0.6708 - val_loss: 0.6759
Epoch 17/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6349 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.6453 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.654510/20 [==============&gt;...............] - ETA: 0s - loss: 0.678913/20 [==================&gt;...........] - ETA: 0s - loss: 0.682216/20 [=======================&gt;......] - ETA: 0s - loss: 0.678919/20 [===========================&gt;..] - ETA: 0s - loss: 0.655620/20 [==============================] - 0s 22ms/step - loss: 0.6622 - val_loss: 0.5985
Epoch 18/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5438 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.6340 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.640910/20 [==============&gt;...............] - ETA: 0s - loss: 0.677914/20 [====================&gt;.........] - ETA: 0s - loss: 0.667318/20 [==========================&gt;...] - ETA: 0s - loss: 0.651720/20 [==============================] - 0s 22ms/step - loss: 0.6498 - val_loss: 0.6049
Epoch 19/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6757 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.5927 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.579510/20 [==============&gt;...............] - ETA: 0s - loss: 0.618313/20 [==================&gt;...........] - ETA: 0s - loss: 0.620916/20 [=======================&gt;......] - ETA: 0s - loss: 0.622619/20 [===========================&gt;..] - ETA: 0s - loss: 0.641720/20 [==============================] - 0s 22ms/step - loss: 0.6504 - val_loss: 0.7235
Epoch 20/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5639 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.6547 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.648110/20 [==============&gt;...............] - ETA: 0s - loss: 0.636513/20 [==================&gt;...........] - ETA: 0s - loss: 0.617117/20 [========================&gt;.....] - ETA: 0s - loss: 0.658820/20 [==============================] - ETA: 0s - loss: 0.645520/20 [==============================] - 0s 22ms/step - loss: 0.6455 - val_loss: 0.6300
Epoch 21/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5236 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.6118 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.617210/20 [==============&gt;...............] - ETA: 0s - loss: 0.651113/20 [==================&gt;...........] - ETA: 0s - loss: 0.655616/20 [=======================&gt;......] - ETA: 0s - loss: 0.651719/20 [===========================&gt;..] - ETA: 0s - loss: 0.659520/20 [==============================] - 0s 22ms/step - loss: 0.6571 - val_loss: 0.5587
Epoch 22/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.4151 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.6440 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.647210/20 [==============&gt;...............] - ETA: 0s - loss: 0.641613/20 [==================&gt;...........] - ETA: 0s - loss: 0.647516/20 [=======================&gt;......] - ETA: 0s - loss: 0.661219/20 [===========================&gt;..] - ETA: 0s - loss: 0.645020/20 [==============================] - 0s 22ms/step - loss: 0.6493 - val_loss: 0.5626
Epoch 23/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5827 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.5958 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.591910/20 [==============&gt;...............] - ETA: 0s - loss: 0.636113/20 [==================&gt;...........] - ETA: 0s - loss: 0.667716/20 [=======================&gt;......] - ETA: 0s - loss: 0.651519/20 [===========================&gt;..] - ETA: 0s - loss: 0.637520/20 [==============================] - 0s 22ms/step - loss: 0.6412 - val_loss: 0.6199
Epoch 24/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.7506 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.6312 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.635510/20 [==============&gt;...............] - ETA: 0s - loss: 0.629213/20 [==================&gt;...........] - ETA: 0s - loss: 0.631616/20 [=======================&gt;......] - ETA: 0s - loss: 0.634719/20 [===========================&gt;..] - ETA: 0s - loss: 0.634020/20 [==============================] - 0s 22ms/step - loss: 0.6379 - val_loss: 0.5643
Epoch 25/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.9057 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.6758 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.636810/20 [==============&gt;...............] - ETA: 0s - loss: 0.646613/20 [==================&gt;...........] - ETA: 0s - loss: 0.629916/20 [=======================&gt;......] - ETA: 0s - loss: 0.643919/20 [===========================&gt;..] - ETA: 0s - loss: 0.634120/20 [==============================] - 0s 22ms/step - loss: 0.6366 - val_loss: 0.5817
Epoch 26/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 1.1552 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.7422 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.723710/20 [==============&gt;...............] - ETA: 0s - loss: 0.671313/20 [==================&gt;...........] - ETA: 0s - loss: 0.631216/20 [=======================&gt;......] - ETA: 0s - loss: 0.645819/20 [===========================&gt;..] - ETA: 0s - loss: 0.631120/20 [==============================] - 0s 22ms/step - loss: 0.6305 - val_loss: 0.5578
Epoch 27/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.7078 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.6568 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.589710/20 [==============&gt;...............] - ETA: 0s - loss: 0.648813/20 [==================&gt;...........] - ETA: 0s - loss: 0.651316/20 [=======================&gt;......] - ETA: 0s - loss: 0.633619/20 [===========================&gt;..] - ETA: 0s - loss: 0.625420/20 [==============================] - 0s 22ms/step - loss: 0.6287 - val_loss: 0.6068
Epoch 28/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5902 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.6944 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.706710/20 [==============&gt;...............] - ETA: 0s - loss: 0.662713/20 [==================&gt;...........] - ETA: 0s - loss: 0.653916/20 [=======================&gt;......] - ETA: 0s - loss: 0.644719/20 [===========================&gt;..] - ETA: 0s - loss: 0.651420/20 [==============================] - 0s 22ms/step - loss: 0.6514 - val_loss: 0.5550
Epoch 29/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5901 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.6209 8/20 [===========&gt;..................] - ETA: 0s - loss: 0.610811/20 [===============&gt;..............] - ETA: 0s - loss: 0.619714/20 [====================&gt;.........] - ETA: 0s - loss: 0.629217/20 [========================&gt;.....] - ETA: 0s - loss: 0.640920/20 [==============================] - ETA: 0s - loss: 0.635420/20 [==============================] - 0s 22ms/step - loss: 0.6354 - val_loss: 0.6150
Epoch 30/30
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6707 4/20 [=====&gt;........................] - ETA: 0s - loss: 0.7378 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.675311/20 [===============&gt;..............] - ETA: 0s - loss: 0.642214/20 [====================&gt;.........] - ETA: 0s - loss: 0.643017/20 [========================&gt;.....] - ETA: 0s - loss: 0.640920/20 [==============================] - ETA: 0s - loss: 0.633820/20 [==============================] - 0s 22ms/step - loss: 0.6338 - val_loss: 0.6119</code></pre>
</div>
</div>
<p>Lets look at the diagnostic plot</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>history_plot(history_spy_1_reg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Deep Learning for TS_files/figure-html/cell-13-output-1.png" width="597" height="449"></p>
</div>
</div>
<p>Compared to the model without regularization, we can see that the training set error decreases more steadily, without regressing higher very often. The consequence of this is that the raining error goes lower than the validation error faster than without regularization, suggesting regularization is helping the model to learn more purposefully and successfully.</p>
<h2 class="anchored">
Fit RNN
</h2>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a sequential model once again</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Sequential()</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>model.add(layers.Dense(<span class="dv">32</span>, activation<span class="op">=</span><span class="st">'relu'</span>,input_shape<span class="op">=</span>rnn_input_shape))</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co"># This layer is the recurent layer, which returns all previous data</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>model.add(layers.SimpleRNN(<span class="dv">32</span>, dropout<span class="op">=</span><span class="fl">0.1</span>, recurrent_dropout<span class="op">=</span><span class="fl">0.5</span>, return_sequences<span class="op">=</span><span class="va">True</span>))</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co"># layer that reads the recurent layer</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>model.add(layers.Dense(<span class="dv">1</span>))</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span>RMSprop(), loss<span class="op">=</span><span class="st">'mae'</span>)</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>history_spy_2_noreg <span class="op">=</span> model.fit(x <span class="op">=</span> spy_x, y <span class="op">=</span> spy_y, steps_per_epoch<span class="op">=</span><span class="dv">20</span>, epochs<span class="op">=</span><span class="dv">40</span>, validation_data<span class="op">=</span> (spy_val_x, spy_val_y), validation_steps<span class="op">=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 1/40
 1/20 [&gt;.............................] - ETA: 17s - loss: 0.980513/20 [==================&gt;...........] - ETA: 0s - loss: 0.9145 20/20 [==============================] - 1s 16ms/step - loss: 0.8941 - val_loss: 0.6273
Epoch 2/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.947613/20 [==================&gt;...........] - ETA: 0s - loss: 0.860020/20 [==============================] - 0s 6ms/step - loss: 0.8149 - val_loss: 0.6121
Epoch 3/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.724013/20 [==================&gt;...........] - ETA: 0s - loss: 0.787420/20 [==============================] - 0s 6ms/step - loss: 0.7677 - val_loss: 0.5948
Epoch 4/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.799913/20 [==================&gt;...........] - ETA: 0s - loss: 0.754020/20 [==============================] - 0s 6ms/step - loss: 0.7365 - val_loss: 0.5812
Epoch 5/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.783513/20 [==================&gt;...........] - ETA: 0s - loss: 0.697720/20 [==============================] - 0s 6ms/step - loss: 0.7241 - val_loss: 0.5866
Epoch 6/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.769113/20 [==================&gt;...........] - ETA: 0s - loss: 0.722520/20 [==============================] - 0s 6ms/step - loss: 0.7088 - val_loss: 0.5838
Epoch 7/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 1.031013/20 [==================&gt;...........] - ETA: 0s - loss: 0.752120/20 [==============================] - 0s 6ms/step - loss: 0.7063 - val_loss: 0.5829
Epoch 8/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.783012/20 [=================&gt;............] - ETA: 0s - loss: 0.703720/20 [==============================] - 0s 6ms/step - loss: 0.7055 - val_loss: 0.5911
Epoch 9/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.735812/20 [=================&gt;............] - ETA: 0s - loss: 0.704620/20 [==============================] - 0s 7ms/step - loss: 0.7045 - val_loss: 0.5864
Epoch 10/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.548012/20 [=================&gt;............] - ETA: 0s - loss: 0.692720/20 [==============================] - 0s 6ms/step - loss: 0.7021 - val_loss: 0.5922
Epoch 11/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.783912/20 [=================&gt;............] - ETA: 0s - loss: 0.681820/20 [==============================] - 0s 6ms/step - loss: 0.6974 - val_loss: 0.6009
Epoch 12/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.626412/20 [=================&gt;............] - ETA: 0s - loss: 0.736020/20 [==============================] - 0s 7ms/step - loss: 0.6965 - val_loss: 0.5838
Epoch 13/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.609212/20 [=================&gt;............] - ETA: 0s - loss: 0.701320/20 [==============================] - 0s 6ms/step - loss: 0.6915 - val_loss: 0.5832
Epoch 14/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.685112/20 [=================&gt;............] - ETA: 0s - loss: 0.731320/20 [==============================] - 0s 6ms/step - loss: 0.6901 - val_loss: 0.5558
Epoch 15/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.747311/20 [===============&gt;..............] - ETA: 0s - loss: 0.704520/20 [==============================] - 0s 7ms/step - loss: 0.6875 - val_loss: 0.5449
Epoch 16/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.657612/20 [=================&gt;............] - ETA: 0s - loss: 0.685420/20 [==============================] - 0s 6ms/step - loss: 0.6769 - val_loss: 0.5454
Epoch 17/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.590412/20 [=================&gt;............] - ETA: 0s - loss: 0.645320/20 [==============================] - 0s 6ms/step - loss: 0.6727 - val_loss: 0.5567
Epoch 18/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.516811/20 [===============&gt;..............] - ETA: 0s - loss: 0.699920/20 [==============================] - 0s 7ms/step - loss: 0.6616 - val_loss: 0.5603
Epoch 19/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.589613/20 [==================&gt;...........] - ETA: 0s - loss: 0.644420/20 [==============================] - 0s 6ms/step - loss: 0.6501 - val_loss: 0.5564
Epoch 20/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.612911/20 [===============&gt;..............] - ETA: 0s - loss: 0.631720/20 [==============================] - 0s 7ms/step - loss: 0.6489 - val_loss: 0.5726
Epoch 21/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.551211/20 [===============&gt;..............] - ETA: 0s - loss: 0.600920/20 [==============================] - 0s 7ms/step - loss: 0.6316 - val_loss: 0.5695
Epoch 22/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.639812/20 [=================&gt;............] - ETA: 0s - loss: 0.628320/20 [==============================] - 0s 6ms/step - loss: 0.6277 - val_loss: 0.5707
Epoch 23/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.524112/20 [=================&gt;............] - ETA: 0s - loss: 0.632320/20 [==============================] - 0s 6ms/step - loss: 0.6273 - val_loss: 0.5547
Epoch 24/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.768212/20 [=================&gt;............] - ETA: 0s - loss: 0.619820/20 [==============================] - 0s 6ms/step - loss: 0.6305 - val_loss: 0.5571
Epoch 25/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.626013/20 [==================&gt;...........] - ETA: 0s - loss: 0.632820/20 [==============================] - 0s 6ms/step - loss: 0.6365 - val_loss: 0.5637
Epoch 26/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.799511/20 [===============&gt;..............] - ETA: 0s - loss: 0.611020/20 [==============================] - 0s 7ms/step - loss: 0.6181 - val_loss: 0.5557
Epoch 27/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.679012/20 [=================&gt;............] - ETA: 0s - loss: 0.656420/20 [==============================] - 0s 6ms/step - loss: 0.6179 - val_loss: 0.5266
Epoch 28/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.517012/20 [=================&gt;............] - ETA: 0s - loss: 0.639820/20 [==============================] - 0s 6ms/step - loss: 0.6131 - val_loss: 0.5557
Epoch 29/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.591613/20 [==================&gt;...........] - ETA: 0s - loss: 0.619120/20 [==============================] - 0s 6ms/step - loss: 0.6217 - val_loss: 0.5467
Epoch 30/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.692013/20 [==================&gt;...........] - ETA: 0s - loss: 0.597120/20 [==============================] - 0s 6ms/step - loss: 0.6220 - val_loss: 0.5285
Epoch 31/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.659211/20 [===============&gt;..............] - ETA: 0s - loss: 0.640620/20 [==============================] - 0s 7ms/step - loss: 0.6104 - val_loss: 0.5565
Epoch 32/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.638512/20 [=================&gt;............] - ETA: 0s - loss: 0.614220/20 [==============================] - 0s 6ms/step - loss: 0.6197 - val_loss: 0.5680
Epoch 33/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.503513/20 [==================&gt;...........] - ETA: 0s - loss: 0.626620/20 [==============================] - 0s 6ms/step - loss: 0.6132 - val_loss: 0.5530
Epoch 34/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.603212/20 [=================&gt;............] - ETA: 0s - loss: 0.612520/20 [==============================] - 0s 6ms/step - loss: 0.6126 - val_loss: 0.5399
Epoch 35/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.575813/20 [==================&gt;...........] - ETA: 0s - loss: 0.565620/20 [==============================] - 0s 6ms/step - loss: 0.6128 - val_loss: 0.5631
Epoch 36/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.543013/20 [==================&gt;...........] - ETA: 0s - loss: 0.584420/20 [==============================] - 0s 6ms/step - loss: 0.6102 - val_loss: 0.6285
Epoch 37/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.642612/20 [=================&gt;............] - ETA: 0s - loss: 0.608220/20 [==============================] - 0s 6ms/step - loss: 0.6102 - val_loss: 0.5442
Epoch 38/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.468712/20 [=================&gt;............] - ETA: 0s - loss: 0.600020/20 [==============================] - 0s 7ms/step - loss: 0.6141 - val_loss: 0.5721
Epoch 39/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.423313/20 [==================&gt;...........] - ETA: 0s - loss: 0.610920/20 [==============================] - 0s 6ms/step - loss: 0.6055 - val_loss: 0.5441
Epoch 40/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.507513/20 [==================&gt;...........] - ETA: 0s - loss: 0.615920/20 [==============================] - 0s 6ms/step - loss: 0.6228 - val_loss: 0.5822</code></pre>
</div>
</div>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>history_plot(history_spy_2_noreg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Deep Learning for TS_files/figure-html/cell-15-output-1.png" width="597" height="449"></p>
</div>
</div>
<p>We can see the validation loss of the simple RNN model is actually almost equivalent to both the regularized and non-regularized GRU models above. Specifically, all 3 models tended to initialize around 0.6 loss for the validation set, and then slowly work down to about 0.55. If anything, the RNN model might perform slightly better, with validation loss decreasing below 0.55 at the later-stage epochs.</p>
<h2 class="anchored">
Fit LSTM
</h2>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a sequential model once again</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Sequential()</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>model.add(layers.Dense(<span class="dv">32</span>, activation<span class="op">=</span><span class="st">'relu'</span>,input_shape<span class="op">=</span>rnn_input_shape))</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co"># This layer is the recurent layer, which returns all previous data</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>model.add(layers.LSTM(<span class="dv">32</span>, dropout<span class="op">=</span><span class="fl">0.1</span>, recurrent_dropout<span class="op">=</span><span class="fl">0.5</span>, return_sequences<span class="op">=</span><span class="va">True</span>))</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="co"># layer that reads the recurent layer</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>model.add(layers.Dense(<span class="dv">1</span>))</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span>RMSprop(), loss<span class="op">=</span><span class="st">'mae'</span>)</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>history_spy_3_noreg <span class="op">=</span> model.fit(x <span class="op">=</span> spy_x, y <span class="op">=</span> spy_y, steps_per_epoch<span class="op">=</span><span class="dv">20</span>, epochs<span class="op">=</span><span class="dv">40</span>, validation_data<span class="op">=</span> (spy_val_x, spy_val_y), validation_steps<span class="op">=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 1/40
 1/20 [&gt;.............................] - ETA: 37s - loss: 0.7533 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.7582 13/20 [==================&gt;...........] - ETA: 0s - loss: 0.733218/20 [==========================&gt;...] - ETA: 0s - loss: 0.711720/20 [==============================] - 2s 25ms/step - loss: 0.7021 - val_loss: 0.5392
Epoch 2/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.7246 6/20 [========&gt;.....................] - ETA: 0s - loss: 0.692511/20 [===============&gt;..............] - ETA: 0s - loss: 0.674516/20 [=======================&gt;......] - ETA: 0s - loss: 0.660820/20 [==============================] - 0s 13ms/step - loss: 0.6511 - val_loss: 0.5433
Epoch 3/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.8251 6/20 [========&gt;.....................] - ETA: 0s - loss: 0.727812/20 [=================&gt;............] - ETA: 0s - loss: 0.651617/20 [========================&gt;.....] - ETA: 0s - loss: 0.648520/20 [==============================] - 0s 13ms/step - loss: 0.6364 - val_loss: 0.5237
Epoch 4/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6373 6/20 [========&gt;.....................] - ETA: 0s - loss: 0.637212/20 [=================&gt;............] - ETA: 0s - loss: 0.632217/20 [========================&gt;.....] - ETA: 0s - loss: 0.629320/20 [==============================] - 0s 13ms/step - loss: 0.6306 - val_loss: 0.5464
Epoch 5/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6221 6/20 [========&gt;.....................] - ETA: 0s - loss: 0.690712/20 [=================&gt;............] - ETA: 0s - loss: 0.621517/20 [========================&gt;.....] - ETA: 0s - loss: 0.629820/20 [==============================] - 0s 13ms/step - loss: 0.6246 - val_loss: 0.5445
Epoch 6/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.4093 6/20 [========&gt;.....................] - ETA: 0s - loss: 0.628111/20 [===============&gt;..............] - ETA: 0s - loss: 0.588416/20 [=======================&gt;......] - ETA: 0s - loss: 0.618020/20 [==============================] - 0s 13ms/step - loss: 0.6199 - val_loss: 0.5457
Epoch 7/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.4723 6/20 [========&gt;.....................] - ETA: 0s - loss: 0.623511/20 [===============&gt;..............] - ETA: 0s - loss: 0.640816/20 [=======================&gt;......] - ETA: 0s - loss: 0.633520/20 [==============================] - 0s 13ms/step - loss: 0.6240 - val_loss: 0.5473
Epoch 8/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6832 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.652912/20 [=================&gt;............] - ETA: 0s - loss: 0.634218/20 [==========================&gt;...] - ETA: 0s - loss: 0.621620/20 [==============================] - 0s 13ms/step - loss: 0.6182 - val_loss: 0.5642
Epoch 9/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.4843 6/20 [========&gt;.....................] - ETA: 0s - loss: 0.554411/20 [===============&gt;..............] - ETA: 0s - loss: 0.581016/20 [=======================&gt;......] - ETA: 0s - loss: 0.607520/20 [==============================] - 0s 13ms/step - loss: 0.6136 - val_loss: 0.5533
Epoch 10/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6870 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.631913/20 [==================&gt;...........] - ETA: 0s - loss: 0.640518/20 [==========================&gt;...] - ETA: 0s - loss: 0.629320/20 [==============================] - 0s 13ms/step - loss: 0.6118 - val_loss: 0.5378
Epoch 11/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.4967 6/20 [========&gt;.....................] - ETA: 0s - loss: 0.583911/20 [===============&gt;..............] - ETA: 0s - loss: 0.623316/20 [=======================&gt;......] - ETA: 0s - loss: 0.627320/20 [==============================] - 0s 13ms/step - loss: 0.6125 - val_loss: 0.5441
Epoch 12/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.7766 6/20 [========&gt;.....................] - ETA: 0s - loss: 0.630011/20 [===============&gt;..............] - ETA: 0s - loss: 0.629316/20 [=======================&gt;......] - ETA: 0s - loss: 0.622620/20 [==============================] - 0s 13ms/step - loss: 0.6083 - val_loss: 0.5445
Epoch 13/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5543 6/20 [========&gt;.....................] - ETA: 0s - loss: 0.643011/20 [===============&gt;..............] - ETA: 0s - loss: 0.619017/20 [========================&gt;.....] - ETA: 0s - loss: 0.618320/20 [==============================] - 0s 13ms/step - loss: 0.6063 - val_loss: 0.5595
Epoch 14/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5528 6/20 [========&gt;.....................] - ETA: 0s - loss: 0.572111/20 [===============&gt;..............] - ETA: 0s - loss: 0.607016/20 [=======================&gt;......] - ETA: 0s - loss: 0.592120/20 [==============================] - 0s 13ms/step - loss: 0.6043 - val_loss: 0.5707
Epoch 15/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5802 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.614013/20 [==================&gt;...........] - ETA: 0s - loss: 0.617419/20 [===========================&gt;..] - ETA: 0s - loss: 0.617520/20 [==============================] - 0s 13ms/step - loss: 0.6087 - val_loss: 0.5441
Epoch 16/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.7189 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.651812/20 [=================&gt;............] - ETA: 0s - loss: 0.612417/20 [========================&gt;.....] - ETA: 0s - loss: 0.607520/20 [==============================] - 0s 13ms/step - loss: 0.6100 - val_loss: 0.5367
Epoch 17/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.4113 6/20 [========&gt;.....................] - ETA: 0s - loss: 0.690811/20 [===============&gt;..............] - ETA: 0s - loss: 0.658817/20 [========================&gt;.....] - ETA: 0s - loss: 0.604120/20 [==============================] - 0s 13ms/step - loss: 0.6076 - val_loss: 0.5566
Epoch 18/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.4443 6/20 [========&gt;.....................] - ETA: 0s - loss: 0.581311/20 [===============&gt;..............] - ETA: 0s - loss: 0.638116/20 [=======================&gt;......] - ETA: 0s - loss: 0.611820/20 [==============================] - 0s 13ms/step - loss: 0.6029 - val_loss: 0.5786
Epoch 19/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5350 6/20 [========&gt;.....................] - ETA: 0s - loss: 0.612912/20 [=================&gt;............] - ETA: 0s - loss: 0.591417/20 [========================&gt;.....] - ETA: 0s - loss: 0.585720/20 [==============================] - 0s 13ms/step - loss: 0.6043 - val_loss: 0.5706
Epoch 20/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6084 6/20 [========&gt;.....................] - ETA: 0s - loss: 0.649211/20 [===============&gt;..............] - ETA: 0s - loss: 0.593816/20 [=======================&gt;......] - ETA: 0s - loss: 0.588720/20 [==============================] - 0s 13ms/step - loss: 0.6006 - val_loss: 0.5497
Epoch 21/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5254 6/20 [========&gt;.....................] - ETA: 0s - loss: 0.590711/20 [===============&gt;..............] - ETA: 0s - loss: 0.591616/20 [=======================&gt;......] - ETA: 0s - loss: 0.594920/20 [==============================] - 0s 13ms/step - loss: 0.5975 - val_loss: 0.5675
Epoch 22/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.7036 6/20 [========&gt;.....................] - ETA: 0s - loss: 0.623311/20 [===============&gt;..............] - ETA: 0s - loss: 0.615016/20 [=======================&gt;......] - ETA: 0s - loss: 0.616120/20 [==============================] - 0s 14ms/step - loss: 0.6010 - val_loss: 0.5542
Epoch 23/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5016 6/20 [========&gt;.....................] - ETA: 0s - loss: 0.632212/20 [=================&gt;............] - ETA: 0s - loss: 0.596617/20 [========================&gt;.....] - ETA: 0s - loss: 0.591220/20 [==============================] - 0s 13ms/step - loss: 0.5995 - val_loss: 0.5607
Epoch 24/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5676 6/20 [========&gt;.....................] - ETA: 0s - loss: 0.679511/20 [===============&gt;..............] - ETA: 0s - loss: 0.614816/20 [=======================&gt;......] - ETA: 0s - loss: 0.582520/20 [==============================] - 0s 13ms/step - loss: 0.6027 - val_loss: 0.5613
Epoch 25/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.4341 6/20 [========&gt;.....................] - ETA: 0s - loss: 0.648911/20 [===============&gt;..............] - ETA: 0s - loss: 0.639917/20 [========================&gt;.....] - ETA: 0s - loss: 0.610520/20 [==============================] - 0s 13ms/step - loss: 0.5972 - val_loss: 0.5286
Epoch 26/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6375 6/20 [========&gt;.....................] - ETA: 0s - loss: 0.651611/20 [===============&gt;..............] - ETA: 0s - loss: 0.581017/20 [========================&gt;.....] - ETA: 0s - loss: 0.590120/20 [==============================] - 0s 13ms/step - loss: 0.5990 - val_loss: 0.5281
Epoch 27/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5665 6/20 [========&gt;.....................] - ETA: 0s - loss: 0.603711/20 [===============&gt;..............] - ETA: 0s - loss: 0.619717/20 [========================&gt;.....] - ETA: 0s - loss: 0.609420/20 [==============================] - 0s 13ms/step - loss: 0.5934 - val_loss: 0.5418
Epoch 28/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.4148 6/20 [========&gt;.....................] - ETA: 0s - loss: 0.602411/20 [===============&gt;..............] - ETA: 0s - loss: 0.619616/20 [=======================&gt;......] - ETA: 0s - loss: 0.605720/20 [==============================] - 0s 13ms/step - loss: 0.5996 - val_loss: 0.5512
Epoch 29/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.7770 6/20 [========&gt;.....................] - ETA: 0s - loss: 0.668912/20 [=================&gt;............] - ETA: 0s - loss: 0.631517/20 [========================&gt;.....] - ETA: 0s - loss: 0.604820/20 [==============================] - 0s 13ms/step - loss: 0.5965 - val_loss: 0.5361
Epoch 30/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.4432 6/20 [========&gt;.....................] - ETA: 0s - loss: 0.526011/20 [===============&gt;..............] - ETA: 0s - loss: 0.563516/20 [=======================&gt;......] - ETA: 0s - loss: 0.594720/20 [==============================] - 0s 13ms/step - loss: 0.5912 - val_loss: 0.5643
Epoch 31/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5466 6/20 [========&gt;.....................] - ETA: 0s - loss: 0.576112/20 [=================&gt;............] - ETA: 0s - loss: 0.594617/20 [========================&gt;.....] - ETA: 0s - loss: 0.588520/20 [==============================] - 0s 13ms/step - loss: 0.5948 - val_loss: 0.5821
Epoch 32/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.4851 6/20 [========&gt;.....................] - ETA: 0s - loss: 0.582211/20 [===============&gt;..............] - ETA: 0s - loss: 0.621717/20 [========================&gt;.....] - ETA: 0s - loss: 0.621020/20 [==============================] - 0s 13ms/step - loss: 0.5995 - val_loss: 0.5879
Epoch 33/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.3918 6/20 [========&gt;.....................] - ETA: 0s - loss: 0.536411/20 [===============&gt;..............] - ETA: 0s - loss: 0.557317/20 [========================&gt;.....] - ETA: 0s - loss: 0.587320/20 [==============================] - 0s 13ms/step - loss: 0.5978 - val_loss: 0.5231
Epoch 34/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5711 6/20 [========&gt;.....................] - ETA: 0s - loss: 0.600411/20 [===============&gt;..............] - ETA: 0s - loss: 0.595517/20 [========================&gt;.....] - ETA: 0s - loss: 0.585720/20 [==============================] - 0s 13ms/step - loss: 0.5900 - val_loss: 0.5953
Epoch 35/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6168 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.607012/20 [=================&gt;............] - ETA: 0s - loss: 0.585317/20 [========================&gt;.....] - ETA: 0s - loss: 0.588520/20 [==============================] - 0s 13ms/step - loss: 0.5981 - val_loss: 0.5631
Epoch 36/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.4645 6/20 [========&gt;.....................] - ETA: 0s - loss: 0.532511/20 [===============&gt;..............] - ETA: 0s - loss: 0.551816/20 [=======================&gt;......] - ETA: 0s - loss: 0.584620/20 [==============================] - 0s 13ms/step - loss: 0.5971 - val_loss: 0.5249
Epoch 37/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5046 6/20 [========&gt;.....................] - ETA: 0s - loss: 0.561411/20 [===============&gt;..............] - ETA: 0s - loss: 0.608216/20 [=======================&gt;......] - ETA: 0s - loss: 0.606020/20 [==============================] - 0s 13ms/step - loss: 0.5899 - val_loss: 0.5321
Epoch 38/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5348 6/20 [========&gt;.....................] - ETA: 0s - loss: 0.600511/20 [===============&gt;..............] - ETA: 0s - loss: 0.601917/20 [========================&gt;.....] - ETA: 0s - loss: 0.609120/20 [==============================] - 0s 13ms/step - loss: 0.5964 - val_loss: 0.5777
Epoch 39/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5020 6/20 [========&gt;.....................] - ETA: 0s - loss: 0.637211/20 [===============&gt;..............] - ETA: 0s - loss: 0.627516/20 [=======================&gt;......] - ETA: 0s - loss: 0.582320/20 [==============================] - 0s 13ms/step - loss: 0.5926 - val_loss: 0.5661
Epoch 40/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.4022 6/20 [========&gt;.....................] - ETA: 0s - loss: 0.572612/20 [=================&gt;............] - ETA: 0s - loss: 0.580217/20 [========================&gt;.....] - ETA: 0s - loss: 0.594020/20 [==============================] - 0s 13ms/step - loss: 0.5883 - val_loss: 0.5590</code></pre>
</div>
</div>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>history_plot(history_spy_3_noreg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Deep Learning for TS_files/figure-html/cell-17-output-1.png" width="606" height="449"></p>
</div>
</div>
<p>With one LSTM layer, the model already seems better than the RNN and GRU competitiors. The validation loss starts out around 0.56 and stays in the lower end of the 0.55-0.6 range. Lets try adding another layer:</p>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">#from sklearn.neural_network import MLPRegressor</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co"># create a sequential model once again</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Sequential()</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>model.add(layers.Dense(<span class="dv">32</span>, activation<span class="op">=</span><span class="st">'relu'</span>,input_shape<span class="op">=</span>rnn_input_shape))</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="co"># This layer is the recurent layer, which returns all previous data</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>model.add(layers.LSTM(<span class="dv">64</span>, dropout<span class="op">=</span><span class="fl">0.1</span>, recurrent_dropout<span class="op">=</span><span class="fl">0.5</span>, return_sequences<span class="op">=</span><span class="va">True</span>, recurrent_regularizer<span class="op">=</span> regularizers.L1L2(l1<span class="op">=</span>L1, l2<span class="op">=</span>L2)))</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>model.add(layers.LSTM(<span class="dv">64</span>, dropout<span class="op">=</span><span class="fl">0.1</span>, recurrent_dropout<span class="op">=</span><span class="fl">0.5</span>, return_sequences<span class="op">=</span><span class="va">True</span>, recurrent_regularizer <span class="op">=</span> regularizers.L1L2(l1<span class="op">=</span>L1, l2<span class="op">=</span>L2)))</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>model.add(layers.LSTM(<span class="dv">64</span>, dropout<span class="op">=</span><span class="fl">0.1</span>, recurrent_dropout<span class="op">=</span><span class="fl">0.5</span>, return_sequences<span class="op">=</span><span class="va">True</span>, recurrent_regularizer <span class="op">=</span> regularizers.L1L2(l1<span class="op">=</span>L1, l2<span class="op">=</span>L2)))</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="co"># layer that reads the recurent layer</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>model.add(layers.Dense(<span class="dv">32</span>, activation<span class="op">=</span><span class="st">'relu'</span>,kernel_regularizer<span class="op">=</span>regularizers.L1L2(l1<span class="op">=</span>L1, l2<span class="op">=</span>L2)))</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>model.add(layers.Dense(<span class="dv">1</span>))</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(MLPRegressor())</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span>RMSprop(), loss<span class="op">=</span><span class="st">'mae'</span>)</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a><span class="co">#  trying diff shape</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>history_spy_4_noreg <span class="op">=</span> model.fit(x <span class="op">=</span> spy_x, y <span class="op">=</span> spy_y, steps_per_epoch<span class="op">=</span><span class="dv">20</span>, epochs<span class="op">=</span><span class="dv">40</span>, validation_data<span class="op">=</span> (spy_val_x, spy_val_y), validation_steps<span class="op">=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 1/40
 1/20 [&gt;.............................] - ETA: 1:55 - loss: 1.0360 3/20 [===&gt;..........................] - ETA: 0s - loss: 1.0073   6/20 [========&gt;.....................] - ETA: 0s - loss: 0.9940 8/20 [===========&gt;..................] - ETA: 0s - loss: 0.983310/20 [==============&gt;...............] - ETA: 0s - loss: 0.940912/20 [=================&gt;............] - ETA: 0s - loss: 0.934814/20 [====================&gt;.........] - ETA: 0s - loss: 0.928916/20 [=======================&gt;......] - ETA: 0s - loss: 0.916418/20 [==========================&gt;...] - ETA: 0s - loss: 0.913420/20 [==============================] - ETA: 0s - loss: 0.899520/20 [==============================] - 7s 62ms/step - loss: 0.8995 - val_loss: 0.7613
Epoch 2/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.9288 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.9345 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.8956 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.8700 9/20 [============&gt;.................] - ETA: 0s - loss: 0.870011/20 [===============&gt;..............] - ETA: 0s - loss: 0.884113/20 [==================&gt;...........] - ETA: 0s - loss: 0.857415/20 [=====================&gt;........] - ETA: 0s - loss: 0.851317/20 [========================&gt;.....] - ETA: 0s - loss: 0.843719/20 [===========================&gt;..] - ETA: 0s - loss: 0.829120/20 [==============================] - 1s 34ms/step - loss: 0.8351 - val_loss: 0.7169
Epoch 3/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.9599 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.8101 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.8036 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.8019 9/20 [============&gt;.................] - ETA: 0s - loss: 0.793011/20 [===============&gt;..............] - ETA: 0s - loss: 0.799613/20 [==================&gt;...........] - ETA: 0s - loss: 0.804715/20 [=====================&gt;........] - ETA: 0s - loss: 0.809017/20 [========================&gt;.....] - ETA: 0s - loss: 0.799219/20 [===========================&gt;..] - ETA: 0s - loss: 0.795320/20 [==============================] - 1s 34ms/step - loss: 0.7988 - val_loss: 0.7060
Epoch 4/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.8696 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.7279 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.7467 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.7422 9/20 [============&gt;.................] - ETA: 0s - loss: 0.743711/20 [===============&gt;..............] - ETA: 0s - loss: 0.750513/20 [==================&gt;...........] - ETA: 0s - loss: 0.772415/20 [=====================&gt;........] - ETA: 0s - loss: 0.778817/20 [========================&gt;.....] - ETA: 0s - loss: 0.769119/20 [===========================&gt;..] - ETA: 0s - loss: 0.772620/20 [==============================] - 1s 34ms/step - loss: 0.7792 - val_loss: 0.6893
Epoch 5/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6820 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.7784 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.7439 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.7541 9/20 [============&gt;.................] - ETA: 0s - loss: 0.786211/20 [===============&gt;..............] - ETA: 0s - loss: 0.789213/20 [==================&gt;...........] - ETA: 0s - loss: 0.791116/20 [=======================&gt;......] - ETA: 0s - loss: 0.766518/20 [==========================&gt;...] - ETA: 0s - loss: 0.767220/20 [==============================] - ETA: 0s - loss: 0.757820/20 [==============================] - 1s 34ms/step - loss: 0.7578 - val_loss: 0.6585
Epoch 6/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.8266 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.7137 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.7597 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.7823 9/20 [============&gt;.................] - ETA: 0s - loss: 0.751511/20 [===============&gt;..............] - ETA: 0s - loss: 0.713913/20 [==================&gt;...........] - ETA: 0s - loss: 0.741015/20 [=====================&gt;........] - ETA: 0s - loss: 0.729117/20 [========================&gt;.....] - ETA: 0s - loss: 0.740119/20 [===========================&gt;..] - ETA: 0s - loss: 0.743120/20 [==============================] - 1s 34ms/step - loss: 0.7366 - val_loss: 0.6583
Epoch 7/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6725 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.6694 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.7127 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.7131 9/20 [============&gt;.................] - ETA: 0s - loss: 0.733911/20 [===============&gt;..............] - ETA: 0s - loss: 0.730213/20 [==================&gt;...........] - ETA: 0s - loss: 0.729015/20 [=====================&gt;........] - ETA: 0s - loss: 0.735217/20 [========================&gt;.....] - ETA: 0s - loss: 0.733319/20 [===========================&gt;..] - ETA: 0s - loss: 0.728420/20 [==============================] - 1s 34ms/step - loss: 0.7257 - val_loss: 0.6254
Epoch 8/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.7237 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.6601 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.6898 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.7382 9/20 [============&gt;.................] - ETA: 0s - loss: 0.733211/20 [===============&gt;..............] - ETA: 0s - loss: 0.734213/20 [==================&gt;...........] - ETA: 0s - loss: 0.725215/20 [=====================&gt;........] - ETA: 0s - loss: 0.712717/20 [========================&gt;.....] - ETA: 0s - loss: 0.718719/20 [===========================&gt;..] - ETA: 0s - loss: 0.704620/20 [==============================] - 1s 35ms/step - loss: 0.7093 - val_loss: 0.6645
Epoch 9/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6870 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.7369 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.6730 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.6495 9/20 [============&gt;.................] - ETA: 0s - loss: 0.690211/20 [===============&gt;..............] - ETA: 0s - loss: 0.709713/20 [==================&gt;...........] - ETA: 0s - loss: 0.720715/20 [=====================&gt;........] - ETA: 0s - loss: 0.710317/20 [========================&gt;.....] - ETA: 0s - loss: 0.691819/20 [===========================&gt;..] - ETA: 0s - loss: 0.695520/20 [==============================] - 1s 34ms/step - loss: 0.7034 - val_loss: 0.6281
Epoch 10/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.7529 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.6939 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.6729 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.6647 9/20 [============&gt;.................] - ETA: 0s - loss: 0.654911/20 [===============&gt;..............] - ETA: 0s - loss: 0.664713/20 [==================&gt;...........] - ETA: 0s - loss: 0.664115/20 [=====================&gt;........] - ETA: 0s - loss: 0.681318/20 [==========================&gt;...] - ETA: 0s - loss: 0.689420/20 [==============================] - ETA: 0s - loss: 0.685520/20 [==============================] - 1s 34ms/step - loss: 0.6855 - val_loss: 0.5918
Epoch 11/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6177 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.6948 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.7352 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.7150 9/20 [============&gt;.................] - ETA: 0s - loss: 0.721811/20 [===============&gt;..............] - ETA: 0s - loss: 0.694913/20 [==================&gt;...........] - ETA: 0s - loss: 0.691515/20 [=====================&gt;........] - ETA: 0s - loss: 0.696417/20 [========================&gt;.....] - ETA: 0s - loss: 0.695120/20 [==============================] - ETA: 0s - loss: 0.687320/20 [==============================] - 1s 34ms/step - loss: 0.6873 - val_loss: 0.5888
Epoch 12/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.7348 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.6637 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.6619 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.6651 9/20 [============&gt;.................] - ETA: 0s - loss: 0.655311/20 [===============&gt;..............] - ETA: 0s - loss: 0.658213/20 [==================&gt;...........] - ETA: 0s - loss: 0.666915/20 [=====================&gt;........] - ETA: 0s - loss: 0.678517/20 [========================&gt;.....] - ETA: 0s - loss: 0.677419/20 [===========================&gt;..] - ETA: 0s - loss: 0.669520/20 [==============================] - 1s 34ms/step - loss: 0.6707 - val_loss: 0.6063
Epoch 13/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6847 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.8110 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.7908 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.7480 9/20 [============&gt;.................] - ETA: 0s - loss: 0.700311/20 [===============&gt;..............] - ETA: 0s - loss: 0.723513/20 [==================&gt;...........] - ETA: 0s - loss: 0.705115/20 [=====================&gt;........] - ETA: 0s - loss: 0.693017/20 [========================&gt;.....] - ETA: 0s - loss: 0.680419/20 [===========================&gt;..] - ETA: 0s - loss: 0.663320/20 [==============================] - 1s 35ms/step - loss: 0.6629 - val_loss: 0.6013
Epoch 14/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.8145 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.7199 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.7367 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.6764 9/20 [============&gt;.................] - ETA: 0s - loss: 0.691911/20 [===============&gt;..............] - ETA: 0s - loss: 0.709313/20 [==================&gt;...........] - ETA: 0s - loss: 0.692515/20 [=====================&gt;........] - ETA: 0s - loss: 0.686117/20 [========================&gt;.....] - ETA: 0s - loss: 0.688919/20 [===========================&gt;..] - ETA: 0s - loss: 0.668920/20 [==============================] - 1s 34ms/step - loss: 0.6583 - val_loss: 0.5748
Epoch 15/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.7450 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.6257 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.6618 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.6396 9/20 [============&gt;.................] - ETA: 0s - loss: 0.630211/20 [===============&gt;..............] - ETA: 0s - loss: 0.631213/20 [==================&gt;...........] - ETA: 0s - loss: 0.649615/20 [=====================&gt;........] - ETA: 0s - loss: 0.642117/20 [========================&gt;.....] - ETA: 0s - loss: 0.647519/20 [===========================&gt;..] - ETA: 0s - loss: 0.653520/20 [==============================] - 1s 34ms/step - loss: 0.6502 - val_loss: 0.6094
Epoch 16/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6212 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.6071 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.6835 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.6482 9/20 [============&gt;.................] - ETA: 0s - loss: 0.635811/20 [===============&gt;..............] - ETA: 0s - loss: 0.631113/20 [==================&gt;...........] - ETA: 0s - loss: 0.619515/20 [=====================&gt;........] - ETA: 0s - loss: 0.631517/20 [========================&gt;.....] - ETA: 0s - loss: 0.642619/20 [===========================&gt;..] - ETA: 0s - loss: 0.655020/20 [==============================] - 1s 34ms/step - loss: 0.6499 - val_loss: 0.5894
Epoch 17/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.8159 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.7351 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.6984 8/20 [===========&gt;..................] - ETA: 0s - loss: 0.672110/20 [==============&gt;...............] - ETA: 0s - loss: 0.635512/20 [=================&gt;............] - ETA: 0s - loss: 0.649514/20 [====================&gt;.........] - ETA: 0s - loss: 0.642116/20 [=======================&gt;......] - ETA: 0s - loss: 0.631518/20 [==========================&gt;...] - ETA: 0s - loss: 0.646820/20 [==============================] - ETA: 0s - loss: 0.643320/20 [==============================] - 1s 34ms/step - loss: 0.6433 - val_loss: 0.5941
Epoch 18/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6497 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.7083 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.6630 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.6318 9/20 [============&gt;.................] - ETA: 0s - loss: 0.620711/20 [===============&gt;..............] - ETA: 0s - loss: 0.625513/20 [==================&gt;...........] - ETA: 0s - loss: 0.607315/20 [=====================&gt;........] - ETA: 0s - loss: 0.633517/20 [========================&gt;.....] - ETA: 0s - loss: 0.639519/20 [===========================&gt;..] - ETA: 0s - loss: 0.636320/20 [==============================] - 1s 34ms/step - loss: 0.6363 - val_loss: 0.5969
Epoch 19/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5559 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.6842 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.6627 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.6457 9/20 [============&gt;.................] - ETA: 0s - loss: 0.653311/20 [===============&gt;..............] - ETA: 0s - loss: 0.652713/20 [==================&gt;...........] - ETA: 0s - loss: 0.652215/20 [=====================&gt;........] - ETA: 0s - loss: 0.636917/20 [========================&gt;.....] - ETA: 0s - loss: 0.640919/20 [===========================&gt;..] - ETA: 0s - loss: 0.640020/20 [==============================] - 1s 34ms/step - loss: 0.6329 - val_loss: 0.5731
Epoch 20/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5753 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.6375 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.6658 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.6852 9/20 [============&gt;.................] - ETA: 0s - loss: 0.644011/20 [===============&gt;..............] - ETA: 0s - loss: 0.627413/20 [==================&gt;...........] - ETA: 0s - loss: 0.635615/20 [=====================&gt;........] - ETA: 0s - loss: 0.642917/20 [========================&gt;.....] - ETA: 0s - loss: 0.631119/20 [===========================&gt;..] - ETA: 0s - loss: 0.627920/20 [==============================] - 1s 34ms/step - loss: 0.6243 - val_loss: 0.6139
Epoch 21/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6740 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.6431 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.6071 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.610110/20 [==============&gt;...............] - ETA: 0s - loss: 0.634512/20 [=================&gt;............] - ETA: 0s - loss: 0.629414/20 [====================&gt;.........] - ETA: 0s - loss: 0.628116/20 [=======================&gt;......] - ETA: 0s - loss: 0.635918/20 [==========================&gt;...] - ETA: 0s - loss: 0.625520/20 [==============================] - ETA: 0s - loss: 0.628720/20 [==============================] - 1s 34ms/step - loss: 0.6287 - val_loss: 0.5523
Epoch 22/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.4622 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.5403 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.5701 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.6177 9/20 [============&gt;.................] - ETA: 0s - loss: 0.601312/20 [=================&gt;............] - ETA: 0s - loss: 0.621314/20 [====================&gt;.........] - ETA: 0s - loss: 0.626416/20 [=======================&gt;......] - ETA: 0s - loss: 0.631518/20 [==========================&gt;...] - ETA: 0s - loss: 0.628120/20 [==============================] - ETA: 0s - loss: 0.629420/20 [==============================] - 1s 35ms/step - loss: 0.6294 - val_loss: 0.6012
Epoch 23/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.9918 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.6520 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.5927 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.5778 9/20 [============&gt;.................] - ETA: 0s - loss: 0.583211/20 [===============&gt;..............] - ETA: 0s - loss: 0.581213/20 [==================&gt;...........] - ETA: 0s - loss: 0.601115/20 [=====================&gt;........] - ETA: 0s - loss: 0.614517/20 [========================&gt;.....] - ETA: 0s - loss: 0.624319/20 [===========================&gt;..] - ETA: 0s - loss: 0.619920/20 [==============================] - 1s 35ms/step - loss: 0.6237 - val_loss: 0.5970
Epoch 24/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5436 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.5783 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.6630 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.6597 9/20 [============&gt;.................] - ETA: 0s - loss: 0.645911/20 [===============&gt;..............] - ETA: 0s - loss: 0.632913/20 [==================&gt;...........] - ETA: 0s - loss: 0.635415/20 [=====================&gt;........] - ETA: 0s - loss: 0.619017/20 [========================&gt;.....] - ETA: 0s - loss: 0.604619/20 [===========================&gt;..] - ETA: 0s - loss: 0.623920/20 [==============================] - 1s 34ms/step - loss: 0.6213 - val_loss: 0.5574
Epoch 25/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5148 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.6467 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.5903 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.6702 9/20 [============&gt;.................] - ETA: 0s - loss: 0.637411/20 [===============&gt;..............] - ETA: 0s - loss: 0.636013/20 [==================&gt;...........] - ETA: 0s - loss: 0.636315/20 [=====================&gt;........] - ETA: 0s - loss: 0.636417/20 [========================&gt;.....] - ETA: 0s - loss: 0.633219/20 [===========================&gt;..] - ETA: 0s - loss: 0.621520/20 [==============================] - 1s 35ms/step - loss: 0.6179 - val_loss: 0.6302
Epoch 26/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6135 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.5974 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.5811 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.5979 9/20 [============&gt;.................] - ETA: 0s - loss: 0.602111/20 [===============&gt;..............] - ETA: 0s - loss: 0.608213/20 [==================&gt;...........] - ETA: 0s - loss: 0.606515/20 [=====================&gt;........] - ETA: 0s - loss: 0.613217/20 [========================&gt;.....] - ETA: 0s - loss: 0.613019/20 [===========================&gt;..] - ETA: 0s - loss: 0.614120/20 [==============================] - 1s 34ms/step - loss: 0.6135 - val_loss: 0.5778
Epoch 27/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6957 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.5714 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.5354 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.5787 9/20 [============&gt;.................] - ETA: 0s - loss: 0.607911/20 [===============&gt;..............] - ETA: 0s - loss: 0.617013/20 [==================&gt;...........] - ETA: 0s - loss: 0.619215/20 [=====================&gt;........] - ETA: 0s - loss: 0.620517/20 [========================&gt;.....] - ETA: 0s - loss: 0.625319/20 [===========================&gt;..] - ETA: 0s - loss: 0.624120/20 [==============================] - 1s 34ms/step - loss: 0.6204 - val_loss: 0.5844
Epoch 28/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6120 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.6209 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.5817 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.5791 9/20 [============&gt;.................] - ETA: 0s - loss: 0.585311/20 [===============&gt;..............] - ETA: 0s - loss: 0.582913/20 [==================&gt;...........] - ETA: 0s - loss: 0.605015/20 [=====================&gt;........] - ETA: 0s - loss: 0.596217/20 [========================&gt;.....] - ETA: 0s - loss: 0.603619/20 [===========================&gt;..] - ETA: 0s - loss: 0.616020/20 [==============================] - 1s 34ms/step - loss: 0.6080 - val_loss: 0.5392
Epoch 29/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6738 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.6884 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.6691 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.6228 9/20 [============&gt;.................] - ETA: 0s - loss: 0.595611/20 [===============&gt;..............] - ETA: 0s - loss: 0.624213/20 [==================&gt;...........] - ETA: 0s - loss: 0.618415/20 [=====================&gt;........] - ETA: 0s - loss: 0.607217/20 [========================&gt;.....] - ETA: 0s - loss: 0.609719/20 [===========================&gt;..] - ETA: 0s - loss: 0.607920/20 [==============================] - 1s 35ms/step - loss: 0.6105 - val_loss: 0.5848
Epoch 30/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.4699 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.5423 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.5845 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.5682 9/20 [============&gt;.................] - ETA: 0s - loss: 0.564111/20 [===============&gt;..............] - ETA: 0s - loss: 0.589013/20 [==================&gt;...........] - ETA: 0s - loss: 0.590115/20 [=====================&gt;........] - ETA: 0s - loss: 0.613217/20 [========================&gt;.....] - ETA: 0s - loss: 0.621119/20 [===========================&gt;..] - ETA: 0s - loss: 0.616620/20 [==============================] - 1s 35ms/step - loss: 0.6112 - val_loss: 0.5700
Epoch 31/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5883 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.5262 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.5515 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.6011 9/20 [============&gt;.................] - ETA: 0s - loss: 0.622611/20 [===============&gt;..............] - ETA: 0s - loss: 0.621013/20 [==================&gt;...........] - ETA: 0s - loss: 0.605915/20 [=====================&gt;........] - ETA: 0s - loss: 0.600117/20 [========================&gt;.....] - ETA: 0s - loss: 0.608219/20 [===========================&gt;..] - ETA: 0s - loss: 0.608620/20 [==============================] - 1s 35ms/step - loss: 0.6047 - val_loss: 0.5597
Epoch 32/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5259 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.5508 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.5693 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.5597 9/20 [============&gt;.................] - ETA: 0s - loss: 0.569311/20 [===============&gt;..............] - ETA: 0s - loss: 0.580613/20 [==================&gt;...........] - ETA: 0s - loss: 0.591315/20 [=====================&gt;........] - ETA: 0s - loss: 0.594717/20 [========================&gt;.....] - ETA: 0s - loss: 0.586119/20 [===========================&gt;..] - ETA: 0s - loss: 0.591220/20 [==============================] - 1s 34ms/step - loss: 0.6087 - val_loss: 0.5674
Epoch 33/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6798 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.6450 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.6403 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.6565 9/20 [============&gt;.................] - ETA: 0s - loss: 0.632111/20 [===============&gt;..............] - ETA: 0s - loss: 0.626113/20 [==================&gt;...........] - ETA: 0s - loss: 0.611315/20 [=====================&gt;........] - ETA: 0s - loss: 0.622617/20 [========================&gt;.....] - ETA: 0s - loss: 0.619019/20 [===========================&gt;..] - ETA: 0s - loss: 0.604720/20 [==============================] - 1s 35ms/step - loss: 0.6061 - val_loss: 0.5602
Epoch 34/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.9146 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.7172 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.6728 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.6550 9/20 [============&gt;.................] - ETA: 0s - loss: 0.623511/20 [===============&gt;..............] - ETA: 0s - loss: 0.616613/20 [==================&gt;...........] - ETA: 0s - loss: 0.607815/20 [=====================&gt;........] - ETA: 0s - loss: 0.621517/20 [========================&gt;.....] - ETA: 0s - loss: 0.612719/20 [===========================&gt;..] - ETA: 0s - loss: 0.609320/20 [==============================] - 1s 34ms/step - loss: 0.6057 - val_loss: 0.5451
Epoch 35/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.5732 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.5744 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.5703 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.5745 9/20 [============&gt;.................] - ETA: 0s - loss: 0.563111/20 [===============&gt;..............] - ETA: 0s - loss: 0.556213/20 [==================&gt;...........] - ETA: 0s - loss: 0.576515/20 [=====================&gt;........] - ETA: 0s - loss: 0.584417/20 [========================&gt;.....] - ETA: 0s - loss: 0.603619/20 [===========================&gt;..] - ETA: 0s - loss: 0.606720/20 [==============================] - 1s 35ms/step - loss: 0.6108 - val_loss: 0.5659
Epoch 36/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.7194 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.6135 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.6189 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.6112 9/20 [============&gt;.................] - ETA: 0s - loss: 0.618211/20 [===============&gt;..............] - ETA: 0s - loss: 0.597213/20 [==================&gt;...........] - ETA: 0s - loss: 0.578915/20 [=====================&gt;........] - ETA: 0s - loss: 0.593617/20 [========================&gt;.....] - ETA: 0s - loss: 0.596820/20 [==============================] - ETA: 0s - loss: 0.603520/20 [==============================] - 1s 34ms/step - loss: 0.6035 - val_loss: 0.5390
Epoch 37/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6816 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.6634 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.5943 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.569210/20 [==============&gt;...............] - ETA: 0s - loss: 0.572912/20 [=================&gt;............] - ETA: 0s - loss: 0.570114/20 [====================&gt;.........] - ETA: 0s - loss: 0.584516/20 [=======================&gt;......] - ETA: 0s - loss: 0.583018/20 [==========================&gt;...] - ETA: 0s - loss: 0.601620/20 [==============================] - ETA: 0s - loss: 0.594820/20 [==============================] - 1s 34ms/step - loss: 0.5948 - val_loss: 0.5567
Epoch 38/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.6113 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.5533 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.5824 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.5510 9/20 [============&gt;.................] - ETA: 0s - loss: 0.543111/20 [===============&gt;..............] - ETA: 0s - loss: 0.596013/20 [==================&gt;...........] - ETA: 0s - loss: 0.577715/20 [=====================&gt;........] - ETA: 0s - loss: 0.588817/20 [========================&gt;.....] - ETA: 0s - loss: 0.589319/20 [===========================&gt;..] - ETA: 0s - loss: 0.595120/20 [==============================] - 1s 34ms/step - loss: 0.5997 - val_loss: 0.5605
Epoch 39/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.3939 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.5971 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.6027 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.5972 9/20 [============&gt;.................] - ETA: 0s - loss: 0.591611/20 [===============&gt;..............] - ETA: 0s - loss: 0.598513/20 [==================&gt;...........] - ETA: 0s - loss: 0.592315/20 [=====================&gt;........] - ETA: 0s - loss: 0.589817/20 [========================&gt;.....] - ETA: 0s - loss: 0.585619/20 [===========================&gt;..] - ETA: 0s - loss: 0.600220/20 [==============================] - 1s 34ms/step - loss: 0.6019 - val_loss: 0.5835
Epoch 40/40
 1/20 [&gt;.............................] - ETA: 0s - loss: 0.4886 3/20 [===&gt;..........................] - ETA: 0s - loss: 0.5834 5/20 [======&gt;.......................] - ETA: 0s - loss: 0.5877 7/20 [=========&gt;....................] - ETA: 0s - loss: 0.5823 9/20 [============&gt;.................] - ETA: 0s - loss: 0.599511/20 [===============&gt;..............] - ETA: 0s - loss: 0.603213/20 [==================&gt;...........] - ETA: 0s - loss: 0.614015/20 [=====================&gt;........] - ETA: 0s - loss: 0.600117/20 [========================&gt;.....] - ETA: 0s - loss: 0.602019/20 [===========================&gt;..] - ETA: 0s - loss: 0.601220/20 [==============================] - 1s 34ms/step - loss: 0.5987 - val_loss: 0.5220</code></pre>
</div>
</div>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>spy_4_t_pred <span class="op">=</span> model.predict(spy_x)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>spy_4_t_pred <span class="op">=</span> spy_4_t_pred</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>spy_4_v_pred <span class="op">=</span> model.predict(spy_val_x)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>spy_4_v_pred.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> 1/15 [=&gt;............................] - ETA: 7s 9/15 [=================&gt;............] - ETA: 0s15/15 [==============================] - 1s 6ms/step
1/3 [=========&gt;....................] - ETA: 0s3/3 [==============================] - 0s 7ms/step</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>(69, 31, 1)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>history_plot(history_spy_4_noreg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Deep Learning for TS_files/figure-html/cell-20-output-1.png" width="597" height="449"></p>
</div>
</div>
<p>With a much larger model of 3x64 neuron LSTM layers, we can see that the validation loss is still around 55. However, the training loss has a consistent curve down to the validation loss. It is interesting that even in the later epochs, the validation loss remains lower than the training.</p>
<h2 class="anchored">
Comparing Results of Deep Learning Models
</h2>
<p>Of the three neural network models, the LSTM provided the most consistent performance, while the RNN provided the best performance. The GRU model performed slightly worse than the other two, as measured by its validation set performance. Interestingly, the complexity required for the model to avoid underfitting was much higher with the LSTM model, where 3 hidden layers of 64 neurons each were needed before I felt the training plot showed excess training performance over validation performance. With smaller models, the LSTM performed somewhat poorly on the training set in comparison to the validation set. In terms of accuracy, the RNN model was notable for sometimes reaching below 0.55 loss in performance on the validation set, while the LSTM model usually reached around 0.56 and the GRU model between 0.56 and 0.6. In terms of predictive power (extrapolating outside the validation set) I would tend to trust the LSTM model, because it had the most consistent performance once it was trained over a number of epochs, and even boasted the lowest loss on a particular epoch, sometimes reaching as low as 0.51 in the validation set, although these results were not the norm.</p>
<p>Regularization was an important element across the models. It had two main benefits: First, the models achieved better performance faster because they had more consistent improvement and less variation in performance between epochs. Models which included regularization (both L1L2 and dropout regularization) had almost monotonically decreasing loss in the training set, and clear trends toward improvement in the validation set.</p>
<p>The deep learning models will only have the performance described above when they predict 1 observation into the future. This is because they take in the past 30 observations and return 1 prediction. All of the loss estimates are for this 1-step ahead prediction. If we were to predict further into the future with the models, there would be drift or compound error, where the models loss from a previous prediction would be inherited in future predictions that relied upon that past prediction as an input into the model.</p>
<p>The deep learning modelling is more complicated than the univariate modeling from HW3, because there are a range of hyperparameters introduced that make the process of selecting the best model more complicated. Unlike a simple ARIMA model, it is not possible to iterate through all combinations of hidden layer sizes and complexities. As such, I think there is more subjective elements introduced to neural network modeling.</p>
<h2 class="anchored">
Comparing Deep Learning and Traditional TS Models
</h2>
<p>We identified ARIMA(3,0,3) as a good model for the SPY data. Lets look at the one step ahead precition of the ARIMA and best-performing (LSTM) neural network model in the validation data:</p>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.arima.model <span class="im">import</span> ARIMA</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>modelA <span class="op">=</span> ARIMA(spy_train, order <span class="op">=</span> (<span class="dv">3</span>,<span class="dv">0</span>,<span class="dv">3</span>))</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>modelA <span class="op">=</span> modelA.fit()</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>forecasts_arima <span class="op">=</span> modelA.forecast(<span class="dv">100</span>)</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>predict_arima <span class="op">=</span> ARIMA(spy_val, order <span class="op">=</span> (<span class="dv">3</span>,<span class="dv">0</span>,<span class="dv">3</span>))</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>predict_arima <span class="op">=</span> predict_arima.fit()</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>arimapreds <span class="op">=</span> <span class="bu">list</span>()</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>indexvals <span class="op">=</span> pd.array(<span class="bu">range</span>(<span class="dv">0</span>,<span class="dv">69</span>))</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>arimavals <span class="op">=</span> pd.array(predict_arima.get_prediction().predicted_mean)</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>arimavals <span class="op">=</span> arimavals[<span class="dv">0</span>:<span class="dv">69</span>]</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>nnvals <span class="op">=</span> spy_4_v_pred[:,<span class="dv">0</span>,<span class="dv">0</span>]</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>plt.plot(indexvals, arimavals, label<span class="op">=</span><span class="st">'ARIMA Prediction'</span>)</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>plt.plot(indexvals, nnvals, label<span class="op">=</span><span class="st">'NN Prediction'</span>)</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>plt.plot(indexvals, spy_val_y, label<span class="op">=</span><span class="st">'Real Values'</span>)</span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"One Step Ahead Forecasts in Validation (NN vs. ARIMA)"</span>)</span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>realVals <span class="op">=</span> spy_val_y</span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rmse(pred, tar):</span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.sqrt(((pred <span class="op">-</span> tar) <span class="op">**</span> <span class="dv">2</span>).mean())</span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"arima: "</span>, rmse(arimavals, spy_val_y))</span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Neural Net: "</span>, rmse(nnvals, spy_val_y))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\corwi\anaconda3\Lib\site-packages\statsmodels\base\model.py:604: ConvergenceWarning:

Maximum Likelihood optimization failed to converge. Check mle_retvals

C:\Users\corwi\anaconda3\Lib\site-packages\statsmodels\base\model.py:604: ConvergenceWarning:

Maximum Likelihood optimization failed to converge. Check mle_retvals
</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Deep Learning for TS_files/figure-html/cell-21-output-2.png" width="582" height="431"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>arima:  0.7763029583389425
Neural Net:  0.7085079062981898</code></pre>
</div>
</div>
<p>Looking at a chart of our best-performing Neural Network Model (LSTM) vs.&nbsp;my best performing ARIMA model (3,0,3) from earlier work, vs.&nbsp;the real observed values, a few things become clear. One, neither model type does a perfect job, especially of capturing extremely high or low values. Two, the ARIMA predictions increase and decrease more (have a higher range) thant he NN predictions. However, the ARIMA predictions tend to vary further from 0, while the NN predictions stay close to zero and only alter slightly. Because of this, the RSME of the neural network is actually lower than the ARIMA model, with the neural network having 0.71 RMSE and the ARIMA model having 0.78 RMSE.</p>
<p>However, the neural network is still not the best model I have tested in this project, because the VAR model achieved an RMSE of 0.68 on the same dataset. This suggests that while Neural networks are powerful tools for univariate prediction, the most accurate model predictions may still be those that include exogenous variables.</p>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>